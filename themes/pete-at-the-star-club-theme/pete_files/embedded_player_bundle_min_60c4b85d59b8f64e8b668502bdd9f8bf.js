/* concatenation of swfobject.js, utils_boot.js, flashproxy.js, html5sound.js, image_utils.js, sound.js, cookie.js, hidden_params.js, cookie_comm.js, stats.js, playlist.js, color.js, share.js, utils.js, templ.js, htmlembeddedplayer.js, share_external.js, social_controls.js, jquery.ui.draggable.min.js, jquery.ui.dialog.min.js, iscroll-min.js */
if(typeof deconcept=="undefined")var deconcept=new Object;if(typeof deconcept.util=="undefined")deconcept.util=new Object;if(typeof deconcept.SWFObjectUtil=="undefined")deconcept.SWFObjectUtil=new Object;
deconcept.SWFObject=function(swf,id,w,h,ver,c,quality,xiRedirectUrl,redirectUrl,detectKey){if(!document.getElementById)return;this.DETECT_KEY=detectKey?detectKey:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object;this.variables=new Object;this.attributes=new Array;if(swf)this.setAttribute("swf",swf);if(id)this.setAttribute("id",id);if(w)this.setAttribute("width",w);if(h)this.setAttribute("height",h);if(ver)this.setAttribute("version",new deconcept.PlayerVersion(ver.toString().split(".")));
this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7)deconcept.SWFObject.doPrepUnload=true;if(c)this.addParam("bgcolor",c);var q=quality?quality:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var xir=xiRedirectUrl?xiRedirectUrl:window.location;this.setAttribute("xiRedirectUrl",xir);this.setAttribute("redirectUrl","");if(redirectUrl)this.setAttribute("redirectUrl",
redirectUrl)};
deconcept.SWFObject.prototype={useExpressInstall:function(path){this.xiSWFPath=!path?"expressinstall.swf":path;this.setAttribute("useExpressInstall",true)},setAttribute:function(name,value){this.attributes[name]=value},getAttribute:function(name){return this.attributes[name]},addParam:function(name,value){this.params[name]=value},getParams:function(){return this.params},addVariable:function(name,value){this.variables[name]=value},getVariable:function(name){return this.variables[name]},getVariables:function(){return this.variables},
getVariablePairs:function(){var variablePairs=new Array;var key;var variables=this.getVariables();for(key in variables)variablePairs.push(key+"\x3d"+variables[key]);return variablePairs},getSWFHTML:function(){var swfNode="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}swfNode='\x3cembed type\x3d"application/x-shockwave-flash" src\x3d"'+this.getAttribute("swf")+
'" width\x3d"'+this.getAttribute("width")+'" height\x3d"'+this.getAttribute("height")+'"';swfNode+=' id\x3d"'+this.getAttribute("id")+'" name\x3d"'+this.getAttribute("id")+'" ';var params=this.getParams();for(var key in params)swfNode+=[key]+'\x3d"'+params[key]+'" ';var pairs=this.getVariablePairs().join("\x26");if(pairs.length>0)swfNode+='flashvars\x3d"'+pairs+'"';swfNode+="/\x3e"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}swfNode=
'\x3cobject id\x3d"'+this.getAttribute("id")+'" classid\x3d"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width\x3d"'+this.getAttribute("width")+'" height\x3d"'+this.getAttribute("height")+'"\x3e';swfNode+='\x3cparam name\x3d"movie" value\x3d"'+this.getAttribute("swf")+'" /\x3e';params=this.getParams();for(key in params)swfNode+='\x3cparam name\x3d"'+key+'" value\x3d"'+params[key]+'" /\x3e';pairs=this.getVariablePairs().join("\x26");if(pairs.length>0)swfNode+='\x3cparam name\x3d"flashvars" value\x3d"'+
pairs+'" /\x3e';swfNode+="\x3c/object\x3e"}return swfNode},write:function(elementId){function hack_getSWFSrc(html){var regex=/ src=\"([^"]*)\"/i;var result=regex.exec(html);if(result)return result[1];return null}if(this.getAttribute("useExpressInstall")){var expressInstallReqVer=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(expressInstallReqVer)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",
escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=typeof elementId=="string"?document.getElementById(elementId):elementId;var html=this.getSWFHTML();var url=hack_getSWFSrc(html);n.innerHTML=html;if(url&&url!=hack_getSWFSrc(n.innerHTML)){n.innerHTML="";return false}return true}else if(this.getAttribute("redirectUrl")!=
"")document.location.replace(this.getAttribute("redirectUrl"));return false}};
deconcept.SWFObjectUtil.getPlayerVersion=function(){var PlayerVersion=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description)PlayerVersion=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e$$0){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");PlayerVersion=
new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always"}catch(e){if(PlayerVersion.major==6)return PlayerVersion}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(axo!=null)PlayerVersion=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","))}return PlayerVersion};
deconcept.PlayerVersion=function(arrVersion){this.major=arrVersion[0]!=null?parseInt(arrVersion[0]):0;this.minor=arrVersion[1]!=null?parseInt(arrVersion[1]):0;this.rev=arrVersion[2]!=null?parseInt(arrVersion[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major)return false;if(this.major>fv.major)return true;if(this.minor<fv.minor)return false;if(this.minor>fv.minor)return true;if(this.rev<fv.rev)return false;return true};
deconcept.util={getRequestParameter:function(param){var q=document.location.search||document.location.hash;if(q){var pairs=q.substring(1).split("\x26");for(var i=0;i<pairs.length;i++)if(pairs[i].substring(0,pairs[i].indexOf("\x3d"))==param)return pairs[i].substring(pairs[i].indexOf("\x3d")+1)}return""}};
deconcept.SWFObjectUtil.cleanupSWFs=function(){var objects=document.getElementsByTagName("OBJECT");for(var i=0;i<objects.length;i++){objects[i].style.display="none";for(var x in objects[i])if(typeof objects[i][x]=="function")objects[i][x]=function(){}}};
if(deconcept.SWFObject.doPrepUnload){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload)}if(Array.prototype.push==null)Array.prototype.push=function(item){this[this.length]=item;return this.length};var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;
var SWFObject=deconcept.SWFObject;var Y=null;try{Y=YAHOO}catch(e){}
var U={_jquery:null,jQuery:function(){if(U._jquery===null)try{U._jquery=jQuery}catch(err){U._jquery=false}return U._jquery},trim:function(str){if(U.jQuery())return jQuery.trim(str);else return Y.lang.trim(str)},isObject:function(o){if(U.jQuery())return jQuery.isPlainObject(o);else return Y.lang.isObject(o)},augmentObject:function(r,s,args){if(!args)for(var k in s)r[k]=s[k];else for(var i in args){var key=args[i];r[key]=s[key]}},isString:function(o){return typeof o==="string"},isNumber:function(o){return typeof o===
"number"&&isFinite(o)},isArray:function(o){if(U.jQuery())return jQuery.isArray(o);else return Y.lang.isArray(o)},elt:function(e){if(U.jQuery())if(U.isString(e)){e=e.replace(/\./g,"\\.");return $("#"+e.toString()).get(0)}else return $(e).get(0);else return Y.util.Dom.get(e)},merge:function(args){var argarray=[{}];for(var i=0;i<arguments.length;i++)argarray.push(arguments[i]);if(U.jQuery())return $.extend.apply($,argarray);else return Y.lang.merge.apply(Y.lang,argarray)},addClass:function(elem,classname){if(U.jQuery())$(elem).addClass(classname);
else Y.util.Dom.addClass(elem,classname)},removeClass:function(elem,classname){if(U.jQuery())$(elem).removeClass(classname);else Y.util.Dom.removeClass(elem,classname)},stopEvent:function(e){if(U.jQuery()){var evt=$.Event(e);evt.stopPropagation();evt.preventDefault()}else Y.util.Event.stopEvent(e)}};function $assert(expr,msg){if(!expr){if(msg==null)msg="";var skipDebug=confirm("Assertion failed. "+msg+"\n\nSelect Cancel to debug.");if(!skipDebug)eval("debugger")}}
var LogAll=function(level,msg){var d=new Date;for(var ms=d.getMilliseconds().toString();ms.length<3;)ms="0"+ms;var timestamp=d.toTimeString().substring(0,8)+"."+ms+":";var args=Array.prototype.slice.call(arguments,1);args.unshift(timestamp);if(typeof LogView!="undefined")LogView.add(args.join(" "));if(Browser.platform=="iphone"){var str="";var sep="";for(var x in args){str+=sep+args[x];sep=" "}console.log(str);return}if(typeof console=="undefined")return;var logFn=console[level]||console.log;if(typeof logFn===
"object")logFn(args.join(" "));else logFn.apply(console,args)};LogAll.proxy=function(level){return function(msg){try{var args=Array.prototype.slice.call(arguments);args.unshift(level);LogAll.apply(Log,args)}catch(e){}}};
var Log={debug:LogAll.proxy("log"),info:LogAll.proxy("info"),note:LogAll.proxy("info"),warn:LogAll.proxy("warn"),error:LogAll.proxy("error"),flash:function(msg){Log.debug("Flash: "+unescape(msg))},server:function(msg,lvl,isException){lvl=lvl||"info";Log.debug("about to send server log entry: "+lvl+": "+msg);var bcn=document.createElement("img");bcn.style.display="none";bcn.onload=function(){var e$$0;try{Log.debug("server log entry success: "+lvl+": "+msg);bcn.onload=bcn.onerror=null;bcn=null}catch(e){}};
bcn.onerror=function(){var e$$0;try{Log.debug("server log entry error: "+lvl+": "+msg);bcn.onload=bcn.onerror=null;bcn=null}catch(e){}};bcn.src="/client_log"+"?exc\x3d"+(isException?"1":"0")+"\x26msg\x3d"+encodeURIComponent(msg.substring(0,1E3))+"\x26lvl\x3d"+encodeURIComponent(lvl)+"\x26r\x3d"+Math.random().toString().substring(2);bcn=null}};var ErrorCollector;
ErrorCollector=function(exports){function filter(msg,scriptURL,line){if(!msg)return null;if(msg.toString()=="[object Event]"){msg=msg.message||msg.msg||msg.toString();scriptURL=scriptURL||msg.filename||msg.file||"";var normalize=function(val){return val===0?new Number(0):val};line=normalize(line)||normalize(msg.lineno)||normalize(msg.line)||""}if(scriptURL){var scriptHost=Url.toHash(scriptURL).host;var pageHost=location.host;if(!scriptHost)return null;if(!/(^|\.)(bandcamp\.com|bcbits\.com)$/.test(scriptHost)){var idx=
pageHost.length-scriptHost.length;if(idx<0||pageHost.lastIndexOf(scriptHost)!=idx)return null}}if(Browser.type=="gecko"&&line==0&&(/Permission denied to access property 'toString'/.test(msg)||/Location\.toString/.test(msg)))return null;var pageURL=location.href;if(scriptURL==pageURL)pageURL="---";var scripts=[];var jsb=window._jsb;if(jsb){var len=Math.min(jsb.length,20);for(var i=0;i<len;i++)scripts.push(jsb[i].n+":"+(jsb[i].c||0));if(len<jsb.length)scripts.unshift("(omitted "+(jsb.length-len)+")")}scripts=
scripts.join(",");return[msg,scriptURL,line,pageURL,++errorCount,domready,scripts]}function flush(){if(!timer){var delay=Math.max(lastSave+exports.saveDelay-(new Date).getTime(),250);timer=setTimeout(save,delay)}}function save(){clearTimeout(timer);timer=null;if(!isActive()||!errors.length)return;var out=[];var len=Math.min(errors.length,exports.maxBatchSize);for(var i=0;i<len;i++)out.push(errors[i].join("\t"));Log.server(out.join("\n"),"debug",true);lastSave=(new Date).getTime();errors.length=0;
batchCount++}function isActive(){return exports.enabled&&batchCount<exports.maxBatches}var defaults={enabled:true,sampleRate:null,maxBatchSize:3,maxBatches:3,saveDelay:5E3};var errors=[];var lastSave=0;var batchCount=0;var errorCount=0;var timer=null;var domready="";for(var prop in defaults)if(defaults.hasOwnProperty(prop)&&!exports.hasOwnProperty(prop))exports[prop]=defaults[prop];if(exports.enabled&&exports.sampleRate!=null&&Math.random()>exports.sampleRate){Log.debug("ErrorCollector: disabled due to sample rate");
exports.enabled=false}else Log.debug("ErrorCollector: "+(exports.enabled?"enabled":"disabled"));if(window.$){domready=0;$(document).ready(function(){domready=1})}exports.add=function(msg,scriptURL,line){if(window.isDebug||window.Identities&&window.Identities.isAdmin())alert("JavaScript error: "+msg+". Check the console.");if(isActive()){var data=filter(msg,scriptURL,line);if(data){errors.push(data);flush()}else Log.debug("ErrorCollector: skipping runtime error")}};if(exports.enabled)window.onerror=
exports.add;return exports}(ErrorCollector||{});if(Y&&Y.widget&&Y.widget.Logger)Y.widget.Logger.newLogEvent.subscribe(function(type,args,obj){var logMsg=args[0];if(logMsg.category=="error")Log.error("YUI "+logMsg.source+": "+logMsg.msg)});if(!Object.create)Object.create=function(o){if(arguments.length>1){var msg="Object.create polyfill only supports one parameter";Log.error(msg);throw new Error(msg);}var F=function(){};F.prototype=o;return new F};
var Iter={each:function(a,f){var i=0;var v=null;for(i=0;a&&i<a.length;i++){v=f(a[i]);if(v)return v}},eachWithIndex:function(a,f){var i=0;var v=null;for(i=0;a&&i<a.length;i++){v=f(a[i],i);if(v)return v}},collect:function(arr,fn){if(!fn)fn=function(item){return item};var len=arr.length;var out=new Array(len);for(var i=0;i<len;i++)out[i]=fn(arr[i]);return out},find:function(arr,fn){var len=arr.length;for(var i=0;i<len;i++)if(fn(arr[i]))return arr[i];return null},findAll:function(arr,fn){var len=arr.length;
var out=[];for(var i=0;i<len;i++){var entry=arr[i];if(fn(entry))out.push(entry)}return out},index:function(arr,item){if(typeof arr.indexOf==="function")return arr.indexOf(item);var len=arr.length;for(var i=0;i<len;i++)if(arr[i]==item)return i;return-1},reduce:function(arr,fn,initialValue){if("function"===typeof arr.reduce)if(arguments.length<3)return arr.reduce(fn);else return arr.reduce(fn,initialValue);var prevValue=initialValue;var i=0;var len=arr.length;if(arguments.length<3){for(;i<len&&!(i in
arr);)i++;if(i>=len)throw new TypeError("Reduce of empty array with no initial value");prevValue=arr[i++]}for(;i<len;i++)if(i in arr)prevValue=fn(prevValue,arr[i],i,arr);return prevValue}};
var Text={notEmpty:function(str){return str!=null&&str.toString().length>0},collate:function(){for(var i=0;i<arguments.length;i++){var str=arguments[i];if(Text.notEmpty(str))return str}return""},escapeHtml:function(str){str=str.toString();return str.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")},unescapeHtml:function(str){var unescape_div=document.createElement("div");unescape_div.innerHTML=str;return unescape_div.firstChild.nodeValue},
markupMatch:function(str,match,pre,post,caseSensitive){var matchIndex=!caseSensitive?str.toLowerCase().indexOf(match.toLowerCase()):str.indexOf(match);if(matchIndex==-1)return str;return[str.substr(0,matchIndex),pre,str.substr(matchIndex,match.length),post,str.substr(matchIndex+match.length)].join("")},regexpEscape:function(str){return str.replace(/([\\\^\$\*\+\?\.\,\:\!\|\(\)\[\]\{\}])/g,"\\$1")},truncate:function(str,len,ellipsis){if(!str)return"";if(len==null)len=50;if(ellipsis==null)ellipsis=
"";if(str.length<=len)return str;if(ellipsis.length>len)return"";len=Math.max(0,len-ellipsis.length);return str.substr(0,len)+ellipsis}};
var Url={PATTERN_URL:/^(?:(https?\:)\/\/([^\:\/\?#]+)(?:\:(\d+))?)?(\/?[^\?#]*)?(?:\?|(\?[^#]*))?(?:#|(#.*))?$/,PATTERN_URL_NO_SPACE:/^(?:(https?\:)\/\/([^\:\/\?\s#]+)(?:\:(\d+))?)?(\/?[^\?\s#]*)?(?:\?|(\?[^#]*))?(?:#|(#.*))?$/,toHash:function(url,noSpace){url=U.trim(url);var matches=Url.PATTERN_URL.exec(url)||[];if(noSpace)matches=Url.PATTERN_URL_NO_SPACE.exec(url)||[];return{href:matches[0]||"",protocol:matches[1]||"",host:(matches[2]||"")+(matches[3]?":"+matches[3]:""),hostname:matches[2]||"",
port:matches[3]||"",pathname:matches[4]||"/",search:matches[5]||"",hash:matches[6]||""}},fromHash:function(urlHash){$assert(U.isObject(urlHash));var out=[];if(urlHash.protocol)out.push(urlHash.protocol,"//");if(urlHash.hostname)out.push(urlHash.hostname);if(urlHash.port)out.push(":",urlHash.port);if(urlHash.pathname)out.push(urlHash.pathname);if(urlHash.search)out.push(urlHash.search);if(urlHash.hash)out.push(urlHash.hash);return out.join("")},isLocal:function(url){var urlHash=Url._hashify(url);if(window.FacebookData){if(urlHash.protocol==
location.protocol&&urlHash.host==location.host)return true;var re=new RegExp(location.host+"$");if(urlHash.host.match(re))return true;return false}else return urlHash.protocol==location.protocol&&urlHash.host==location.host},isFullyQualified:function(url){var urlHash=Url._hashify(url);return urlHash.protocol&&urlHash.host},equals:function(urlA,urlB,skipHash){var hashA=Url._hashify(urlA);var hashB=Url._hashify(urlB);return hashA.protocol==hashB.protocol&&hashA.hostname==hashB.hostname&&(hashA.port||
80)==(hashB.port||80)&&hashA.pathname==hashB.pathname&&hashA.search==hashB.search&&(skipHash||hashA.hash==hashB.hash)},fullyQualify:function(url,baseUrl){var urlHash=Url._hashify(url);baseUrl=baseUrl||location;var baseUrlHash=Url._hashify(baseUrl);$assert(!urlHash.protocol&&!urlHash.hostname&&!urlHash.port,"expected a non-qualified URL");$assert(baseUrlHash.protocol&&baseUrlHash.hostname,"expected a fully-qualified base URL");$(["protocol","hostname","port"]).each(function(i,prop){urlHash[prop]=baseUrlHash[prop]});
if(!urlHash.pathname)urlHash.pathname="/";else if(urlHash.pathname.charAt(0)!="/"){var basePath=baseUrlHash.pathname||"/";$assert(basePath.charAt(0)=="/","expected a fully-qualified base URL path");if(basePath.charAt(basePath.length-1)=="/")urlHash.pathname=basePath+urlHash.pathname;else urlHash.pathname=basePath.replace(/[^\/]+$/,urlHash.pathname)}return Url.fromHash(urlHash)},parseQuery:function(query){var out={};$.each(Url.parseQueryArray(query),function(){out[this.name]=this.value});return out},
joinQuery:function(queryHash){var out=[];for(var key in queryHash)if(queryHash.hasOwnProperty(key))out.push({name:key,value:queryHash[key]});return Url.joinQueryArray(out)},parseQueryArray:function(query){query=query.replace(/^[\?&\s]*(.*?)[&\s]*$/,"$1");var out=[];if(query){var pairs=query.split(/&+/);$.each(pairs,function(){if(this&&this!="\x3d"){var pair=this.split("\x3d");var paramName;var paramValue;try{paramName=decodeURIComponent(pair[0]);paramValue=pair[1]?decodeURIComponent(pair[1]):""}catch(e){Log.error("parseQueryArray: error when decoding URL parameter, skipping; ",
e);return true}out.push({name:paramName,value:paramValue})}})}return out},joinQueryArray:function(arr){arr=arr||[];var out=[];var param;for(var i=0;i<arr.length;i++){param=arr[i];if(param&&(param.name!=null&&param.name!="")){if(out.length)out.push("\x26");out.push(encodeURIComponent(param.name));if(param.value!=null&&param.value!="")out.push("\x3d",encodeURIComponent(param.value))}}return out.join("")},addQueryParams:function(url,hash){if(!hash)return url;var queryIndex=url.indexOf("?")+1;var query=
queryIndex>0?url.substr(queryIndex):"";var queryHash=Url.parseQuery(query);for(var key in hash)queryHash[key]=hash[key];var prefix=queryIndex>0?url.substring(0,queryIndex):url+"?";return prefix+Url.joinQuery(queryHash)},removeQueryParams:function(url,arr){if(!arr)return url;var queryIndex=url.indexOf("?")+1;var query=queryIndex>0?url.substr(queryIndex):"";var queryHash=Url.parseQuery(query);var update=0;for(var i in arr){delete queryHash[arr[i]];update+=1}if(update===0)return url;var prefix=queryIndex>
0?url.substring(0,queryIndex):url+"?";return prefix+Url.joinQuery(queryHash)},getQueryParam:function(url,param){var u=Url.toHash(url);return Url.parseQuery(u.search)[param]},_hashify:function(url){return U.isString(url)?Url.toHash(url):url},isCustomDomain:function(hostnameMinusPort){$assert(window.siteroot,"expected siteroot");var hostname=hostnameMinusPort||location.hostname;var baseDomainPattern=new RegExp("\\.?"+Url.toHash(siteroot).hostname.replace(/\./g,"\\.")+"$");return!baseDomainPattern.test(hostname)}};
var DomBoot={elt:U.elt,cloneEvent:function(event){if(event&&Browser.type=="ie")return Y.lang.merge(event);return event}};var elt=DomBoot.elt;
var LangUtils={makeclass:function(classdef){return LangUtils.makesubclass(null,classdef)},makesubclass:function(superclass,classdef){var f=function(){};if(classdef.ctor){f=classdef.ctor;classdef.ctor=null}if(superclass)YAHOO.lang.extend(f,superclass);for(var x in classdef.prototype)f.prototype[x]=classdef.prototype[x];for(x in classdef.statics)f[x]=classdef.statics[x];return f}};
var EventSender=LangUtils.makeclass({ctor:function(){this._listeners=[]},prototype:{get_adder:function(){var that=this;return function(callback,target){that._listeners.push({callback:callback,target:target})}},get_remover:function(){var that=this;return function(callback,target){for(var i=0;i<that._listeners.length;)if(that._listeners[i].callback==callback&&that._listeners[i].target==target)that._listeners.splice(i,1);else i++}},fire:function(){for(var i=0;i<this._listeners.length;i++){var l=this._listeners[i];
try{l.callback.apply(l.target,arguments)}catch(e){Log.debug("exception caught in event handler: "+l.callback.toString())}}}},statics:{create:function(obj,eventname){var sender=new EventSender;sender.serial=EventSender.serial++;obj["on"+eventname]=sender.get_adder();obj["remove_on"+eventname]=sender.get_remover();return function(){sender.fire.apply(sender,arguments)}},serial:1}});
var FormUtils={showHideAlert:function(elem,text){elem=elt(elem);if(!elem)return;if(typeof text!="boolean")elem.innerHTML=text||"";if(text)Y.util.Dom.addClass(elem,"alertActive");else{Y.util.Dom.removeClass(elem,"alertActive");if(window.Form&&window.Form.validate)Form.validate.remove_onchange_listeners(elem)}}};
var Form={_classDefinition:1,_allowSubmit:false,_submitTimer:null,delaySubmitUntilReady:function(e,submitter,change_ui,delay_interval){if(!delay_interval)delay_interval=100;var debugstring="event: "+e.type+", delay_interval: "+delay_interval+", change_ui: "+typeof change_ui;Log.debug("delaySubmitUntilReady: "+debugstring);if(!Form._allowSubmit){Y.util.Event.stopEvent(e);if(change_ui)change_ui();if(submitter){fn=Form.makeSubmitClosure(delay_interval,submitter);Form._submitTimer=setTimeout(fn,delay_interval)}else alert("The page is still loading; please wait just a moment...")}else;
},makeSubmitClosure:function(delay,submitter){return function(){Log.debug("anon fn: delay interval: "+delay);if(Form._submitTimer)clearTimeout(Form._submitTimer);if(!Form._allowSubmit){Log.debug("delaying "+delay+" millis...");var nextTry=Form.makeSubmitClosure(delay,submitter);Form._submitTimer=setTimeout(nextTry,delay)}else{Log.debug("Allowing Submit");submitter(null,true)}}}};function TimeIt(fn){var start=(new Date).getTime();fn();return(new Date).getTime()-start}function FPDebug(str){}
function FPTrace(str){}
var FlashProxy={register_proxy:function(swfurl,classnames){for(var i=0;i<classnames.length;i++)FlashProxy._class_urls[classnames[i]]=swfurl},whenclassready:function(classname,callback,errorcallback){FPTrace("whenclassready("+classname+") called");if(FlashProxy.error){if(errorcallback){FPTrace("flash proxy error for class "+classname+"; calling error callback");errorcallback()}return}if(FlashProxy.find_by_classname(classname)){FPDebug("whenclassready("+classname+"): class is already ready");callback();
return}if(!FlashProxy._proxywaiters[classname])FlashProxy._proxywaiters[classname]=[];var swfurl=FlashProxy._class_urls[classname];if(!swfurl)Log.error("No SWF URL found for class "+classname);FPTrace("loading swf "+swfurl);FlashProxy._proxywaiters[classname].push({success:callback,failure:errorcallback});if(swfurl)if(!FlashProxy._loadswf(swfurl))FlashProxy._onproxyerror(classname)},invalidate_class:function(classname){var entry=FlashProxy._by_classname[classname];FlashProxy._invalidate_entry(entry)},
invalidate_swf:function(url){var entry=FlashProxy._by_swfurl[classname];FlashProxy._invalidate_entry(entry)},invalidate_proxyid:function(id){var entry=FlashProxy._by_proxyid[id];FlashProxy._invalidate_entry(entry)},_invalidate_entry:function(entry){if(!entry)return;for(var i=0;i<entry.classes.length;i++){FPDebug("invalidating class "+entry.classes[i]);FlashProxy._by_classname[entry.classes[i]]=null;FlashProxy[entry.classes[i]]=null}if(entry.proxyid){FPDebug("invalidating proxy id "+entry.proxyid);
FlashProxy._by_proxyid[entry.proxyid]=null}if(entry.swfurl){FPDebug("invalidating proxy swfurl "+entry.swfurl);FlashProxy._by_swfurl[entry.swfurl]=null}},is_proxy_valid:function(proxyid){return FlashProxy.find_by_proxyid(proxyid)!=null},_is_entry_valid:function(entry){if(entry){var is_in_document=function(elem){try{for(var cur=elem;cur;){cur=cur.parentNode;if(cur==document)return true}}catch(e){}FPDebug("entry is not valid because it is not a descendant of document!");return false};var swfExists=
typeof entry.swfobject!="undefined"&&entry.swfobject;if(entry.pending||swfExists&&entry.swfobject.getproxynames&&is_in_document(entry.swfobject))return true;FPDebug("entry is not valid: entry.swfobject\x3d"+entry.swfobject+", entry.swfobjects.getproxynames\x3d"+(swfExists?entry.swfobject.getproxynames:"[undef]"));FlashProxy._invalidate_entry(entry)}return false},find_by_classname:function(classname){var entry=FlashProxy._by_classname[classname];if(FlashProxy._is_entry_valid(entry))return entry;return null},
find_by_swfurl:function(url){var entry=FlashProxy._by_swfurl[url];if(FlashProxy._is_entry_valid(entry))return entry;return null},find_by_proxyid:function(proxyid){var entry=FlashProxy._by_proxyid[proxyid];FPDebug('found proxy entry by id "'+proxyid+'": '+entry);if(FlashProxy._is_entry_valid(entry))return entry;FPDebug("proxy entry is not valid");return null},find_proxy:function(proxyid){var entry=FlashProxy.find_by_proxyid(proxyid);return entry?entry.swfobject:null},_loadswf:function(url){var existing=
FlashProxy.find_by_swfurl(url);if(existing)return existing;var create_confirm_button=false;var nuggetname="nugget2.swf";if(url.substr(url.length-nuggetname.length,nuggetname.length)==nuggetname)create_confirm_button=true;var proxyid=FlashProxy._next_proxy_id++;var entry={classes:[],swfurl:url,proxyid:proxyid,pending:true};if(FlashProxy._by_swfurl[url])FlashProxy._invalidate_entry(FlashProxy._by_swfurl[url]);FlashProxy._by_swfurl[url]=entry;FlashProxy._by_proxyid[proxyid]=entry;entry._container_id=
"proxy_container_"+proxyid;entry._object_id="proxy_swfobject_"+proxyid;var width="0";var height="0";var swfobject=new SWFObject(url,entry._object_id,width,height,"8","#F0F0F0");swfobject.addParam("allowscriptaccess","always");swfobject.addVariable("proxyid",proxyid.toString());swfobject.addVariable("namespace","FlashProxy");var elem=document.createElement("DIV");if(create_confirm_button){elem.style.position="absolute";elem.style.zIndex="9999";swfobject.addParam("style","z-index: 9999;");swfobject.addParam("width",
width);swfobject.addParam("height",height)}elem.id=entry._container_id;document.body.appendChild(elem);if(!swfobject.write(entry._container_id)){FlashProxy.flash_has_version=swfobject.installedVer.major+"."+swfobject.installedVer.minor;FlashProxy.error=true;return null}entry.swfobject=document.getElementById(entry._object_id);FPTrace("swfobject id is "+entry._object_id);entry.pending=false;return entry},_onproxyready:function(proxyid,classname){try{var entry=FlashProxy.find_by_proxyid(proxyid);FPTrace("_onproxyready: existing entry: "+
entry);if(!entry){FPDebug("no object for proxid "+proxyid+".  Checking for HTML element.");var elem=document.getElementById(proxyid);FPTrace("elem: "+elem);if(!elem||!elem.getproxy){FPTrace("Did not find HTML element for proxyid "+proxyid+" either.  Waiting a bit (elem \x3d "+elem+").");setTimeout(function(){FlashProxy._onproxyready(proxyid,classname)},0);FPTrace("timeout set");return}entry={swfobject:elem,proxyid:proxyid,classes:[]};FlashProxy._by_proxyid[proxyid]=entry;FPDebug('set FlashProxy._by_proxyid["'+
proxyid+'"] to entry containing swfobject\x3d'+entry.swfobject)}if(!entry.swfobject){setTimeout(function(){FlashProxy._onproxyready(proxyid,classname)},0);return}FPDebug("calling into swfobject: "+entry.swfobject);FPDebug("creating class FlashProxy."+classname);var jscode="FlashProxy."+classname+" \x3d "+entry.swfobject.getproxy(classname)+";";FPDebug("retrieved JS proxy code for "+classname);eval(jscode);FPDebug("FlashProxy."+classname+" created");entry.classes.push(classname);FlashProxy._by_classname[classname]=
entry;var waiters=FlashProxy._proxywaiters[classname];if(waiters){FPDebug(""+waiters.length+" waiters waiting for "+classname);for(var waiter;waiter=waiters.pop();)try{FPTrace("calling waiter: "+waiter.toString());waiter.success()}catch(ex){FPDebug("flash proxy 'whenclassready' handler for "+classname+" failed")}}FPTrace("onproxyready("+proxyid+", "+classname+") exiting");return true}catch(exc){FPDebug("_onproxyready caught: "+exc.message);setTimeout(function(){FlashProxy._onproxyready(proxyid,classname)},
0)}},_onproxyerror:function(classname){var waiters=FlashProxy._proxywaiters[classname];if(waiters){FPDebug(""+waiters.length+" waiters waiting for "+classname);for(var waiter;waiter=waiters.pop();)try{if(waiter.failure)waiter.failure()}catch(ex){FPDebug("flash proxy 'whenclassready' error handler for "+classname+" failed")}}},_next_proxy_id:1,_by_swfurl:{},_by_classname:{},_by_proxyid:{},_class_urls:{},_proxywaiters:{},_fire_event:function(ref,eventname,arg){function refire(){that._do_fire_event.call(that,
ref,eventname,arg)}var that=this;setTimeout(refire,1)},_do_fire_event:function(ref,eventname,arg){var obj=FlashProxy._ref_to_obj[ref];var handlers=obj._events[eventname];for(var i=0;handlers!=null&&i<handlers.length;i++)try{handlers[i](obj,arg)}catch(e){var msg='caught exception in "'+eventname+'" handler: ';msg+=e.message?e.message:e;if(e.stack)msg+="\n"+e.stack;FlashProxy.logerror(msg)}},_register_instance:function(ref,obj){if(FlashProxy._ref_to_obj[ref]){FlashProxy.logerror("flash proxy: trying to register an instance that already exists! (ref: "+
ref+")");return}FlashProxy._ref_to_obj[ref]=obj},logerror:function(str){if(typeof Log!="undefined"&&typeof Log.error!="undefined")Log.error("flash proxy error: "+str)},_confirmation_dialog:null,_confirmation_dialog_container:null,_confirm_restricted_api:function(proxyid,message,title,includeCancel){var entry=FlashProxy.find_by_proxyid(proxyid);var swfobject=FlashProxy.find_proxy(proxyid);var container=elt(entry._container_id);title=title||"Flash confirmation";$assert(swfobject&&container);if(includeCancel!=
true)includeCancel=false;FlashProxy._confirmation_dialog=Dialog.openTemplate(title,"flash_confirmation",{message:message,proxyid:proxyid,includeCancel:includeCancel},[]);FlashProxy._confirmation_dialog.cancelEvent.subscribe(function(){FlashProxy._confirmation_dialog=null;FlashProxy._dismiss_confirmation(proxyid)});FlashProxy._confirmation_dialog.dragEvent.subscribe(function(){swfobject.height="1px";swfobject.width="1px";container.style.top="0px";container.style.left="0px"});FlashProxy._confirmation_dialog.moveEvent.subscribe(function(){FlashProxy._position_confirmation_button(proxyid)})},
_position_confirmation_button:function(proxyid){var entry=FlashProxy.find_by_proxyid(proxyid);var swfobject=FlashProxy.find_proxy(proxyid);var container=elt(entry._container_id);var okimg=elt("flashconfirmok");$assert(swfobject&&container&&okimg);swfobject.height="31";swfobject.width="85";var setXYHack=function(elem,xy){var desired=[].concat(xy);Y.util.Dom.setXY(elem,desired);var actual=Y.util.Dom.getXY(elem);desired[0]+=desired[0]-Math.round(actual[0]);desired[1]+=desired[1]-Math.round(actual[1]);
Y.util.Dom.setXY(elem,desired)};container.style.zIndex=9999;var pos=Y.util.Dom.getXY(okimg);pos[0]+=2;pos[1]+=2;setXYHack(container,pos)},_hide_confirmation_dialog:function(proxyid){var entry=FlashProxy.find_by_proxyid(proxyid);var swfobject=FlashProxy.find_proxy(proxyid);var container=elt(entry._container_id);FlashProxy._confirmation_dialog_container=container;$assert(swfobject&&container);swfobject.height="1px";swfobject.width="1px";container.style.zIndex=-1;if(FlashProxy._confirmation_dialog){FlashProxy._confirmation_dialog.destroy();
FlashProxy._confirmation_dialog=null}},_dismiss_confirmation:function(proxyid){var entry=FlashProxy.find_by_proxyid(proxyid);var swfobject=FlashProxy.find_proxy(proxyid);var container=elt(entry._container_id);$assert(swfobject&&container);FlashProxy._hide_confirmation_dialog(proxyid);swfobject.cancel_confirmation()},_ref_to_obj:{},noFlashError:function(sitch){if(sitch=="upload"&&Browser.platform=="iphone"){Dialog.alert("Upload","To upload files, visit Bandcamp from a desktop computer.");return}var title=
"Flash Required";var message="In order to use this feature, you must have the Adobe Flash Player installed.";var situations={"share":"In order to embed the music player on another site, you must have the Adobe Flash Player installed.","player":"In order to use the music player, you must have the Adobe Flash Player installed.","upload":"In order to upload files, you must have the Adobe Flash Player installed.","download":"In order to download, you must have the Adobe Flash Player installed."};if(situations[sitch])message=
situations[sitch];Dialog.openTemplate(title,"flash_required",{title:title,message:message},Dialog.buttons.ok())},cleanUpHack:function(){if(FlashProxy._confirmation_dialog_container)Y.util.Dom.setXY(FlashProxy._confirmation_dialog_container,[0,0])}};FlashProxy.register_proxy(siteroot_current+"/js/shared/nugget2.swf",["Downloader","Uploader","SoundPlayer"]);FlashProxy.log_enable=function(str){for(var x in FlashProxy._by_proxyid)FlashProxy._by_proxyid[x].swfobject.log_enable(str)};
FlashProxy.set_clipboard=function(str){FlashProxy.whenclassready("Uploader",function(){FlashProxy._by_classname["Uploader"].swfobject.set_clipboard(str)})};
HTML5Player=function(){function DebugLog(name,flushInterval){this.buffer=[];this.flushInterval=flushInterval||1E4;this.tag=Math.round(Math.random()*Math.pow(2,32)).toString(16);this.name=name||"DebugLog";this.enable()}function HTML5Player(){var platform=Browser.platform;var browserMake=Browser.make;var browserType=Browser.type;var volumeCookie=Cookie.get("volume");if(volumeCookie)volumeCookie=parseFloat(volumeCookie,10);this._id=nextId;nextId++;this._options={debug:false,simulateEndedAndroid:browserMake==
"chrome"&&platform=="android",safeLoad:browserMake=="androidbrowser"&&platform=="android",playKick:browserMake=="androidbrowser"&&platform=="android"&&Browser.version[0]<4,loadStartKick:browserMake=="androidbrowser"&&platform=="android"&&Browser.version[0]>=4,deferPlayEvents:(browserMake=="chrome"||browserMake=="androidbrowser")&&platform=="android"||platform=="iphone",retryErrors:true,volume:volumeCookie||.7,deferredSeeks:false,resetOnStall:false,reloadOnSeek:false,simulateEndedSafari:false};if(HTML5Player.logEnabled()){this._debugLog=
new DebugLog("HTML5Player");this._options.debug=true}if(window.Url){var params=Url.parseQuery(location.search);for(var opt in this._options)if(params.hasOwnProperty(opt))if(opt=="volume"){var v=parseFloat(params[opt]);if(v)this._options[opt]=v}else this._options[opt]=!(params[opt]=="0"||params[opt]=="false")}this._handlers={state:[],time:[],loaded:[],info:[],volume:[]};this._listeners=[];this._volume=this._options.volume;this._recentpos=[];if(this._options.debug){var msg=["constructed; options: "];
for(var k in this._options)msg.push(k,"\x3d",this._options[k],"; ");this._info(msg.join(""))}this._createmedia();this._changestate(IDLE);if(Browser.platform=="iphone"){var that=this;window.addEventListener("popstate",function(){var recent=that._recentpos;if(that._state==PLAYING&&recent.length){that.pause();if(recent.length>1&&recent[recent.length-1]===0&&recent[recent.length-2]>0){var restorePos=recent[recent.length-2];that._warn("detected iOS page navigation bug; resetting playhead position to "+
restorePos);that._fire_event("time",{position:restorePos});recent.pop()}}})}if(this._options.safeLoad)this._nativeLoad=this._nativeLoadSafe}function _parseversion(str){var vparts=str.split(".");for(var i=0;i<vparts.length;i++)vparts[i]=Number(vparts[i]);return vparts}DebugLog.prototype.log=function(msg){var d=new Date;for(var ms=d.getMilliseconds().toString();ms.length<3;)ms="0"+ms;var timestamp=d.toTimeString().substring(0,8)+"."+ms;this.buffer.push(timestamp+" : "+msg)};DebugLog.prototype.flush=
function(){if(this.buffer.length>0){Log.debug("DebugLog flushing "+this.buffer.length+" messages to server");var messages=this.buffer;this.buffer=[];var data={tag:this.tag,name:this.name,messages:messages};$.ajax({url:"/api/debug/1/clientlog",type:"post",data:JSON.stringify(data),dataType:"json",success:function(result){Log.debug("posted client log")},failure:function(err){Log.error("failed to post client log: "+err)}})}};DebugLog.prototype.disable=function(){if(this.interval){window.clearInterval(this.interval);
this.interval=null}this.flush()};DebugLog.prototype.enable=function(){if(!this.interval){this.interval=window.setInterval(this.flush.bind(this),this.flushInterval);this.interval=null}};var nextId=1;HTML5Player.prototype={load:function(url){this._debug("load()");this._stallcount=0;this._errorRetryCount=0;this._loadedurl=url;this._wantstoplay=false;this._recentpos.length=0;if(!_useLocationHack){this._nativePause();this._nativeLoad();this._changestate(BUFFERING);this._nativeSrc(url);this._nativeLoad();
this._finishedloading=false;this._loadStartKicked=false;this._playingEventDeferred=false}},play:function(){this._debug("play()");if(_useLocationHack)window.location=this._loadedurl;else if(!this._wantstoplay){this._wantstoplay=true;this._nativePlay()}},pause:function(){this._debug("pause()");this._cancelPlayKick();this._wantstoplay=false;this._nativePause()},playpause:function(){this._debug("playpause()");switch(this._state){case PLAYING:case BUFFERING:this.pause();break;default:this.play()}},stop:function(){this._debug("stop()");
this._cancelPlayKick();this._wantstoplay=false;this._nativePause()},seek:function(seconds){this._debug("seek() to "+seconds);var performed_reload_seek=false;var that=this;if(this._options.reloadOnSeek&&this._mediaElem.src.substring(this._mediaElem.src.length-5)!="\x26nl\x3d1"){var already_buffered=false;for(var i=0;i<this._mediaElem.buffered.length;i++)if(this._mediaElem.buffered.start(i)<=seconds&&seconds<=this._mediaElem.buffered.end(i)){already_buffered=true;break}if(!already_buffered){this._debug("refreshing with non-rate-limited URL");
this._nativePause();this._nativeSrc(this._mediaElem.src+"\x26nl\x3d1");var seek_on_metadata_load=function(e){this.removeEventListener("loadedmetadata",seek_on_metadata_load);that._nativeSeek(seconds);that._nativePlay()};this._mediaElem.addEventListener("loadedmetadata",seek_on_metadata_load,false);this._nativeLoad();performed_reload_seek=true}}if(!performed_reload_seek)if(this._options.deferredSeeks){this._wantstoplay=true;switch(this._state){case PLAYING:case BUFFERING:this._debug("doing deferred seek during playback");
this._wantseek=true;this._wantpos=seconds;break;default:this._seek_inner(seconds)}}else this._seek_inner(seconds)},_seek_inner:function(seconds){if(this.position()==seconds)this._debug("seek: new position ("+seconds+") matches current, so taking no action");else try{this._nativeSeek(seconds)}catch(e){this._warn("caught error seeking -- perhaps your downloader does not support byte ranges? "+e)}this.play()},position:function(){return this._mediaElem&&this._mediaElem.currentTime},state:function(){return this._state},
setrate:function(r){this._mediaElem.playbackRate=r},vol_up:function(){this.setvol(this._volume+.05)},vol_down:function(){this.setvol(this._volume-.05)},setvol:function(vol){if(vol>1)vol=1;else if(vol<0)vol=0;if(this._volume!=vol){this._volume=vol;this._debug("setting media element volume to "+this._volume);try{this._mediaElem.volume=this._volume}catch(e){this._warn("caught exception setting volume: "+e)}}this._fire_event("volume",{volume:this._volume})},getvol:function(){return this._volume},onstate:function(handler){this._add_event_handler("state",
handler)},ontime:function(handler){this._add_event_handler("time",handler)},onloaded:function(handler){this._cancelReset();this._add_event_handler("loaded",handler)},oninfo:function(handler){this._add_event_handler("info",handler)},onvolume:function(handler){this._add_event_handler("volume",handler)},enableLog:function(doIt){if(doIt){this._options.debug=true;var DEBUG_LOG_TIMEOUT=1E3*60*60*24*7;Cookie.set("PlayerDebugLog",(new Date).valueOf()+DEBUG_LOG_TIMEOUT);if(!this._debugLog)this._debugLog=new DebugLog("HTML5Player")}else{Cookie.clear("PlayerDebugLog");
if(this._debugLog){this._debugLog.disable();this._debugLog=null}}},_createmedia:function(){this._mediaElem=document.createElement("audio");this._mediaElem.style.width="0px";this._mediaElem.style.height="0px";this._mediaElem.style.visibility="hidden";this._mediaElem.controls=false;document.body.appendChild(this._mediaElem);if(this._options.debug)for(var i=0;i<this._loggedEvents.length;i++)this._logevt(this._loggedEvents[i]);this._mediaElem.volume=this._volume;this._addlistener("loadstart",this._handle_loadstart,
this);this._addlistener("timeupdate",this._handle_timeupdate,this);this._addlistener("progress",this._handle_progress,this);this._addlistener("canplay",this._handle_canplay,this);this._addlistener("canplaythrough",this._handle_canplay,this);this._addlistener("durationchange",this._handle_durationchange,this);this._addlistener("playing",this._handle_playing,this);this._addlistener("pause",this._handle_pause,this);this._addlistener("ended",this._handle_ended,this);this._addlistener("stalled",this._handle_stalled,
this);this._addlistener("waiting",this._handle_waiting,this);this._addlistener("error",this._handle_error,this)},_loggedEvents:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],_logevt:function(name){this._addlistener(name,this._loghandler(name),this)},_destroymedia:function(){this._removelisteners();if(this._mediaElem){document.body.removeChild(this._mediaElem);
this._nativePause();this._mediaElem=null}},_addlistener:function(name,fn,instance){var handler=function(){fn.apply(instance,arguments)};this._listeners.push({name:name,handler:handler});this._mediaElem.addEventListener(name,handler,false)},_removelisteners:function(){if(!this._mediaElem)return;for(;this._listeners.length>0;){var info=this._listeners.pop();this._mediaElem.removeEventListener(info.name,info.handler,false)}},_handle_loadstart:function(arg){var media=this._mediaElem;if(this._options.loadStartKick&&
!this._loadStartKicked&&media.duration==1&&media.readyState==4){this._loadStartKicked=true;this._warn("loadstart: looks like Android Browser duration\x3d1 bug; kicking media.src...");this._nativeSrc(media.src)}},_handle_waiting:function(arg){this._debug("waiting")},_handle_timeupdate:function(arg){try{var media=this._mediaElem;if(this._options.deferredSeeks&&this._wantseek){this._debug("applying deferred seek");this._seek_inner(this._wantpos);this._wantseek=false}this._cancelPlayKick();if(this._recentpos.length==
5)this._recentpos.shift();this._recentpos.push(media.currentTime);if(this._playingEventDeferred&&this._state==BUFFERING){this._warn("Play event was deferred; simulating it now...");this._playingEventDeferred=false;this._handle_playing_inner()}var evtparams={position:media.currentTime};if(isFinite(media.duration)&&media.duration>0)evtparams.duration=media.duration;this._fire_event("time",evtparams);if(this._options.simulateEndedSafari&&this._mediaElem.ended)this._handle_ended_inner();if(!this._finishedloading){var amtLoaded=
this._amountLoaded();if(amtLoaded>=media.duration)this._finishedloading=true;if(amtLoaded!=this._lastloaded){this._lastloaded=amtLoaded;evtparams={loaded:amtLoaded};if(isFinite(media.duration))evtparams.total=media.duration;this._cancelReset();this._fire_event("loaded",evtparams)}}}catch(e){this._warn("exception in _handle_timeupdate: "+e)}},_handle_progress:function(){var media=this._mediaElem;if(this._options.simulateEndedAndroid&&this._state==PLAYING&&!media.paused&&!media.ended&&!isNaN(media.duration)){var rnd=
function(val){return Math.round(val*1E3)};var cur=rnd(media.currentTime);var dur=rnd(media.duration);var buf=rnd(this._amountLoaded());if(cur>0&&cur===dur&&cur===buf){this._warn("Did we just hit the Chrome/Android bug in which the 'ended' event isn't fired?");this._warn("Compensating by simulating the event ourselves...");this._handle_ended_inner()}}},_handle_ended:function(){this._debug("_handle_ended");if(!this._options.simulateEndedSafari)this._handle_ended_inner()},_handle_ended_inner:function(){this._debug("_handle_ended_inner");
try{this._wantstoplay=false;this._changestate(COMPLETED)}catch(e){this._warn("exception in _handle_ended: "+e)}},_scheduleReset:function(timeout){if(!this._options.resetOnStall)return;this._cancelReset();var that=this;this._warn("scheduling media reset in "+timeout+"ms");this._resetTimer=setTimeout(function(){that._resetTimer=null;that._warn("Resetting media (amtloaded \x3d "+that._amountLoaded()+")");that._nativeLoad()},timeout)},_cancelReset:function(){if(!this._options.resetOnStall)return;if(this._resetTimer){this._warn("canceling media reset due to load progress (amtloaded \x3d "+
this._amountLoaded()+")");clearTimeout(this._resetTimer);this._resetTimer=null}},_schedulePlayKick:function(timeout){if(!this._options.playKick)return;this._cancelPlayKick();var that=this;this._warn("scheduling playkick in "+timeout+"ms");this._playKickTimer=setTimeout(function(){that._warn("kicking");that._playKickTimer=null;that._nativePause();that._nativePlay();that._warn("kicked")},timeout)},_cancelPlayKick:function(){if(!this._options.playKick)return;if(this._playKickTimer){this._warn("canceling playkick timer");
clearTimeout(this._playKickTimer);this._playKickTimer=null}},_amountLoaded:function(){if(this._mediaElem.buffered.length>0)return this._mediaElem.buffered.end(this._mediaElem.buffered.length-1);return 0},_handle_stalled:function(){if(this._mediaElem.readyState==HAVE_ENOUGH_DATA)return;this._stallcount+=1;if(this._stallcount>MAX_STALLS){this._error("Too many stalls.  Giving up on this track.");this._nativePause();this._changestate(COMPLETED)}else{this._debug("stalled, readyState\x3d"+this._mediaElem.readyState+
", amtloaded\x3d"+this._amountLoaded());this._scheduleReset(7500)}},_handle_playing:function(){if(!(this._options.deferPlayEvents&&this._state==BUFFERING))this._handle_playing_inner();else{this._debug("deferring play event to the next timeupdate");this._playingEventDeferred=true}},_handle_playing_inner:function(){try{this._changestate(PLAYING)}catch(e){this._warn("exception in _handle_playing_inner: "+e)}},_handle_pause:function(){if(this._state===COMPLETED&&(this._options.simulateEndedSafari||this._options.simulateEndedAndroid)){this._debug("ignoring 'pause' event because state is COMPLETED");
return}if(this._mediaElem.paused)this._changestate(PAUSED)},_handle_canplaythrough:function(){this._handle_canplay()},_handle_canplay:function(){try{if(this._wantstoplay)this._nativePlay()}catch(e){this._warn("exception in _handle_canplay: "+e)}},_is_cloud_streaming_url:function(){var srcUrl=Url.toHash(this._mediaElem.src);var pathElems=srcUrl.pathname.split("/");if(pathElems.length==5&&pathElems[0]==""&&pathElems[1]=="stream"){var trackId=parseInt(pathElems[4],10);if(trackId!=NaN)return trackId;
else return null}else return null},_refresh_cloud_streaming_url:function(){var that=this;var oldUrl=this._mediaElem.src;$.ajax({url:"/api/stream/1/refresh",type:"get",data:{url:oldUrl},dataType:"json",success:function(result){var currentTrackId=that._is_cloud_streaming_url();if(currentTrackId==result.track_id){that._nativeSrc(result.url);that._nativeLoad()}}})},_handle_error:function(arg){var errorCode=this._mediaElem.error&&this._mediaElem.error.code;this._error("got native error event; error.code\x3d"+
errorCode);if(this._options.retryErrors)if(errorCode==this._mediaElem.error.MEDIA_ERR_SRC_NOT_SUPPORTED)if(this._errorRetryCount<5){this._errorRetryCount+=1;this._warn("assuming error is due to an expired stream URL and reloading; count\x3d"+this._errorRetryCount);var trackId=this._is_cloud_streaming_url();if(trackId!=null)this._refresh_cloud_streaming_url()}else{this._warn("exceeded maximum number of error retries; giving up on this track");this._nativePause();this._changestate(COMPLETED)}},_handle_durationchange:function(){this._schedulePlayKick(500)},
_loghandler:function(name){var self=this;return function(){var media=self._mediaElem;var buffered=null;try{buffered=media.buffered.end(media.buffered.length-1)}catch(e){}this._debug("[native] "+name+"; paused\x3d"+media.paused+"; ended\x3d"+media.ended+"; readyState\x3d"+media.readyState+"; duration\x3d"+media.duration+"; currentTime\x3d"+media.currentTime+"; buffered\x3d"+buffered)}},_isbuffering:function(){try{return this._mediaElem.readyState<HAVE_FUTURE_DATA}catch(e){}return false},_changestate:function(newstate){if(newstate==
PLAYING&&this._isbuffering())newstate=BUFFERING;if(newstate!=this._state){var oldstate=this._state;this._state=newstate;this._debug("state changed from "+oldstate+" to "+newstate);this._fire_event("state",{newstate:this._state,oldstate:oldstate})}},_fire_event:function(name,arg){var handlers=this._handlers[name];if(handlers)for(var i=0;i<handlers.length;i++)try{handlers[i](this,arg)}catch(e){this._warn('caught exception in handler for event "'+name+'": '+e)}},_add_event_handler:function(eventname,
handler){this._handlers[eventname].push(handler)},_nativeSrc:function(url){this._debug("[native] setting src to: "+url);this._mediaElem.src=url},_nativeLoad:function(){this._debug("[native] load()");this._mediaElem.load()},_nativeLoadSafe:function(){this._debug("[native] load() -- with exception handling");try{this._mediaElem.load()}catch(e){this._warn("Got exception when calling native load() -- assuming this is okay and continuing: "+e)}},_nativePlay:function(){this._debug("[native] play()");this._mediaElem.play()},
_nativePause:function(){this._debug("[native] pause()");this._mediaElem.pause()},_nativeSeek:function(position){this._debug("[native] setting currentTime to: "+position+"; previous position: "+this._mediaElem.currentTime);this._mediaElem.currentTime=position},_debug:function(str){if(this._options.debug)this._log("debug",str)},_info:function(str){this._log("info",str)},_warn:function(str){this._log("warn",str)},_error:function(str){this._log("error",str)},_log:function(level,str){if(this._debugLog)this._debugLog.log(level.toUpperCase()+
" - "+str);if(typeof Log!="undefined")Log[level]("HTML5Player-"+this._id+": "+str)}};var BUFFERING="BUFFERING";var PLAYING="PLAYING";var PAUSED="PAUSED";var IDLE="IDLE";var COMPLETED="COMPLETED";var HAVE_FUTURE_DATA=3;var HAVE_ENOUGH_DATA=4;var MAX_STALLS=20;var _useLocationHack=false;HTML5Player.supportedFormats=function(){function iphoneVersion(uastring){var match=uastring.match(/Version\/([0-9\.]*)/);if(!match)return null;return _parseversion(match[1])}var formats={};if(navigator.userAgent.indexOf("iPhone")!=
-1){var iphoneVer=iphoneVersion(navigator.userAgent);if(iphoneVer&&(iphoneVer[0]<4||iphoneVer[0]===4&&iphoneVer[1]===0&&(iphoneVer.length===2||iphoneVer[2]===0)))return{}}try{var media=document.createElement("audio");var canplay=media.canPlayType("audio/mpeg");formats["mp3-128"]=canplay=="probably"||canplay=="maybe";formats["mp3-v0"]=canplay=="probably"||canplay=="maybe";canplay=media.canPlayType('audio/mpeg; codecs\x3d"mp4a.40.2"');formats["aac-lo"]=canplay=="probably"||canplay=="maybe";if(!formats["aac-lo"]){canplay=
media.canPlayType('audio/mp4; codecs\x3d"mp4a.40.2"');formats["aac-lo"]=canplay=="probably"||canplay=="maybe"}canplay=media.canPlayType('audio/ogg; codecs\x3d"vorbis"');formats["vorbis-lo"]=canplay=="probably"||canplay=="maybe";canplay=media.canPlayType('audio/ogg; codecs\x3d"opus"');formats["opus-lo"]=canplay=="probably"||canplay=="maybe";if(formats["opus-lo"]&&navigator.userAgent.indexOf(" Chrome/")!=-1)formats["opus-lo"]=false}catch(e){}if(!formats){var match$$0=navigator.userAgent.toString().match(/Android ([0-9\.]*)/);
if(match$$0){var ver=_parseversion(match$$0[1]);if(ver[0]<2||ver[0]==2&&ver[1]<3){_useLocationHack=true;Log.debug("using location \x3c\x3d stream workaround");formats["mp3-128"]=true;formats["aac-lo"]=true}}}return formats};HTML5Player.needLocationHack=function(){var match=navigator.userAgent.toString().match(/Android ([0-9\.]*)/);if(!match)return false;var v=_parseversion(match[1]);return v[0]<3||v[0]==3&&v[1]<3};HTML5Player.enableLog=function(doIt){var DEBUG_LOG_TIMEOUT=1E3*60*60*24*7;if(doIt)Cookie.set("PlayerDebugLog",
(new Date).valueOf()+DEBUG_LOG_TIMEOUT);else Cookie.clear("PlayerDebugLog")};HTML5Player.logEnabled=function(){var cookie=Cookie.get("PlayerDebugLog");return cookie&&parseInt(cookie)>(new Date).valueOf()};return HTML5Player}();
var ImageUtils=function(){function dynamicURL(kind,image_id,format,is_https){if(!image_id)return TemplGlobals.static_siteroot+"/img/blank.gif";format=getFormat(format);var siteroot=ImageUtils.imageRoot(is_https);var ext;if(format.anim_ok)ext="";else if(format.file_format&&format.file_format!="original")ext="."+FORMAT_EXTENSIONS[format.file_format];else ext="";image_id=("000000000"+image_id).slice(-10);return siteroot+"/img/"+kind+image_id+"_"+format.id+ext}function getFormat(format){if(typeof format===
"object")return format;var fmts=TemplGlobals.image_formats;if(fmts)for(var i=0;i<fmts.length;++i)if(fmts[i].id==format||fmts[i].name==format)return fmts[i];Log.error("bad image format",format);return null}function calculateDimensions(width,height,format){format=getFormat(format);var format_width;var format_height;if(!format||format.resize_algo=="original"){format_width=width;format_height=height}else if(format.resize_algo=="thumb"){format_width=format.width;format_height=format.height}else if(format.resize_algo==
"fit")if(width<=format.width&&height<=format.height){format_width=width;format_height=height}else if(width/format.width>height/format.height){format_width=format.width;format_height=Math.round(height*(format.width/width))}else{format_width=Math.round(width*(format.height/height));format_height=format.height}else{Log.error("bad image resize algo",format);format_width=width;format_height=height}return{width:format_width,height:format_height}}var FORMAT_EXTENSIONS={"JPEG":"jpg","PNG":"png"};var returnVal=
{imageURL:function(image_id,format,is_https){return dynamicURL("",image_id,format,is_https)},artURL:function(art_id,format,is_https){return dynamicURL("a",art_id,format,is_https)},imageFormat:getFormat,imageDimensions:calculateDimensions,imageRoot:function(is_https){if("undefined"===typeof is_https)is_https=window.location.protocol==="https:";return is_https?TemplGlobals.image_siteroot_https:TemplGlobals.image_siteroot}};if("uploadImage"in window)returnVal.upload=uploadImage;return returnVal}();
var Sound={_callbacks:[],_status:null,_loadstarted:false,whenloaded:function(callback){Sound._showdebug("wl");if(!Sound._status){Sound._showdebug("init");Sound._callbacks.push(callback);Sound._load_wrapper()}else try{callback(Sound._status)}catch(e){}},_docallbacks:function(){for(;Sound._callbacks.length>0;)Sound._docallback(Sound._callbacks.pop())},_docallback:function(cb){try{cb(Sound._status)}catch(e){Log.error("caught error in Sound.whenloaded callback: "+e)}},_showdebug:function(text){var e=
document.getElementById("sounddebug");if(e)e.innerText=text},_load_wrapper:function(){Sound._status={success:true,subsystem:"wrapper",has_viz:"false"};Sound.SoundPlayer=WrapperSoundPlayer;Sound._docallbacks()}};
var FlashSound={_callbacks:[],_loadstarted:false,_status:null,whenloaded:function(callback){FlashSound._showdebug("wl");if(!FlashSound._status){FlashSound._showdebug("init");FlashSound._callbacks.push(callback);if(!FlashSound._loadstarted){FlashSound._loadstarted=true;FlashProxy.whenclassready("SoundPlayer",FlashSound._flashready,FlashSound._flashfailed)}}else try{callback(FlashSound._status)}catch(e){}},_docallbacks:function(){for(;FlashSound._callbacks.length>0;)FlashSound._docallback(FlashSound._callbacks.shift())},
_docallback:function(cb){try{cb(FlashSound._status)}catch(e){Log.error("caught error in FlashSound.whenloaded callback: "+e)}},_flashready:function(){Log.debug("flash is ready for sound!");FlashSound._status={success:true,subsystem:"flash"};FlashSound._showdebug("flash");FlashSound._docallbacks()},_showdebug:function(text){var e=document.getElementById("sounddebug");if(e)e.innerText=text},_flashfailed:function(){Log.debug("All sound subsystems failed to load.");FlashSound._status={success:false,error:"noflash"};
FlashSound._docallbacks();NuDialog.alert("Error","Unable to play audio.  Your browser must support native playback of MP3 or you must have the Adobe Flash Player installed.")}};
var WrapperSoundPlayer=function(){function WrapperSoundPlayer(){function make_lazy_stub(fname){return function(){var args=arguments;if(self._currentplayer=="html5")self._html5player[fname].apply(self._html5player,args);else{Log.debug("flash1 proxy method "+fname);FlashSound.whenloaded(function(){self._flashplayer[fname].apply(self._flashplayer,args)})}}}function make_simple_proxy(fname){return function(){var args=arguments;if(self._currentplayer=="html5")self._html5player[fname].apply(self._html5player,
args);else if(self._flashplayer)try{self._flashplayer[fname].apply(self._flashplayer,args)}catch(e){if(!self._loggedException){self._loggedException=true;Log.error("WrapperSoundPlayer proxy for "+fname+"(): caught exception: "+e)}}else Log.error("WrapperSoundPlayer proxy for "+fname+"(): no _soundplayer instance!")}}var self=this;self._html5player=null;self._flashplayer=null;self._html5formats=HTML5Player.supportedFormats();self._flashstate=null;self._currentplayer=null;self._handlers={state:[],time:[],
loaded:[],info:[],volume:[]};var formatsSupported=[];for(var format in self._html5formats)if(self._html5formats.hasOwnProperty(format)&&self._html5formats[format]==true)formatsSupported.push(format);if(formatsSupported.length>0){self._html5player=new HTML5Player;self._html5player.ontime(function(target,x){self._fire_event("time",x)});self._html5player.onstate(function(target,x){self._fire_event("state",x)});self._html5player.onloaded(function(target,x){self._fire_event("loaded",x)});self._html5player.oninfo(function(target,
x){self._fire_event("info",x)});self._html5player.onvolume(function(target,x){self._fire_event("volume",x)});self._currentplayer="html5"}self._add_event_handler=function(eventname,handler){self._handlers[eventname].push(handler)};self.onstate=function(handler){self._add_event_handler("state",handler)};self.ontime=function(handler){self._add_event_handler("time",handler)};self.onloaded=function(handler){self._add_event_handler("loaded",handler)};self.oninfo=function(handler){self._add_event_handler("info",
handler)};self.onvolume=function(handler){self._add_event_handler("volume",handler)};self._fire_event=function(name,arg){handlers=self._handlers[name];if(handlers)for(var i=0;i<handlers.length;i++)try{if(self._currentplayer=="html5")handlers[i](self._html5player,arg);else handlers[i](self._flashplayer,arg)}catch(e){Log.debug('caught exception in handler for event "'+name+'": '+e)}};self.createFlashPlayer=function(){self._flashstate="loaded";self._flashplayer=new FlashProxy.SoundPlayer;self._flashplayer.ontime(function(target,
x){self._fire_event("time",x)});self._flashplayer.onstate(function(target,x){self._fire_event("state",x)});self._flashplayer.onloaded(function(target,x){self._fire_event("loaded",x)});self._flashplayer.oninfo(function(target,x){self._fire_event("info",x)});self._flashplayer.onvolume(function(target,x){self._fire_event("volume",x)})};self.load=function(url,hq){var preferredformat=null;var preferredurl=null;if(typeof url==="string"){preferredurl=url;preferredformat="mp3-128"}else{var formats=["aac-lo",
"mp3-128","opus-lo","vorbis-lo"];if(hq)formats.unshift("mp3-v0");for(var i=0;i<formats.length;i++)if(self._html5formats[formats[i]]&&url[formats[i]]){preferredformat=formats[i];break}if(!preferredformat){var flashformats=["aac-lo","mp3-128"];if(hq)flashformats.unshift("mp3-v0");for(i=0;i<flashformats.length;i++)if(url[flashformats[i]]){preferredformat=flashformats[i];break}}preferredurl=url[preferredformat]}if(self._html5formats[preferredformat]){self._currentplayer="html5";self._html5player.load(preferredurl)}else{self._currentplayer=
"flash";if(self._flashplayer)self._flashplayer.load(preferredurl);else{Log.debug("WrapperSoundPlayer: HTML5 playback doesn't support "+preferredformat+", loading flash");self._flashstate="loading";FlashSound.whenloaded(function(){self.createFlashPlayer();self._flashplayer.load(preferredurl)})}}};var lazystubs=["play","pause","stop","seek"];var lazymap={};for(var i$$0=0;i$$0<lazystubs.length;i$$0++)lazymap[lazystubs[i$$0]]=true;for(var k in HTML5Player.prototype){if(k=="load")continue;if(k=="ontime")continue;
if(k=="onstate")continue;if(k=="onloaded")continue;if(k=="oninfo")continue;if(k=="onvolume")continue;if(typeof HTML5Player.prototype[k]=="function"&&k.substr(0,1)!="_")if(lazymap[k])self[k]=make_lazy_stub(k);else self[k]=make_simple_proxy(k)}}return WrapperSoundPlayer}();
var LazySound=function(){function LazySound(){function make_lazy_stub(fname){return function(){var args=arguments;self.whenInstanceReady(function(sp){sp[fname].apply(sp,args)})}}function make_simple_proxy(fname){return function(){var args=arguments;if(self._soundplayer)try{self._soundplayer[fname].apply(self._soundplayer,args)}catch(e){if(!self._loggedException){self._loggedException=true;Log.error("LazySound proxy for "+fname+"(): caught exception: "+e)}}else Log.error("LazySound proxy for "+fname+
"(): no _soundplayer instance!")}}var self=this;self._soundplayer=null;self._loggedException=false;self.whenInstanceReady=function(callback){Sound.whenloaded(function(status){if(status.success){if(!self._soundplayer)self._soundplayer=new Sound.SoundPlayer;callback(self._soundplayer)}else Log.error("LazySound: Sound.whenloaded failed: ",status)})};var lazystubs=["play","pause","stop","load","onstate","ontime","onloaded","oninfo","onvolume","seek"];var lazymap={};for(var i=0;i<lazystubs.length;i++)lazymap[lazystubs[i]]=
true;for(var k in HTML5Player.prototype)if(typeof HTML5Player.prototype[k]=="function"&&k.substr(0,1)!="_")if(lazymap[k])self[k]=make_lazy_stub(k);else self[k]=make_simple_proxy(k)}return LazySound}();
var CommUtils={beacon:function(url,args){return this._loadImage(url,args,true)},loadImage:function(url){return this._loadImage(url)},_loadImage:function(url,args,randomize,on_finish){var bcn=document.createElement("img");var save_my_bcn=bcn;bcn.style.display="none";bcn.onload=bcn.onerror=function(){var e$$0;try{bcn=null;if(on_finish)on_finish()}catch(e){}};if(randomize&&!args.rand)args.rand=Math.random().toString().substring(2);bcn.src=Url.addQueryParams(url,args);return save_my_bcn},zzz:null};
var Cookie={ALT_IDENTITY_PARAM:"BandcampIdentity",get:function(cookieName){$assert(Text.notEmpty(cookieName));var cookie=Cookie.getAll()[cookieName];if(cookie==null)cookie=null;return cookie},getAll:function(){function push(name,val){var existingVal=out[name];if(!existingVal)out[name]=val;else if(U.isArray(existingVal))existingVal.push(val);else out[name]=[existingVal,val]}var pairs=document.cookie.split(/;\s*/);var out={};for(var i=0;i<pairs.length;i++){var pair=pairs[i].split("\x3d");if(pair[1]){var paramName;
var paramValue;try{paramName=decodeURIComponent(pair[0]);paramValue=decodeURIComponent(pair[1])}catch(e){Log.error("Cookie.getAll: error when decoding URL parameter, skipping; ",e);continue}push(paramName,paramValue)}}return out},set:function(cookieName,cookieValue,maxAge,path,domain,secure){$assert(Text.notEmpty(cookieName));$assert(maxAge==null||U.isNumber(maxAge));if(cookieValue==null)cookieValue="";if(!path)path="/";if(!domain)domain=Cookie._secondLevelDomain();var expiresDate;if(maxAge!=null)expiresDate=
new Date((new Date).getTime()+maxAge*1E3);var enc=encodeURIComponent;var cookie=enc(cookieName)+"\x3d"+enc(cookieValue)+";path\x3d"+path+(domain!=null?";domain\x3d"+domain:"")+(expiresDate?";expires\x3d"+expiresDate.toUTCString():"")+(secure?";secure":"");document.cookie=cookie;return cookie},clear:function(cookieName,path,domain,secure){return Cookie.set(cookieName,"",-1,path,domain,secure)},_secondLevelDomain:function(){var parts=location.hostname.split(".");var len=parts.length;$assert(len>=1);
if(len==1)return null;return"."+parts[len-2]+"."+parts[len-1]}};var HiddenParams={};
(function(){var cookie=Cookie.get("hiddenParams");if(cookie){Cookie.clear("hiddenParams");var query$$0=Url.parseQuery(cookie);if(query$$0)HiddenParams=query$$0}if(HiddenParams.get||HiddenParams.hide)Log.warn("'get' is already in HiddenParams; not implementing v2 client-side hidden params");else{HiddenParams.hide=function(keys){if(!Array.isArray(keys))keys=[keys];Log.debug("hiding params ["+keys.join(", ")+"] from url query");var keySet={};keys.forEach(function(k){keySet[k]=true});var query=Url.parseQueryArray(location.search);
var remaining=[];for(var i=0;i<query.length;i++)if(!keySet[query[i].name])remaining.push(query[i]);var newUrl=location.pathname;if(remaining.length>0)newUrl+="?"+Url.joinQueryArray(remaining);newUrl+=location.hash;if(window.history&&window.history.replaceState)history.replaceState(null,document.title,newUrl)};HiddenParams.get=function(key,hide){if(!HiddenParams.hasOwnProperty(key)){if(hide===undefined)hide=true;var query=Url.parseQueryArray(location.search);var value;for(var i=0;i<query.length;i++)if(query[i].name===
key){value=query[i].value;break}Log.debug("got param "+key+"\x3d"+value+" from url query");HiddenParams[key]=value;if(hide)HiddenParams.hide(key)}return HiddenParams[key]}}})();if(!window.Cookie)throw"expected Cookie library";
Cookie.CommChannel=function(channelName,uniquify){$assert(Text.notEmpty(channelName));this._id=Math.round(Math.random()*1E9);if(uniquify)channelName+=this._id;this._channelName=channelName;var namePrefix=Cookie.CommChannel.COOKIE_NAME_PREFIX+channelName;this._cookieName=namePrefix+"_"+this._id;this._namePattern=new RegExp("^"+Text.regexpEscape(namePrefix)+"_(\\d+)$");this._queue={last:0,msgs:[]};this._lastSeen={};this._scanTimer=null;Cookie.clear(this._cookieName)};Cookie.CommChannel.EVENT_NAME="cookiecomm_message";
Cookie.CommChannel.COOKIE_NAME_PREFIX="_comm_";Cookie.CommChannel.MAX_QUEUE_SIZE=5;Cookie.CommChannel.SCAN_TIMEOUT=250;Cookie.CommChannel.COOKIE_MAX_AGE=5;
Cookie.CommChannel.prototype={getName:function(){return this._channelName},startListening:function(){if(!this._scanTimer){var that=this;var timerCallback=function(){that._scanAllQueues()};this._scanTimer=setInterval(timerCallback,Cookie.CommChannel.SCAN_TIMEOUT);Log.info("Cookie comm channel "+this.getName()+" started listening.")}},stopListening:function(){if(this._scanTimer){clearInterval(this._scanTimer);this._scanTimer=null;Log.info("Cookie comm channel "+this.getName()+" stopped listening.")}},
subscribe:function(callback){$(document).on(Cookie.CommChannel.EVENT_NAME+"_"+this._id,callback)},unsubscribe:function(callback){$(document).off(Cookie.CommChannel.EVENT_NAME+"_"+this._id,callback)},send:function(msgName){$assert(U.isString(msgName));var msg=Iter.collect(arguments);Log.debug("Cookie comm channel "+this.getName()+" sending message "+msg[0],msg);for(var i=msg.length-1;i>0;i--)if(msg[i]==null)msg.pop();else break;var msgs=this._queue.msgs;msgs.push(msg);this._queue.last++;if(msgs.length>
Cookie.CommChannel.MAX_QUEUE_SIZE)this._queue.msgs=msgs.slice(1);if(this._writeTimeout)clearTimeout(this._writeTimeout);var self=this;this._writeTimeout=setTimeout(function(){self._writeQueue()},0)},cleanup:function(){Cookie.clear(this._cookieName);this.stopListening();this._lastSeen=this._queue=null},_writeQueue:function(){var json=JSON.stringify(this._queue);Cookie.set(this._cookieName,json,Cookie.CommChannel.COOKIE_MAX_AGE)},_scanAllQueues:function(){var cookies=Cookie.getAll();for(var name in cookies){var match=
this._namePattern.exec(name);if(!match)continue;var queueId=match[1]-0;if(queueId===this._id)continue;var json=cookies[name];$assert(!U.isArray(json),"we expect only one cookie per name");var queue=eval("("+json+")");this._scanOneQueue(queueId,queue)}},_scanOneQueue:function(queueId,queue){var lastIndex=queue.last;$assert(U.isNumber(lastIndex));var lastSeenIndex=this._lastSeen[queueId]||0;var newCount=lastIndex-lastSeenIndex;if(newCount>0){var newMsgs=queue.msgs.slice(-newCount);$assert(newMsgs.length);
this._lastSeen[queueId]=lastIndex;for(var i=0;i<newMsgs.length;i++){var msgArr=newMsgs[i];Log.debug("Cookie comm channel "+this.getName()+" received from "+queueId+" message "+msgArr[0],msgArr);msgArr.unshift(queueId);$.event.trigger(Cookie.CommChannel.EVENT_NAME+"_"+this._id,[msgArr]);if(!this._scanTimer)break}}}};
var Stats=function(){return{RECORD_URL:"/stat_record",hash_code:function(str){if(!str)return 0;var h=0;var len=str.length;for(var i=0;i<len;i++){var ch=str.charCodeAt(i);h=(h<<5)-h+ch;h|=0}if(h<0)h=4294967295+h+1;return h.toString(16)},record_sendbeacon:function(args){if(!args.band_id&&window.BandData)args.band_id=BandData.id;args.uac=Stats.hash_code(navigator.userAgent);if(navigator.sendBeacon){args.rand="b"+Math.round(Math.random()*1E16).toString();var url=siteroot_current+Stats.RECORD_URL;url=
Url.addQueryParams(url,args);navigator.sendBeacon(url)}else Stats.record(args)},record:function(args){var pd=$("#pagedata").data();var disableStats=pd&&pd.blob&&pd.blob.disable_stats;if(disableStats)if(Array.isArray(disableStats)){if(disableStats.includes(args.kind))return}else return;if(!args.band_id&&window.BandData)args.band_id=BandData.id;try{CommUtils.beacon(siteroot_current+Stats.RECORD_URL,args)}catch(e){}},_recorded_clicks:{},record_click_once:function(click){if(!Stats._recorded_clicks[click]){Stats._recorded_clicks[click]=
true;Stats.record({kind:"click",click:click})}},share_menu_click:function(variant){if(variant=="wordpress")variant="wordpress.com";Stats.record({kind:"share menu",click:variant})}}}();
Stats.PhasedStat=function(){function PhasedStat(params,phase){this._params=params;this._params.phase=phase;this._params.reference_num=Math.round(Math.random()*1E9);Stats.record(this._params)}PhasedStat.prototype={change_phase:function(phase){this._params.phase=phase;Stats.record(this._params)},done:function(){this.change_phase("complete")},error:function(info){this._params.info=info;this.change_phase("error")},add_params:function(params){this._params=this.merge(this._params,params)},merge:function(a,
b){var result={};for(var i in a)result[i]=a[i];for(i in b)result[i]=b[i];return result}};return PhasedStat}();var Player={};
Player.TrackInfo=function(){function TrackInfo(hash){this.update(hash)}TrackInfo.prototype={update:function(hash){var props=PROPS;for(var i=0;i<props.length;i++)this[props[i]]=hash[props[i]];return this},is_playable:function(){return!!this.file},is_busy:function(){return this.encoding_pending&&!this.encoding_error},mark_as_capped:function(){this["is_capped"]=true},copy:function(){var result={};var props=PROPS;for(var i=0;i<props.length;i++)result[props[i]]=this[props[i]];return result}};TrackInfo.is_same=
function(trackinfo_a,trackinfo_b){var props=PROPS;for(var i=0;i<props.length;i++)if(trackinfo_a[props[i]]!=trackinfo_b[props[i]])return false;return true};var PROPS=["tracknum","file","encoding_error","encoding_pending","title","title_link","id","track_license_id","has_lyrics","has_info","is_downloadable","free_album_download","has_free_download","duration","private","album_private","artist","album_preorder","unreleased_track","alt_link","continuous","video_source_type","video_caption","video_id",
"video_mobile_url","is_capped"];return TrackInfo}();
Player.Playlist=function(){function Playlist(player,playing_from,referer,options){options=options||{};this._options=options;this._player=player;this._playlist=[];this._playing_from=playing_from;if(options.url_params&&options.url_params.esig&&(options.url_params.album||options.url_params.track)){referer+="\x26esig\x3d"+options.url_params.esig+"\x26rsig\x3d"+options.url_params.rsig+(options.url_params.album?"\x26album\x3d"+options.url_params.album:"\x26track\x3d"+options.url_params.track);this._url_referrer=
options.url_params.url_referrer}this._referer=referer;this._track=0;this._loadedtrack=-1;this._loadpercent=0;this._duration=null;this._state="IDLE";this._unloaded=true;this._scrubbed=false;this._trackstate=!options.no_trackstate;this._trackchanged=EventSender.create(this,"trackchanged");this._trackplayed=EventSender.create(this,"trackplayed");this._trackcapped=EventSender.create(this,"trackcapped");this._scrubbedback=EventSender.create(this,"scrubbedback");this._completedplay=EventSender.create(this,
"completedplay");this._playlistchanged=EventSender.create(this,"playlistchanged");this._statechanged=EventSender.create(this,"statechanged");this._loaded=EventSender.create(this,"loaded");this._timechanged=EventSender.create(this,"time");this.first_playable_track=-1;this.last_playable_track=-1;this._ui_listeners=new Object;this._usecomm=true;var pageData=$("#pagedata").data("blob")||{};this._stream_buffer_duration_stats=pageData.cfg&&pageData.cfg.stream_buffer_duration_stats||null;this._buffering_start_time=
null;var that=this;this._player.onstate(function(target,arg){if(that._unloaded)return;that._handle_state({oldstate:that._state,newstate:arg.newstate})});this._player.ontime(function(target,arg){if(that._unloaded)return;that._handle_time(arg)});this._player.onloaded(function(target,arg){if(that._unloaded)return;that._handle_load(arg)});if(!Playlist.coordinator)Playlist.coordinator=new Player.PlaylistCoordinator;Playlist.coordinator.add(this)}Playlist.prototype={getoption:function(key){return this._options[key]},
add_track:function(trackinfo){trackinfo=new Player.TrackInfo(trackinfo);if(this._url_referrer&&trackinfo.file)for(var i in trackinfo.file)trackinfo.file[i]+="\x26urlref\x3d"+document.URL.replace(/\&/g,"/");var result=this._playlist.push(trackinfo)-1;this._playlist[result].tracknum=result;if(trackinfo.is_playable()){if(this.first_playable_track==-1){this.first_playable_track=result;this._track=result}this.last_playable_track=result}this._playlistchanged();return result},set_initial_track:function(i){if(this._playlist[i]&&
this._playlist[i].is_playable())this._track=i},update_trackinfo:function(i,trackinfo){trackinfo.tracknum=i;trackinfo=this._playlist[i].update(trackinfo);this._loadedtrack=-1;if(trackinfo.is_playable()){if(this.first_playable_track==-1||i<this.first_playable_track)this.first_playable_track=i;if(this.last_playable_track==-1||i>this.last_playable_track)this.last_playable_track=i}else{if(i==this.first_playable_track){this.first_playable_track=-1;for(var j=i+1;j<this._playlist.length;j++)if(this._playlist[j].is_playable()){this.first_playable_track=
j;break}}if(i==this.last_playable_track){this.last_playable_track=-1;for(j=i-1;j>=0;j--)if(this._playlist[j].is_playable()){this.last_playable_track=j;break}}}this._playlistchanged();if(this._state=="BUSY"&&trackinfo.is_playable())this.play()},playpause:function(){var result=null;switch(this._state){case "IDLE":case "COMPLETED":case "PAUSED":this.play();result=1;break;case "PLAYING":case "BUFFERING":this._player.pause();this._comm_stop();result=-1;break;case "BUSY":this._player.stop();this._comm_stop();
this._handle_state({newstate:"IDLE",oldstate:this._state});result=0;break}return result},play:function(){var tinfo=this._playlist[this._track];if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);return}switch(this._state){case "IDLE":case "COMPLETED":case "BUSY":Log.debug("playlist loading track "+this._track);if(!tinfo)break;for(;!tinfo.is_playable()&&this._track<this.last_playable_track;){this._track++;tinfo=this._playlist[this._track]}if(!tinfo.is_playable()&&this._playlist.length==
1&&tinfo.encoding_pending)this._handle_state({newstate:"BUSY",oldstate:this._state});else if(this._playlist[this._track].file){this._load();this._player.play();if(this._usecomm)try{this._comm_start();this._stop_other_players()}catch(e){}}break;case "PAUSED":case "BUFFERING":this._player.play();if(this._usecomm)try{this._comm_start();this._stop_other_players()}catch(e){}break}var idx=this._track;this._trackplayed(idx)},pause:function(){switch(this._state){case "PLAYING":case "BUFFERING":this._player.pause();
this._comm_stop();break;case "BUSY":this._player.stop();this._comm_stop();this._handle_state({newstate:"IDLE",oldstate:this._state});break}},stop:function(){this._player.stop();this._handle_state({newstate:"IDLE",oldstate:this._state})},seek:function(pos){this._unloaded=false;var tinfo=this._playlist[this._track];if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);return}if(pos<=2&&this._playstat==null){tinfo=this._playlist[this._track];if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);
return}else if(tinfo)this._scrubbedback(tinfo.id);this._scrubbed=true}this._player.seek(pos)},play_track:function(num,pos){var tinfo=this.get_track_info(num);if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);return}if(this._loadedtrack!=num){this._state="IDLE";this._player.stop();this._track=num;this._load()}this._unloaded=false;if(pos!=null)this.seek(pos);else this.play()},percent_loaded:function(){return this._loadpercent||0},position:function(){return this._position},duration:function(){if(this._duration!=
null)return this._duration;else{var current_track=this.get_track_info();if(current_track)return current_track.duration;return 0}},init_complete:function(forceCue){if(this._trackstate&&this._loadstate());else if(forceCue||this._track>0)this._trackchanged(this._playlist[this._track])},register_listener:function(event_name,listener){var evlisteners=this._ui_listeners[event_name];if(evlisteners){$assert($.isArray(evlisteners),"expected array of event listeners");evlisteners.push(listener)}else{evlisteners=
new Array;evlisteners.push(listener);this._ui_listeners[event_name]=evlisteners}},player:function(){return this._player},unload:function(){this.stop();this._unloaded=true;this._playlist=[];this._track=0;this._loadedtrack=-1;this._loadpercent=0;this._position=0;this.first_playable_track=-1;this.last_playable_track=-1;this._playlistchanged();this._handle_state({newstate:"IDLE",oldstate:this._state})},load:function(tracks){this.unload();for(var i=0;i<tracks.length;i++)this.add_track(tracks[i])},_reset:function(){this.stop();
this._track=this.first_playable_track;this._trackchanged(this._playlist[this._track]);this._loadedtrack=-1},_handle_state:function(arg){if(this._state==arg.newstate)return;if(!(arg.newstate=="PLAYING"||arg.newstate=="BUFFERING")){if(arg.newstate!="PAUSED")this._position=0;this._clearstate()}this._state=arg.newstate;if(arg.newstate=="COMPLETED"&&(arg.oldstate=="PLAYING"||arg.oldstate=="BUFFERING"||arg.oldstate=="PAUSED")){if(!this.seeking)if(this._track+1<=this.last_playable_track){this._state="IDLE";
this._player.stop();var current_track=this.get_track_info();if(current_track&&current_track.continuous==false)this._statechanged(arg);else this.next_track()}else{this._track=0;this._loadedtrack=-1;this._statechanged(arg);this._trackchanged(this._playlist[this.first_playable_track])}}else this._statechanged(arg);if(this._stream_buffer_duration_stats==true)if(arg.newstate=="BUFFERING"&&(arg.oldstate=="IDLE"||arg.oldstate=="COMPLETED"))this._buffering_start_time=Date.now();else if(this._buffering_start_time!=
null&&arg.newstate=="PLAYING"){buffering_duration=Date.now()-this._buffering_start_time;this._buffering_start_time=null;if(this._playstat)this._playstat.report_stream_buffer_duration(buffering_duration,this._options.hq)}},_handle_load:function(arg){if(arg.total==0)this._loadpercent=0;else this._loadpercent=100*arg.loaded/arg.total;this._loaded(this._loadpercent)},_handle_time:function(arg){if(this._trackstate)this._savestate(arg.position);this._position=arg.position;this._duration=arg.duration;this._timechanged(arg);
var trackinfo=this._playlist[this._track];if(this._playstat&&arg.duration>0)if(!this._playstat.play_progress(arg.position,arg.duration)){this._playstat=null;if(trackinfo&&trackinfo!="undefined")this._completedplay(trackinfo.id)}var is_complete=Player.PlayStat.is_complete(arg.position,arg.duration);if(is_complete&&this._scrubbed){this._scrubbed=false;if(trackinfo&&trackinfo!="undefined")this._completedplay(trackinfo.id,true)}},prev_track:function(){var idx=this._track;do idx--;while(idx>=0&&!this._playlist[idx].file);
if(idx==-1)idx=0;this._track=idx;if(this._isplaying()){this._state="IDLE";this._player.stop()}this.play()},next_track:function(){var idx=this._track;do idx++;while(idx<this._playlist.length&&!this._playlist[idx].file);if(idx==this._playlist.length)idx=0;this._track=idx;if(this._isplaying()){this._state="IDLE";this._player.stop()}this.play()},get_state:function(){return this._state},get_track:function(){return this._track},get_track_info:function(index){if(this._playlist.length==0)return null;if(typeof index!=
"undefined")return this._playlist[index].copy();return this._playlist[this._track].copy()},cap_playback_for_track:function(track_id){for(var i=0;this._playlist&&i<this._playlist.length;i++){var ti=this._playlist[i];if(ti.id==track_id){ti.mark_as_capped();break}}},length:function(){return this._playlist.length},_notify_listeners:function(notification,idx){var listeners=this._ui_listeners[notification];if(listeners)for(var i=listeners.length-1;i>=0;i--)listeners[i](idx)},_load:function(){if(this._loadedtrack==
this._track){this.seek(0);return}this._loadedtrack=this._track;this._unloaded=false;this._player.load(this._playlist[this._track].file,this._options.hq);this._loadpercent=0;var trackinfo=this._playlist[this._track];this._trackchanged(trackinfo);this._playstat=new Player.PlayStat(trackinfo,this._playing_from,this._referer);this._scrubbed=false},_isplaying:function(){return this._state=="PLAYING"||this._state=="PAUSED"||this._state=="BUFFERING"},_managestate:Browser.platform!="iphone",_loadstate:function(){if(!this._managestate)return false;
Log.debug("reading/clearing playlist state");var used_saved_state=false;try{var state=Cookie.get(COOKIE_NAME);Cookie.clear(COOKIE_NAME);if(state=JSON.parse(state))for(var i=0;i<this._playlist.length;i++)if(this._playlist[i].id==state.track_id){Log.debug("found player state, playing track "+i+" at pos "+state.pos);this.play_track(i,state.pos);used_saved_state=true;break}}catch(e){}return used_saved_state},_clearstate:function(){if(!this._managestate)return;try{Cookie.clear(COOKIE_NAME)}catch(e){}},
_savestate:function(pos){if(!this._managestate||this._state!="PLAYING"&&this._state!="BUFFERING")return;var track_id=this._playlist[this._track].id;if(Math.abs(this._saved_pos-pos)>SAVE_LATENCY||track_id!=this._saved_track_id){this._saved_track_id=track_id;this._saved_pos=pos;var params={track_id:track_id,pos:pos};try{var value=JSON.stringify(params);Cookie.set(COOKIE_NAME,value,COOKIE_LIFE)}catch(e){}}},_comm_start:function(){if(!this._comm){this._comm=new Cookie.CommChannel("playlist");this._comm.subscribe($.proxy(this._comm_recv,
this))}this._comm.startListening()},_comm_stop:function(){if(this._comm)this._comm.stopListening()},_comm_recv:function(event,args){switch(args[1]){case "stop":Log.debug("received cookie comm stop command.  stopping.");this.stop();break}},_stop_other_players:function(){this._comm.send("stop")}};var COOKIE_NAME="playlist_state";var COOKIE_LIFE=30;var SAVE_LATENCY=1;var PLAY_TRACK="play_track";Playlist.PLAY_TRACK=PLAY_TRACK;return Playlist}();
Player.PlaylistCoordinator=function(){function constructor(){this._playlists=[];this._playingcount=0;this._playing=EventSender.create(this,"playing");this._stopped=EventSender.create(this,"stopped")}constructor.prototype.add=function(pl){var self=this;pl.onstatechanged(function(arg){self._handle_playlist_statechanged(pl,arg)});this.onplaying(function(playingplaylist){if(pl!=playingplaylist)if(pl.getoption("savepos"))pl.pause();else pl.stop()})};constructor.prototype._handle_playlist_statechanged=
function(playlist,arg){var isplaying=arg.newstate=="PLAYING"||arg.newstate=="BUFFERING";var wasplaying=arg.oldstate=="PLAYING"||arg.oldstate=="BUFFERING";if(isplaying&&!wasplaying)this._playingcount++;else if(wasplaying&&!isplaying){this._playingcount--;if(this._playingcount==0)this._stopped()}if(isplaying)this._playing(playlist)};return constructor}();
Player.PlayStat=function(){function PlayStat(trackinfo,playing_from,referer){params={kind:"track play",track_id:trackinfo.id,track_license_id:trackinfo.track_license_id,from:playing_from,from_url:referer||location.toString()};_super.call(this,params,"started")}var _super=Stats.PhasedStat;for(var k in Stats.PhasedStat.prototype)PlayStat.prototype[k]=Stats.PhasedStat.prototype[k];PlayStat.prototype.play_progress=function(secs_played,secs_total){var partial=PlayStat.is_partial(secs_played,secs_total);
var complete=PlayStat.is_complete(secs_played,secs_total);if(!this._partial_sent&&partial){this._partial_sent=true;this.change_phase("partial")}if(!this._complete_sent&&complete){this._complete_sent=true;this.change_phase("complete");return false}return true};PlayStat.is_partial=function(secs_played,secs_total){var SKIP_WINDOW=10;var is_it=false;if(secs_played&&secs_total){partial=secs_total*SKIP_WINDOW/100;is_it=secs_played>partial}return is_it};PlayStat.is_complete=function(secs_played,secs_total){var COMPLETE_WINDOW=
10;var is_it=false;if(secs_played&&secs_total){complete=secs_total*(100-COMPLETE_WINDOW)/100;is_it=secs_played>complete}return is_it};PlayStat.prototype.report_stream_buffer_duration=function(duration,hq){Stats.record({kind:"stream buffer duration",duration_ms:duration,is_hq:hq});return true};return PlayStat}();
var Color={isDark:function(hexcolor){var rgb=this.hex2rgb(hexcolor);return this.rgb2hsl(rgb)[2]<.5},lowContrast:function(bgcolor,fgcolor,min_ratio){if(min_ratio===undefined)min_ratio=3;var lighter;var darker;if(this.luminance(fgcolor)>this.luminance(bgcolor)){lighter=this.luminance(fgcolor);darker=this.luminance(bgcolor)}else{lighter=this.luminance(bgcolor);darker=this.luminance(fgcolor)}ratio=(lighter+.05)/(darker+.05);if(ratio<min_ratio)return true;return false},luminance:function(hexcolor){var rgb=
this.hex2rgb(hexcolor);var R;var G;var B;for(var i=0;i<rgb.length;i++)if(rgb[i]<=.03928)rgb[i]=rgb[i]/12.92;else rgb[i]=Math.pow((rgb[i]+.055)/1.055,2.4);R=rgb[0];G=rgb[1];B=rgb[2];return.2126*R+.7152*G+.0722*B},rgb2hex:function(rgb){var r=Math.round(rgb[0]*255);var g=Math.round(rgb[1]*255);var b=Math.round(rgb[2]*255);return(r<16?"0":"")+r.toString(16)+(g<16?"0":"")+g.toString(16)+(b<16?"0":"")+b.toString(16)},hex2rgb:function(color){color=color.replace(/^#/,"");if(color.length==6)return[parseInt("0x"+
color.substring(0,2))/255,parseInt("0x"+color.substring(2,4))/255,parseInt("0x"+color.substring(4,6))/255];else if(color.length==3)return[parseInt("0x"+color.substring(0,1))/15,parseInt("0x"+color.substring(1,2))/15,parseInt("0x"+color.substring(2,3))/15]},hsl2rgb:function(hsl){var m1;var m2;var r;var g;var b;var h$$0=hsl[0];var s=hsl[1];var l=hsl[2];m2=l<=.5?l*(s+1):l+s-l*s;m1=l*2-m2;var hueToRGB=function(m1,m2,h){h=h<0?h+1:h>1?h-1:h;if(h*6<1)return m1+(m2-m1)*h*6;if(h*2<1)return m2;if(h*3<2)return m1+
(m2-m1)*(.66666-h)*6;return m1};return[hueToRGB(m1,m2,h$$0+.33333),hueToRGB(m1,m2,h$$0),hueToRGB(m1,m2,h$$0-.33333)]},rgb2hsl:function(rgb){var min;var max;var delta;var h;var s;var l;var r=rgb[0];var g=rgb[1];var b=rgb[2];min=Math.min(r,Math.min(g,b));max=Math.max(r,Math.max(g,b));delta=max-min;l=(min+max)/2;s=0;if(l>0&&l<1)s=delta/(l<.5?2*l:2-2*l);h=0;if(delta>0){if(max==r&&max!=g)h+=(g-b)/delta;if(max==g&&max!=b)h+=2+(b-r)/delta;if(max==b&&max!=r)h+=4+(r-g)/delta;h/=6}return[h,s,l]}};
var EmbedCode=LangUtils.makeclass({ctor:function(embeddata){this._size="venti";this._isdemo=false;this._scriptAccess="never";this._embedData=embeddata;this._customLayout=null;this._customWidth=null;this._customHeight=null;this._variant="other";this._vis=null},prototype:{colors:{bgcolor:"#FFFFFF",linkcolor:"#0687f5"},getParams:function(){if(!this._embedData)throw"you must set embed_info before you can get the embed code hash";var result={variant:this._variant,url:this._embedData.swf_base_url+"/EmbeddedPlayer",
urlbase:this._embedData.swf_base_url,params:[{name:"quality",value:"high"},{name:"allowNetworking",value:"always"},{name:"wmode",value:"transparent"}],url_args:[]};if(this._forceflash)result.url+=".swf";var scriptaccess="never";var isAlbum=this._embedData.tralbum_param.name=="album";result.url_args.push(this._embedData.tralbum_param);var embed_data_params=["tralbum_param","art_id","linkback","title","artist","album_title"];for(var i=0;i<embed_data_params.length;i++)result[embed_data_params[i]]=this._embedData[embed_data_params[i]];
if(this._customLayout){var layouturl=EmbedCode.encodeLayoutURL(this._customLayout);EmbedCode.pushParam(result,"url_args","layout",layouturl);result.layout=layouturl;result.width=this._customWidth;result.height=this._customHeight}else{if(this._customWidth&&this._customHeight){result.width=this._customWidth;result.height=this._customHeight;result.include_dimensions=true}else{var dims=EmbedCode.getDims(this._size,isAlbum,this._variant);if(!dims)throw"failed to find layout: "+this._size+"/"+this._variant;
result.width=dims.w;result.height=dims.h}result.size=this._size;EmbedCode.pushParam(result,"url_args","size",this._size)}var bgcolor=this.colors.bgcolor.replace(/^#/,"");var linkcolor=this.colors.linkcolor.replace(/^#/,"");result.bgcolor=bgcolor;result.bgcolor_css=EmbedCode._hex_to_rgb(bgcolor);EmbedCode.pushParam(result,"params","bgcolor","#"+bgcolor);EmbedCode.pushParam(result,"url_args","bgcol",bgcolor);result.linkcolor=linkcolor;result.linkcolor_css=EmbedCode._hex_to_rgb(linkcolor);EmbedCode.pushParam(result,
"url_args","linkcol",linkcolor);if(this._isDemo){if(this._variant=="wordpress")result.variant="other";result.classname="bcembed"+Math.round(Math.random()*1E4);result.doproxy=true;scriptaccess="always";EmbedCode.pushParam(result,"url_args","debug","true")}if(this._vis)EmbedCode.pushParam(result,"url_args","vis",this._vis);if(this._transparent)EmbedCode.pushParam(result,"url_args","transparent","true");if(this._size=="biggie"){if(this._notracklist){result.notracklist="true";EmbedCode.pushParam(result,
"url_args","notracklist","true")}if(this._packageid){result.package=this._packageid;EmbedCode.pushParam(result,"url_args","package",this._packageid)}}EmbedCode.pushParam(result,"params","allowScriptAccess",scriptaccess);return result},getEmbed:function(isDemo){var oldDemoValue=this._isDemo;this._isDemo=isDemo;try{var params=this.getParams();var result=Templ.render("_embedded_player",params)}catch(e){throw e;}finally{this._isDemo=oldDemoValue}return result},setEmbedData:function(ed){this._embedData=
ed},setSize:function(s){this._customHeight=null;this._customWidth=null;this._customLayout=null;this._size=s},getSize:function(){return this._size},setVariant:function(v){this._variant=v},getVariant:function(){return this._variant},setDims:function(w,h){this._customHeight=h;this._customWidth=w},getDims:function(){var result={width:this._customWidth,height:this._customHeight};if(!(result.width&&result.height)){var isAlbum=this._embedData.tralbum_param.name=="album";var dims=EmbedCode.getDims(this._size,
isAlbum,this._variant);if(!dims)throw"failed to find layout: "+this._size+"/"+this._variant;result.width=dims.w;result.height=dims.h}return result},setPackage:function(pkgid){this._packageid=pkgid},getPackage:function(){return this._packageid},setCustomLayout:function(url,h,w){this._customHeight=h;this._customWidth=w;this._customLayout=url;this._size=null},getCustomParams:function(){if(this._customLayout)return{layout:this._customLayout,width:this._customWidth,height:this._customHeight};return null},
setTransparent:function(isTransparent){this._transparent=isTransparent},setVis:function(v){this._vis=v},setOptions:function(opts){for(var x in opts){Log.debug("EmbedCode option: "+x);switch(x){case "forceFlash":this._forceflash=opts[x];break;case "size":this.setSize(opts[x]);break;case "isDemo":this._isDemo=true;break;case "notracklist":this._notracklist=opts[x];break;case "vis":this.setVis(opts[x]);break}}},getOption:function(name){switch(name){case "notracklist":return this._notracklist;break}}},
statics:{getDims:function(size,isAlbum,variant){var dims={normal:{venti:{w:400,h:100},grande:{w:300,h:100},grande2:{w:300,h:355},grande3:{w:300,h:410},tall:{w:150,h:isAlbum?295:270},tall2:{w:150,h:450},short:{w:46,h:23}},core:{venti:{w:287,h:30},grande:{w:isAlbum?297:197,h:30},tall:{w:150,h:isAlbum?78:56},short:{w:23,h:23}}};return dims["normal"][size]},pushParam:function(hash,paramtype,name,value){if(!hash[paramtype])hash[paramtype]=[];hash[paramtype].push({name:name,value:value})},_hex_to_rgb:function(color){match=
/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/.exec(color);if(match)return"rgb("+Number("0x"+match[1])+","+Number("0x"+match[2])+","+Number("0x"+match[3])+")";return"rgb(255,255,255)"},encodeLayoutURL:function(url){return escape(url).replace(/\//g,"%2F").replace(/_/g,"%5F").replace(/%/g,"_")}}});
var Share={_shareDialog:null,_shareFromEmbedDialog:null,_biggieSizePresets:{small:350,medium:500,large:700},embedcode:new EmbedCode,showFromEmbed:function(){if(CfgShare2)Share.panelAsDialog();else{Share.embedcode.setEmbedData(EmbedData);var isTrack=EmbedData.tralbum_param.name=="track";Share._shareFromEmbedDialog=Share._createDialog("Share","_share_from_embed",{is_track:isTrack,permalink:EmbedData.linkback},[Dialog.buttons.ok(),Dialog.buttons.cancel()],"26em")}},showFromEmbedCleanup:function(){if(Share._shareFromEmbedDialog){Share._shareFromEmbedDialog.cancel();
Share._shareFromEmbedDialog=null}},showDialog:function(isTrack,permalink,variant,skipStats){if(!gplaylist&&variant!="email")if(FlashProxy.error){FlashProxy.noFlashError("share");return}else{setTimeout(Share.showDialog,0);return}Share.embedcode.setEmbedData(EmbedData);Share.embedcode.setVariant(variant);var params={permalink:permalink,siteroot:EmbedData.swf_base_url,variant:variant,is_track:isTrack};if(!skipStats)Stats.share_menu_click(variant);var dlg=Share._createDialog(variant=="email"?"Share":
"Share / Embed","_share",params,[Dialog.buttons.ok()],variant=="email"?"445px":"850px");$("#embedcode,#permalink").click(function(event){$(event.target).focus().select()});if(variant!="email"){Share.embedcode.setSize("venti");Share.embedcode.setOptions({forceFlash:false});var size=Share.embedcode.getSize();if(size)elt("sharePlayerSize_"+size).checked=true;var colorelems={"bgcolor":"bgColorSwatch","linkcolor":"linkColorSwatch"};var customParams=Share.embedcode.getCustomParams();if(customParams)if(!Share._canBeCustom(variant))Share.embedcode.setSize("venti");
else{Share.showSection("custom");elt("layouturl").value=customParams.layout;elt("customwidth").value=customParams.width;elt("customheight").value=customParams.height}for(var x in colorelems)Share._hookupColorSwatch(x,colorelems[x]);Share._updateControls();elt("embedcode").value=Share.embedcode.getEmbed(false);elt("embedded_player_sample").innerHTML=Share.embedcode.getEmbed(true)}else{embedelt.focus();embedelt.select()}Share._addMerch(TralbumData.packages)},_createDialog:function(title,template,hash,
buttons,width){var delem=$("\x3cdiv\x3e");var dialogparams={draggable:false,height:"630",position:{my:"top+5",at:"top",of:window},modal:true};if(width)dialogparams.width=width;var d=delem.dialog(dialogparams);d.html(Templ.render(template,hash));delem.on("click",Share._handleClick);d.on("dialogclose",function(){Share._cleanupPicker();delem.remove()});$("#layouturl,#customwidth,#customheight").on("change",Share._handleCustomUpdated);$("#transparent").on("change",Share._handleTransparentChanged);$("input[name\x3dstandard-shortcode]").on("change",
Share._handleShortcodeTypeChanged);$("#sizePicker").on("change",Share._handleDimensionPickerChanged);$("#showTracklist").on("change",Share._handleShowTracklistChanged);if(false&&width)delem.css("width",width);return d},_updateControls:function(){var variant=Share.embedcode.getVariant();var size=Share.embedcode.getSize();var showColorOptions=true;var showHeight=true;var showSizePicker=false;switch(size){case "short":showColorOptions=false;break;case "biggie":showColorOptions=false;showHeight=$("#showTracklist").attr("checked")==
"checked";showSizePicker=true;Share._updateSizePicker();break;case "artonly":showColorOptions=false;showHeight=false;showSizePicker=true;Share._updateSizePicker();break}$("#colorOptions").css("visibility",showColorOptions?"visible":"hidden");$("#playerHeightLabel").css("visibility",showHeight?"visible":"hidden");$("#playerHeightLabel").css("visibility",showHeight?"visible":"hidden");$("#sizePickerLabel").css("visibility",showSizePicker?"visible":"hidden");var hidebiggieopts=size!="biggie";if(hidebiggieopts!=
Share._biggie_opts_hidden){Share._biggie_opts_hidden=hidebiggieopts;var biggieopts=$("#showTracklistLabel,#merchLabel");if(!hidebiggieopts)biggieopts.animate({height:"show"},400,function(){biggieopts.css("visibility","visible")});else{biggieopts.css("visibility","hidden");biggieopts.animate({height:"hide"},400)}}},_updateSizePicker:function(){$("#sizePicker option").each(function(index,opt){var w=Share._biggieSizePresets[opt.value];if(!w)throw"invalid size selected: "+opt.value;var h=Share._recommendedBiggieHeight(w);
$(opt).html(opt.value+" ("+w+"px x "+h+"px)")})},_updateEmbed:function(){$("#embedcode")[0].value=Share.embedcode.getEmbed(false);var dims=Share.embedcode.getDims();$("#embedded_player_sample").html(Share.embedcode.getEmbed(true));var iframe=$("#embedded_player_sample iframe");var warning=$("#sample_not_actual_size_warning");var MAX_PREVIEW_HEIGHT=554;var MAX_PREVIEW_WIDTH=400;iframe.css("display","none");var ih=iframe.outerHeight();var iw=iframe.outerWidth();if(ih>MAX_PREVIEW_HEIGHT||iw>MAX_PREVIEW_WIDTH){var hscale=
MAX_PREVIEW_WIDTH/iw;var vscale=MAX_PREVIEW_HEIGHT/ih;var scale=Math.min(hscale,vscale);iframe.css({height:ih*scale,width:iw*scale});warning.css("display","block")}else warning.css("display","none");iframe.css("display","block")},refreshCustom:function(){elt("embedded_player_sample").innerHTML="";Share._updateEmbed()},_canBeCustom:function(variant){switch(variant){case "wordpress":case "other":return true;break}return false},_hookupColorSwatch:function(name,swatchname){function doUpdate(){if(currentColor!=
Share.embedcode.colors[name]){currentColor=Share.embedcode.colors[name];swatch.style.background=currentColor;Share._updateEmbed()}}function colorChoiceHandler(color,finished){swatch.style.background=color;textfield.value=color;Share.embedcode.colors[name]=color;if(delayedUpdateTimer)clearTimeout(delayedUpdateTimer);if(finished)Share._updateEmbed();else delayedUpdateTimer=setTimeout(doUpdate,UPDATE_DELAY)}var textfield=elt(name);var swatch=elt(swatchname);var UPDATE_DELAY=1E3;var delayedUpdateTimer=
null;var currentColor=Share.embedcode.colors[name];swatch.style.background=Share.embedcode.colors[name];textfield.value=Share.embedcode.colors[name];var selector="#"+name;Share.pollWhileFocused(selector,function(elem){var match;if(match=/^#?([0-9a-fA-F]{6})$/.exec($(selector)[0].value)){Share.embedcode.colors[name]="#"+match[1];doUpdate()}});$(swatch).click(function(event){Share._picker=PopupPicker.pick(event.pageX,event.pageY,currentColor,colorChoiceHandler);Share._picker.on("dialogclose",function(){Share._cleanupPicker()})})},
_addMerch:function(packages){if(!packages)return;for(var i=0;i<packages.length;i++)$("#merchSelect").append($("\x3coption\x3e",{value:packages[i].id,text:packages[i].title}));$("#merchSelect").on("change",Share._handleMerchSelected)},_cleanupPicker:function(){if(Share._picker){var picker=Share._picker;Share._picker=null;PopupPicker.destroy(picker)}},showSection:function(sec){var shownormal=true;var showcustom=false;var showbiggie=false;switch(sec){case "normal":break;case "custom":shownormal=false;
showcustom=true;break;case "biggie":showbiggie=true;shownormal=false;break}$("#sizeChoices").css("display",shownormal?"inline":"none");$("#customLayoutChoices").css("display",showcustom?"inline":"none");$("#refreshlink").css("display",showcustom?"inline":"none");$("#biggieSizeChoices").css("display",showbiggie?"inline":"none");Share._updateControls()},_backToNormal:function(){if(Share.embedcode.getCustomParams()){Share.embedcode.setSize("venti");Share._updateEmbed()}Share.showSection("normal")},_recommendedBiggieHeight:function(width){var size=
Share.embedcode.getSize();var notracklist=Share.embedcode.getOption("notracklist");var pkg=Share.embedcode.getPackage();var MIN_HEIGHT=350;var MERCH_SECTION_HEIGHT=62;var CONTROLS_HEIGHT=79;var TRACKLIST_BASE_HEIGHT=11;var TRACKLIST_ITEM_HEIGHT=26;var CURRENTTRACK_HEIGHT=13;var MAX_TRACKS=10;var scalefactor=width/MIN_HEIGHT;var h=MIN_HEIGHT;if(size=="artonly")return Math.round(MIN_HEIGHT*scalefactor);h+=CONTROLS_HEIGHT;if(pkg)h+=MERCH_SECTION_HEIGHT;if(notracklist)h+=CURRENTTRACK_HEIGHT;else{var num_tracks_to_show=
Math.min(TralbumData.trackinfo.length,MAX_TRACKS);h+=TRACKLIST_BASE_HEIGHT+num_tracks_to_show*TRACKLIST_ITEM_HEIGHT}return Math.round(h*scalefactor)},_handleClick:function(event){if(event.target.name=="sharePlayerSize"){if(event.target.id=="sharePlayerSize_venti"&&event.shiftKey&&Share._canBeCustom(Share.embedcode.getVariant())){event.preventDefault();Share.showSection("custom");Share.dlgCustomUpdate();return}else if(event.target.id=="sharePlayerSize_grande"&&event.shiftKey){event.preventDefault();
Share.showSection("biggie");setTimeout(function(){Share._selectSize("artonly")},0);return}Share._handleSizeSelected(event.target.value);return}switch(event.target.id){case "refreshlink_anchor":Share.refreshCustom();event.preventDefault();break;case "classicmode_link":case "backtonormal_link":Share._backToNormal();event.preventDefault();break}},_handleCustomUpdated:function(){var url=elt("layouturl").value;var h=elt("customheight").value;var w=elt("customwidth").value;Share.embedcode.setCustomLayout(url,
h,w);Share._updateEmbed()},_selectSize:function(sz){var elem=$("#sharePlayerSize_"+sz);if(elem.attr("checked")!="checked"){elem.attr("checked","checked");Share._handleSizeSelected(sz)}},_handleSizeSelected:function(sz){Share.embedcode.setSize(sz);switch(sz){case "biggie":case "artonly":Share._handleDimensionPickerChanged();break;default:Share._updateControls();Share._updateEmbed();break}},_handleTransparentChanged:function(){Share.embedcode.setTransparent(elt("transparent").checked);Share._updateControls();
Share._updateEmbed()},_handleDimensionPickerChanged:function(event){var picker=$("#sizePicker")[0];var value=picker.value;var width=Share._biggieSizePresets[value];var height=Share._recommendedBiggieHeight(width);Share.embedcode.setDims(width,height);Share._updateControls();Share._updateEmbed()},_handleShowTracklistChanged:function(event){var opts={notracklist:!event.target.checked};Share.embedcode.setOptions(opts);Share._handleDimensionPickerChanged()},_handleMerchSelected:function(event){Share.embedcode.setPackage(event.target.value);
Share._handleDimensionPickerChanged()},_handleShortcodeTypeChanged:function(event){var variant="other";if(event.target.value==1)variant="wordpress";Share.embedcode.setVariant(variant);var embed_code=Share.embedcode.getEmbed(false);$("#embedcode").val(embed_code)},pollWhileFocused:function(sel,callback,period){function docallback(){if(callback)callback($(sel))}function onblur(event){if(timer){clearInterval(timer);timer=null}$(sel).off("blur",onblur)}if(!period)period=500;var timer=null;$(sel).on("focus",
function(event){timer=setInterval(docallback,period);$(sel).on("blur",onblur)})},openFacebookShare:function(url,title){var fburl="http://www.facebook.com/sharer.php?u\x3d"+encodeURIComponent(url);fburl+="\x26p[title]\x3dptitle\x26p[summary]\x3dpsummary";if(title)fburl+="\x26t\x3d"+encodeURIComponent(title);window.open(fburl,"sharer","toolbar\x3d0,status\x3d0,width\x3d626,height\x3d436");return false},openTwitterShare:function(message){Log.debug("opening twitter share with message: "+message);var twurl=
"http://twitter.com/?status\x3d"+encodeURIComponent(message);window.open(twurl);return false},doFacebook:function(url,title){Stats.share_menu_click("facebook");return Share.openFacebookShare(url,title)},doTwitter:function(url,isTrack,source){if(source&&source=="tweet_button")Stats.record({kind:"click",click:"tweet_button"});else Stats.share_menu_click("twitter");var tralbum=isTrack?"track":"album";var message="omg best "+tralbum+" ever: "+url;return Share.openTwitterShare(message)},panelLinkPromise:new $.Deferred,
_panelInited:false,_panelData:null,initPanel:function(isTrackPage,enableSocialButtons,linkback){if(MediaView.mode=="phone"||$(".share-embed").length)return;var twitterUsername;$("#band-links a").each(function(){var match=/twitter\.com\/(?:#!)?(\w+)/i.exec($(this).attr("href"));if(match){twitterUsername=match[1];return false}});Share._panelData={linkback:linkback,is_track:isTrackPage,enable_social_buttons:enableSocialButtons,title:TralbumData.current.title,artist:TralbumData.artist,twitter_username:twitterUsername,
download_pref:TralbumData.current.download_pref,embed_info:EmbedData.embed_info};var p={"embed_info":$("#pagedata").data("blob").embed_info};$(".share-panel-wrapper-desktop").append(Templ.render("tralbum_common/share_collect_controls",p));$(".share-embed").click(function(){Share.togglePanel()});$(".exclusive-embed").click(function(){EmbedDialog.open("exclusive")});if(enableSocialButtons)Share.initSocialButtons();Share.panelLinkPromise.resolve()},initSocialButtons:function(){FacebookUtils.initSDK()},
panelAsDialog:function(){Share.panelLinkPromise.then(Share._panelAsDialog)},_panelAsDialog:function(){var data=Share._panelData;var delem=$(Templ.render("tralbum_common/share_embed_panel",data));var dialogparams={draggable:true,position:"center",modal:true,title:"Share",width:380,height:260};var d=delem.dialog(dialogparams);d.find(".email-im-link-text").blur();Share._initPanelControls(d,data,function(){d.dialog("close")});if(Share._panelData.enable_social_buttons)SocialControls.initFromDOM(d)},_initPanelControls:function(root,
data,closehandler){var $root=$(root);$root.find(".close").click(function(){closehandler()});$root.find(".embed-other-services a").click(function(){Stats.record({kind:"click",click:"embed_other"});if(CfgShare2)EmbedDialog.open();else Share.showDialog(data.is_track,null,"other",true);closehandler()});$root.find(".embed-other-services-exclusive a").click(function(){Stats.record({kind:"click",click:"embed_other_exclusive"});if(CfgShare2)EmbedDialog.open("exclusive");else Share.showDialog(data.is_track,
null,"other",true);closehandler()});$root.find(".share-buttons").on("click",".twitter-link, .tumblr-link",function(){closehandler()});$root.find(".email-im-link input").focus(function(){EmailIMUtils.onFocus()}).click(function(){$(this).select()})},togglePanel:function(){var $root=null;if(!Share._panelInited){var data=Share._panelData;$root=$(".share-panel-wrapper-desktop").append(Templ.render("tralbum_common/share_embed_panel",data));Share._initPanelControls($root,data,function(){Share.togglePanel()});
Share._panelRoot=$root}else $root=Share._panelRoot;var container=$root.find(".share-embed-container");var willShow=container.css("display")=="none";container.slideToggle("fast",function(){if(willShow)Dom.scrollToElement(container,20,true)});if(!Share._panelInited){if(Share._panelData.enable_social_buttons)SocialControls.initFromDOM($root);Share._panelInited=true}},xxx:null};
var Dom={_init:function(initElem){initElem=elt(initElem);if(!initElem)return false;if(!Y.lang.isUndefined(initElem.textContent)){Dom.getText=function(elem){elem=elt(elem);return elem?elem.textContent:""};Dom.setText=function(elem,text){elem=elt(elem);if(elem)elem.textContent=text}}else{Dom.getText=function(elem){elem=elt(elem);return elem?elem.innerText:""};Dom.setText=function(elem,text){elem=elt(elem);if(elem)elem.innerText=text}}if(Y.util.Dom.getStyle(initElem,"userSelect"))Dom.setUnselectable=
function(elem){elem=elt(elem);if(elem)elem.style.userSelect="none"};else if(Y.util.Dom.getStyle(initElem,"MozUserSelect"))Dom.setUnselectable=function(elem){elem=elt(elem);if(elem)elem.style.MozUserSelect="none"};else if(typeof initElem.style.WebkitUserSelect!=="undefined")Dom.setUnselectable=function(elem){elem=elt(elem);if(elem)elem.style.WebkitUserSelect="none"};else Dom.setUnselectable=function(elem){elem=elt(elem);if(elem)elem.unselectable="on"};initElem=null;return true},getText:function(elem){if(Dom._init(elem))return Dom.getText(elem);
else return""},setText:function(elem,text){if(Dom._init(elem))Dom.setText(elem,text)},getValue:function(formElem){formElem=elt(formElem);switch(formElem.type){case "checkbox":return formElem.checked?formElem.value:null;case "radio":var radios=document.getElementsByName(formElem.name);var i=0;for(var n=radios.length;i<n;i++)if(radios[i].checked)return radios[i].value;return null}return formElem.value},setUnselectable:function(elem){if(Dom._init(elem))Dom.setUnselectable(elem)},initActiveElement:function(){var noActiveElement=
false;try{noActiveElement=Y.lang.isUndefined(document.activeElement)}catch(e){return}if(noActiveElement&&document.addEventListener){var handleBlur=function(event){var node=Y.util.Event.getTarget(event);if(node==document.activeElement)document.activeElement=null};var handleFocus=function(event){var node=Y.util.Event.getTarget(event);if(node)document.activeElement=node};document.activeElement=null;document.addEventListener("focus",handleFocus,true);document.addEventListener("blur",handleBlur,true)}},
focus:function(elem){elem=elt(elem);try{elem.focus()}catch(e){}},select:function(elem,doFocus){elem=elt(elem);try{elem.select();if(doFocus)elem.focus()}catch(e){}},getDocumentHeight:function(){return document.documentElement[Browser.type=="gecko"?"offsetHeight":"scrollHeight"]},copyStyles:function(srcElem,destElem){var destStyle=destElem.style;var getStyle=Y.util.Dom.getStyle;for(var i=2;i<arguments.length;i++){var propName=arguments[i];destStyle[propName]=getStyle(srcElem,propName)}},wrapElem:function(elem,
wrapperElem){if(Y.lang.isString(wrapperElem))wrapperElem=document.createElement(wrapperElem);Y.util.Dom.insertBefore(wrapperElem,elem).appendChild(elem);return wrapperElem},replaceElem:function(oldElem,newElem){Y.util.Dom.insertAfter(newElem,oldElem);oldElem.parentNode.removeChild(oldElem)},removeElem:function(elem){elem.parentNode.removeChild(elem)},display:function(elemOrId,displayValue){if(Y.lang.isArray(elemOrId))return Y.util.Dom.batch(elemOrId,function(el){this.display(el,displayValue)},this,
true);elemOrId=Y.util.Dom.get(elemOrId);if(!elemOrId)return;if(displayValue==undefined)displayValue="";else if(displayValue==false)displayValue="none";else if(displayValue&&typeof displayValue!="string")displayValue=elemOrId.tagName=="SPAN"||elemOrId.tagName=="INPUT"?"inline":"block";if(Browser.type!="ie"&&(displayValue=="block"||displayValue=="inline"))switch(elemOrId.tagName.toLowerCase()){case "tr":displayValue="table-row";break;case "td":displayValue="table-cell";break}Y.util.Dom.setStyle(elemOrId,
"display",displayValue)},disable:function(elemOrId,disableValue){if(Y.lang.isArray(elemOrId))return Y.util.Dom.batch(elemOrId,function(el){this.disable(el,disableValue)},this,true);var el$$0=elt(elemOrId);if(el$$0)el$$0.disabled=disableValue},getParentByClassName:function(elemOrId,className){var D=Y.util.Dom;for(var el=elt(elemOrId);el;){if(D.hasClass(el,className))return el;el=el.parentNode}return el},getCousinByClassName:function(elemOrId,parentClassName,cousinClassName){var el=this.getParentByClassName(elemOrId,
parentClassName);if(!el)return null;return Y.util.Dom.getElementsByClassName(cousinClassName,null,el)[0]},scrollToElement:function(revealElt,clearance,gently){if(revealElt.charAt&&revealElt.charAt(0)!="#")revealElt="#"+revealElt;revealElt=$(revealElt);if(!revealElt.length)return;revealElt.parents().each(function(i,domElem){if(domElem.style&&domElem.style.display=="none")Dom.display(domElem)});var animElt=document.scrollingElement;if(!animElt)animElt=document.documentElement&&document.documentElement.scrollTop!=
null?document.documentElement:document.body;if(clearance==null)clearance=-10;if(gently){var viewHeight=document.documentElement.clientHeight;var eltHeight=revealElt.height();var viewTop=animElt.scrollTop;var viewBottom=animElt.scrollTop+viewHeight;var eltTop=revealElt.offset().top;var eltBottom=revealElt.offset().top+eltHeight;if(eltTop>=viewTop){if(eltBottom<viewBottom)return;clearance+=eltBottom-viewHeight}else clearance+=eltTop}else clearance+=revealElt.offset().top;$(animElt).animate({"scrollTop":clearance},
500)},scrollToParamElt:function(id_param){var e$$0;id_param=id_param||"goto";try{if(window.location.search&&window.location.href.indexOf("#")==-1){params=window.location.search.slice(1).split("\x26");for(i=0,n=params.length;i<n;i++){param=params[i].split("\x3d");if(param[0]==id_param&&param[1]){Y.lang.later(10,window,function(){Dom.scrollToElement(elt(param[1]))});break}}}}catch(e){}},disableControls:function(rootElt,tag){tag=tag||["INPUT","TEXTAREA","SELECT","BUTTON"];if(Y.lang.isArray(tag)){var i=
0;for(var n=tag.length;i<n;++i)this.disableControls(rootElt,tag[i]);return}if(Y.lang.isArray(rootElt)){i=0;for(n=rootElt.length;i<n;++i)this.disableControls(rootElt[i],tag);return}rootElt=elt(rootElt);if(!rootElt)return;var e$$0;var elts=rootElt.getElementsByTagName(tag);i=0;for(n=elts.length;i<n;++i)try{elts[i].disabled=true}catch(e){}},enableControls:function(rootElt,tag){tag=tag||["INPUT","TEXTAREA","SELECT","BUTTON"];if(Y.lang.isArray(tag)){var i=0;for(var n=tag.length;i<n;++i)this.enableControls(rootElt,
tag[i]);return}if(Y.lang.isArray(rootElt)){i=0;for(n=rootElt.length;i<n;++i)this.enableControls(rootElt[i],tag);return}rootElt=elt(rootElt);if(!rootElt)return;var e$$0;var elts=rootElt.getElementsByTagName(tag);i=0;for(n=elts.length;i<n;++i)try{elts[i].disabled=false}catch(e){}},elementToIndex:function(element,className){element=className?Dom.getParentByClassName(element,className):element;if(!element||!element.id)return null;var match=element.id.match(/\w(\d+)$/);if(!match||!match[1])return null;
return parseInt(match[1])},hideEverythingStack:[],hideEverythingThanksAndroid:function(){if(Browser.make=="androidbrowser"){var args=Array.prototype.slice.call(arguments);if(args.length==0)return;var devlog=$(".logView")[0];if(devlog)args.push(devlog);$(this.hideEverythingStack[0]).css("visibility","inherit");$(args).css("visibility","visible");$(args).each(function(i,elt){});this.hideEverythingStack.unshift(args);$(document.body).css("visibility","hidden")}},unhideEverythingThanksAndroid:function(){if(Browser.make==
"androidbrowser"){var args=Array.prototype.slice.call(arguments);var top=this.hideEverythingStack[0];var found_one=false;if(top&&top.length>0)$(args).each(function(i,elti){$(top).each(function(j,eltj){found_one=found_one||elti==eltj})});if(!found_one){Log.error("Elt not found unhiding for android fixup");return}this.hideEverythingStack.shift();elems=this.hideEverythingStack[0]||document.body;$(elems).css("visibility","visible");$(elems).each(function(i,elt){})}},hackLinkClicksThanksSafari:function(elts,
clickHandler){elts=$(elts);if(Browser.platform!="iphone"){if(clickHandler)elts.on("click",clickHandler);return}elts.on({"touchend":function(ev){var href=this.getAttribute("href");if(href&&href.substring(0,1)!="#")this.setAttribute("href","#"+href)},"click":function(ev){var href=this.getAttribute("href");if(href&&href.substring(0,1)=="#")this.setAttribute("href",href.substring(1));if(clickHandler)return clickHandler.apply(this,arguments)}})},inViewport:function(el){var top=el.offsetTop;var left=el.offsetLeft;
var width=el.offsetWidth;for(var height=el.offsetHeight;el.offsetParent;){el=el.offsetParent;top+=el.offsetTop;left+=el.offsetLeft}return top<window.pageYOffset+window.innerHeight&&left<window.pageXOffset+window.innerWidth&&top+height>window.pageYOffset&&left+width>window.pageXOffset},getCursorPosition:function(el){var sel;var pos=0;if(document.selection){el.focus();sel=document.selection.createRange();sel.moveStart("character",-el.value.length);pos=sel.text.length}else if(el.selectionStart!==undefined)pos=
el.selectionStart;return pos},setCursorPosition:function(el,pos){var range;if(el.setSelectionRange){el.focus();el.setSelectionRange(pos,pos)}else if(el.createTextRange){range=el.createTextRange();range.collapse(true);range.moveEnd("character",pos);range.moveStart("character",pos);range.select()}},measureHiddenHeight:function(el,destinationParent){var $el=$(el);var parentWidth=$(destinationParent).width();$el.css({"display":"block","position":"absolute","visibility":"hidden","width":parentWidth});
var targetHeight=$el.height();$el.css({"display":"none","position":"","visibility":"","width":""});return targetHeight},xxx:null};
var FieldHints={WRAPPER_CLASS:"fieldHintWrapper",ACTIVE_CLASS:"fieldHintActive",HINT_CLASS:"fieldHint",NATIVE_PLACEHOLDER:"placeholder"in document.createElement("input"),USE_TITLE_ATTR:true,init:function(rootNode){var FH=FieldHints;Iter.each(FH._getFieldElements(rootNode),function(elem){if(FH._getHintText(elem)){FH._setupHint(elem);FH._showHint(elem)}})},_getFieldElements:function(rootNode){rootNode=rootNode?elt(rootNode):null;rootNode=rootNode||document;var inputElems=rootNode.getElementsByTagName("INPUT");
inputElems=Iter.findAll(inputElems,function(elem){return elem.type=="text"});var textareaElems=rootNode.getElementsByTagName("TEXTAREA");return inputElems.concat(Iter.collect(textareaElems))},_handleFocus:function(event){FieldHints._hideHint(this)},_handleBlur:function(event){FieldHints._showHint(this)},_handleHintClick:function(event){var elem=Y.util.Dom.getNextSibling(this);$assert(elem.tagName=="INPUT"&&elem.type=="text"||elem.tagName=="TEXTAREA");setTimeout(function(){Dom.focus(elem)},10)},updateHint:function(elem){elem=
elt(elem);if(!elem)return;var wrapperEl=elem.parentNode;if(Y.util.Dom.hasClass(wrapperEl,FieldHints.WRAPPER_CLASS))Dom.setText(elem._fieldhint,this._getHintText(elem));else FieldHints._setupHint(elem)},_setupHint:function(elem){if(this.NATIVE_PLACEHOLDER){if(this.USE_TITLE_ATTR)elem.placeholder=elem.title;return}var wrapperEl=elem.parentNode;if(Y.util.Dom.hasClass(wrapperEl,FieldHints.WRAPPER_CLASS))return;if(Y.util.Dom.getStyle(wrapperEl,"position")!="relative"){var wrapperTagName=elem.tagName==
"TEXTAREA"?"div":"span";wrapperEl=Dom.wrapElem(elem,wrapperTagName)}Y.util.Dom.addClass(wrapperEl,FieldHints.WRAPPER_CLASS);var hintEl=document.createElement("span");Y.util.Dom.insertBefore(hintEl,elem);hintEl.className=FieldHints.HINT_CLASS;Dom.setText(hintEl,this._getHintText(elem));Dom.setUnselectable(hintEl);elem._fieldhint=hintEl;Dom.copyStyles(elem,hintEl,"paddingTop","paddingLeft","borderTopWidth","borderLeftWidth","marginTop","marginLeft","fontSize","lineHeight");var ieLessThan7=Browser.type==
"ie"&&Browser.version[0]<7;if(!ieLessThan7)Dom.copyStyles(elem,wrapperEl,"paddingTop");if(Browser.type=="gecko"){hintEl.style.top=elem.offsetTop+"px";var marginTop=Y.util.Dom.getStyle(elem,"marginTop");var marginTopInt=parseInt(marginTop);if(!isNaN(marginTopInt))hintEl.style.marginTop="-"+marginTop}else if(ieLessThan7)hintEl.style.border="none";Y.util.Event.on(elem,"focus",FieldHints._handleFocus);Y.util.Event.on(elem,"blur",FieldHints._handleBlur);Y.util.Event.on(hintEl,"click",FieldHints._handleHintClick)},
jiggleHint:function(elem){elem=elt(elem);if(!elem)return;var wrapperEl=elem.parentNode;if(!Y.util.Dom.hasClass(wrapperEl,FieldHints.WRAPPER_CLASS))return;if(Browser.type=="gecko"){var hintEl=elem.previousSibling;hintEl.style.top=elem.offsetTop+"px";var marginTop=Y.util.Dom.getStyle(elem,"marginTop");var marginTopInt=parseInt(marginTop);if(!isNaN(marginTopInt))hintEl.style.marginTop="-"+marginTop}},jiggleAll:function(rootElem){Y.util.Dom.getElementsByClassName(FieldHints.WRAPPER_CLASS,null,rootElem,
function(elem){if(elem.firstChild&&elem.firstChild.nextSibling)FieldHints.jiggleHint(elem.firstChild.nextSibling)})},_getHintText:function(elem){return this.USE_TITLE_ATTR?elem.title:elem.getAttribute("placeholder")},_showHint:function(elem){if(!this.NATIVE_PLACEHOLDER&&this._getHintText(elem)&&!elem.value&&elem!=document.activeElement)Y.util.Dom.addClass(elem.parentNode,FieldHints.ACTIVE_CLASS)},_hideHint:function(elem){if(FieldHints._isHintVisible(elem))Y.util.Dom.removeClass(elem.parentNode,FieldHints.ACTIVE_CLASS)},
_isHintVisible:function(elem){return Y.util.Dom.hasClass(elem.parentNode,FieldHints.ACTIVE_CLASS)}};
var Ellipses={_outerClass:"ellipsizer",_innerClass:"ellipsizee",_moreClass:"ellipsisWrapper",_spacerClass:"ellipsisSpacer",init:function(rootNode){rootNode=rootNode||document.body;if(rootNode.style.maxHeight==null)return;var elems=Y.util.Dom.getElementsByClassName(Ellipses._outerClass,null,rootNode,function(elem){var innerEl=document.createElement("span");innerEl.className=Ellipses._innerClass;for(var children=elem.childNodes;children.length;)innerEl.appendChild(children[0]);elem.appendChild(innerEl);
Ellipses._updateElement(elem)})},_updateElement:function(elem){var child=Y.util.Dom.getElementsByClassName(Ellipses._innerClass,null,elem)[0];if(child.offsetHeight>elem.offsetHeight)Ellipses._show(elem);else{Ellipses._hide(elem);elem.style.maxHeight="none"}},_show:function(elem){var moreElem=Y.util.Dom.getElementsByClassName(Ellipses._moreClass,null,elem)[0];var spacerElem=Y.util.Dom.getElementsByClassName(Ellipses._spacerClass,null,elem)[0];if(moreElem){moreElem.style.display="block";spacerElem.style.display=
"block"}else{moreElem=document.createElement("div");moreElem.className=Ellipses._moreClass;elem.insertBefore(moreElem,elem.firstChild);moreElem.innerHTML='\x3ca class\x3d"morelink" href\x3d"#"\x3e\x26hellip;more\x3c/a\x3e';var linkElem=Y.util.Dom.getElementsByClassName("morelink",null,elem)[0];Y.util.Event.addListener(linkElem,"click",Ellipses._toggle,elem,false);spacerElem=document.createElement("div");spacerElem.className=Ellipses._spacerClass;elem.insertBefore(spacerElem,elem.firstChild)}var numLines=
Math.max(1,Math.round(elem.offsetHeight/moreElem.offsetHeight));var numSpacerLines=numLines-1;var brs=[];for(var i=0;i<numSpacerLines;i++)brs.push("\x3cbr\x3e");spacerElem.innerHTML=brs.join("")},_hide:function(elem){var moreElem=Y.util.Dom.getElementsByClassName(Ellipses._moreClass,null,elem)[0];var spacerElem=Y.util.Dom.getElementsByClassName(Ellipses._spacerClass,null,elem)[0];if(moreElem){moreElem.style.display="none";spacerElem.style.display="none"}},_toggle:function(evt,elem){var moreElem=Y.util.Dom.getElementsByClassName(Ellipses._moreClass,
null,elem)[0];if(moreElem){if(moreElem.oldHeight){elem.style.maxHeight="";elem.style.maxHeight=moreElem.oldHeight;moreElem.oldHeight=null}else{moreElem.oldHeight=elem.style.maxHeight;elem.style.maxHeight="none"}Ellipses._updateElement(elem)}Y.util.Event.stopEvent(evt)}};
var Dialog={_id:0,instances:[],asycnOpenOnFB:function(title,body,buttons,width,options){if(window.FacebookData){var patchYui=false;FacebookUtils.correctSrollThen(patchYui,Dialog,Dialog.open_inner,title,body,buttons,width,options)}else return Dialog.open(title,body,buttons,width,options)},open:function(title,body,buttons,width,options){var elemId="dlg"+Dialog._id++;var opts;var dlg;var attr;var phoneView=window.MediaView&&window.MediaView.mode=="phone";opts={width:!phoneView?width||"30em":null,modal:true,
close:true,underlay:"none",dragOnly:true,strings:{close:TM("Close")},visible:false,zIndex:112};$.extend(opts,options||{});dlg=new Y.widget.Dialog(elemId,opts);dlg.setHeader('\x3cdiv class\x3d"content"\x3e'+Text.escapeHtml(Text.collate(title,"Bandcamp"))+"\x3c/div\x3e");dlg.setBody(Text.collate(body,"\x26nbsp;"));if(buttons&&!Y.lang.isArray(buttons))buttons=[buttons];if(!buttons)buttons=Dialog.buttons.standardSet();dlg.cfg.queueProperty("buttons",buttons);dlg.cfg.queueProperty("keylisteners",Dialog.keyListeners.standardSet(dlg));
dlg.cfg.queueProperty("constraintoviewport",true);if(window.MediaView&&MediaView.mode=="phone")dlg.cfg.addProperty("autofocus",{value:false});var useAutoCentering=!window.FacebookData&&!phoneView&&!(Browser.platform=="iphone"||Browser.platform=="android")&&opts.fixedcenter===undefined;if(useAutoCentering)dlg.cfg.queueProperty("fixedcenter",true);dlg.hideEvent.subscribe(function(){Dialog.destacken(dlg);if(phoneView)Dom.unhideEverythingThanksAndroid(dlg.element,dlg.mask);Y.lang.later(0,dlg,dlg.destroy);
$.event.trigger("bc_dialog_close")});dlg.destroyEvent.subscribe(function(){if(phoneView)Dom.unhideEverythingThanksAndroid(dlg.element,dlg.mask);Dialog.destacken(dlg)});dlg.hideMaskEvent.subscribe(function(){if(Dialog.instances.length)$(document.body).addClass("masked")});if(Browser.type=="ie"||Browser.type=="gecko"){dlg._onElementFocus_orig=dlg._onElementFocus;dlg._onElementFocus=function(e){if(Y.util.Event.getTarget(e).tagName!="OBJECT"&&Y.util.Event.getTarget(e).tagName!="EMBED")dlg._onElementFocus_orig(e)}}dlg.render(document.body);
if(buttons.length==0){dlg.footer.style.display="none";Y.util.Dom.addClass(dlg.body,"footerless")}else{Y.util.Dom.addClass(dlg.body,"footered");Y.util.Dom.batch(dlg.footer.getElementsByTagName("button"),function(elem){elem.innerHTML="\x3cdiv\x3e"+Text.escapeHtml(Dom.getText(elem))+"\x3c/div\x3e"})}if(!useAutoCentering||Browser.type=="opera")dlg.center();dlg.show();$.event.trigger("bc_dialog_open");if(phoneView){Y.util.Event.on(dlg.mask,"click",function(){Dom.scrollToElement(dlg.element)});Dom.hideEverythingThanksAndroid(dlg.element,
dlg.mask)}Dialog.enstacken(dlg);return dlg},openTemplate:function(title,templName,hash,buttons,width,options){var body=Templ.render(templName,hash);return Dialog.open(title,body,buttons,width,options)},alert:function(title,message,onClose,showCancel,okText,showClose){if(window.FacebookData){var patchYui=false;return FacebookUtils.correctSrollThen(patchYui,Dialog,Dialog.alert_inner,title,message,onClose,showCancel)}else return Dialog.alert_inner(title,message,onClose,showCancel,okText,showClose)},
alert_inner:function(title,message,onClose,showCancel,okText,showClose){var buttons=showCancel?Dialog.buttons.standardSet():[Dialog.buttons.ok()];if(okText)buttons[0].text=okText;if(onClose)buttons[0].handler=function(){this.cancel();onClose.call(this)};var dlg=Dialog.open(title,message,buttons,null,{close:showClose||false});Y.util.Dom.addClass(dlg.body,"alertDlg");return dlg},buttons:{standardSet:function(okHandler,okText,cancelHandler,cancelText){return[Dialog.buttons.ok(okHandler,okText),Dialog.buttons.cancel(cancelHandler,
cancelText)]},ok:function(okHandler,okText){okHandlerWrapper=function(){this.cancel();if(okHandler)okHandler()};return{text:okText||"OK",isDefault:true,handler:okHandlerWrapper}},cancel:function(cancelHandler,cancelText){cancelHandlerWrapper=function(){this.cancel();if(cancelHandler)cancelHandler()};return{text:cancelText||"Cancel",handler:cancelHandlerWrapper}}},keyListeners:{standardSet:function(dlg){return[Dialog.keyListeners.escape(dlg)]},escape:function(dlg){return new Y.util.KeyListener(document,
{keys:Y.util.KeyListener.KEY.ESCAPE},{fn:function(type,args){setTimeout(function(){dlg.cancel()},1)},scope:dlg,correctScope:true})}},enstacken:function(dlg){Dialog.instances.push(dlg)},destacken:function(dlg){var index=Iter.index(Dialog.instances,dlg);if(index>=0)Dialog.instances.splice(index,1)}};if(Y&&Y.widget&&Y.widget.Dialog)Y.widget.Dialog.prototype._focusOnShow=function(){if(this.cfg.getProperty("autofocus")!==false)Y.widget.Panel.prototype._focusOnShow.apply(this,arguments)};
var Time={useIntl:typeof Intl!=="undefined"&&typeof Intl.DateTimeFormat!=="undefined",timeFormats:{en:{yyyyMd:{form:"%-m/%-d/%Y"},yyyyMMdd:{form:"%m/%d/%Y"},yyyyMMM:{form:"%b %Y"},yyyyMMMM:{form:"%B %Y"},yyyyMMMd:{form:"%b %-d, %Y"},yyyyMMMMd:{form:"%B %-d, %Y"},yyyyMMMdhmm:{form:"%b %-d, %Y %-I:%M\u00a0%p"},yyyyMMMMdhmm:{form:"%B %-d, %Y %-I:%M\u00a0%p"},yyyyMMMMdhmmzz:{form:"%B %-d, %Y\u00a0at\u00a0%-I:%M\u00a0%p\u00a0%Z"},yyyyMMMMdEEEEhmmzz:{form:"%A, %B %-d, %Y\u00a0at\u00a0%-I:%M\u00a0%p\u00a0%Z"},
MMMMd:{form:"%B %-d"},hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%l:%M\u00a0%p\u00a0%Z"},hhmm:{form:"%l:%M\u00a0%p"}},fr:{yyyyMd:{form:"%d/%m/%Y"},yyyyMMdd:{form:"%d/%m/%Y"},yyyyMMM:{form:"%b %Y",localize:["month_short"]},yyyyMMMM:{form:"%B %Y",localize:["month"]},yyyyMMMd:{form:"%-d %b %Y",localize:["month_short"]},yyyyMMMMd:{form:"%-d %B %Y",localize:["month"]},yyyyMMMdhmm:{form:"%-d %b %Y\u00a0\u00e0\u00a0%H:%M",localize:["month_short"]},yyyyMMMMdhmm:{form:"%-d %B %Y\u00a0\u00e0\u00a0%H:%M",localize:["month"]},
yyyyMMMMdhmmzz:{form:"%-d %B %Y\u00a0\u00e0\u00a0%H:%M\u00a0%Z",localize:["month"]},yyyyMMMMdEEEEhmmzz:{form:"%A %-d %B %Y\u00a0\u00e0\u00a0%H:%M\u00a0%Z",localize:["month","weekday"]},MMMMd:{form:"%-d %B",localize:["month"]},hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%H:%M\u00a0%Z"},hhmm:{form:"%H:%M"}},ja:{yyyyMd:{form:"%Y/%-m/%-d"},yyyyMMdd:{form:"%Y/%m/%d"},yyyyMMM:{form:"%Y\u5e74%-m\u6708"},yyyyMMMM:{form:"%Y\u5e74%-m\u6708"},yyyyMMMd:{form:"%Y\u5e74%-m\u6708%-d\u65e5"},yyyyMMMMd:{form:"%Y\u5e74%-m\u6708%-d\u65e5"},
yyyyMMMdhmm:{form:"%Y\u5e74%-m\u6708%-d\u65e5 %H:%M"},yyyyMMMMdhmm:{form:"%Y\u5e74%-m\u6708%-d\u65e5 %H:%M"},yyyyMMMMdhmmzz:{form:"%Y\u5e74%-m\u6708%-d\u65e5 %H:%M\u00a0%Z"},yyyyMMMMdEEEEhmmzz:{form:"%Y\u5e74%-m\u6708%-d\u65e5 (%A) %H:%M\u00a0%Z",localize:["weekday"]},MMMMd:{form:"%-m\u6708%-d\u65e5"},hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%H:%M\u00a0%Z"},hhmm:{form:"%H:%M"}}},localizedTimeValues:{fr:{month_short:["janv.","f\u00e9vr.","mars","avr.","mai","juin","juil.","ao\u00fbt","sept.","oct.",
"nov.","d\u00e9c."],month:["janvier","f\u00e9vrier","mars","avril","mai","juin","juillet","ao\u00fbt","septembre","octobre","novembre","d\u00e9cembre"],weekday:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},ja:{weekday:["\u65e5","\u6708","\u706b","\u6c34","\u6728","\u91d1","\u571f"]}},get_locale:function(locale){if(typeof locale==="undefined"||locale=="")if("Translate"in window)locale=Translate.locale;else locale="en";if(locale=="qq")locale="ja";return locale},get_local_timezone:function(){return Time.useIntl?
(new Intl.DateTimeFormat("en")).resolvedOptions().timeZone:null},shiftDate:function(date,locale,timezone){if(!Time.useIntl)return{date:date,tzname:"UTC"};var formatter=new Intl.DateTimeFormat(locale,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:false,timeZoneName:"short",timeZone:timezone});var year;var month;var day;var hour;var min;var sec;var tzName;var parts=formatter.formatToParts(date);for(var i=0;i<parts.length;i++)switch(parts[i]["type"]){case "year":year=
parseInt(parts[i]["value"]);break;case "month":month=parseInt(parts[i]["value"])-1;break;case "day":day=parseInt(parts[i]["value"]);break;case "hour":hour=parseInt(parts[i]["value"]);break;case "minute":min=parseInt(parts[i]["value"]);break;case "second":sec=parseInt(parts[i]["value"]);break;case "timeZoneName":tzName=parts[i]["value"];break;default:break}var d=new Date(Date.UTC(year,month,day,hour,min,sec));return{date:d,tzname:tzName}},to_ui:function(date,format,locale,timezone,asUTC){var s;var d;
if(typeof format==="undefined")format=1;if(typeof date==="string")date=new Date(date);locale=Time.get_locale(locale);if(typeof date["getUTCFullYear"]==="function"){if(typeof asUTC==="undefined")asUTC=true;d=new Date(date);if(asUTC){d.year=date.getUTCFullYear();d.month=date.getUTCMonth()+1;d.mday=date.getUTCDate();d.hour=date.getUTCHours();d.min=date.getUTCMinutes();d.sec=date.getUTCSeconds();d.tz="UTC"}else{d.year=date.getFullYear();d.month=date.getMonth()+1;d.mday=date.getDate();d.hour=date.getHours();
d.min=date.getMinutes();d.sec=date.getSeconds();d.tz=date.toTimeString().match(/\((.*)\)/)[1]}date=d}var badFormatStr="\x3cd'oh bad to_ui format\x3e";if(typeof format==="number")switch(format){case 1:s=Time.to_ui(date,2)+" "+Time.to_ui(date,3);break;case 2:s=date.month+"/"+date.mday+"/"+date.year%100;break;case 3:var hour12;var min_str;var ampm;hour12=date.hour>12?date.hour-12:date.hour;if(hour12==0)hour12=12;min_str=date.min<10?"0"+date.min:""+date.min;ampm=date.hour>=12?"pm":"am";s=hour12+":"+min_str+
ampm;break;case 4:s=date.month+"/"+date.mday+"/"+date.year;break;case 5:s=Time.to_ui(date,4)+" "+Time.to_ui(date,3);break;case 6:s=Time.tables.B[date.month-1]+" "+date.mday+", "+date.year;break;case 7:s=Time.to_ui(date,6)+" "+Time.to_ui(date,3);break;case 8:s=Time.to_ui(date,7)+" "+date.tz;break;case 9:s=Time.strftime(date,"%Y-%m-%d");break;case 10:s=Time.strftime(date,"%d %B %Y %H:%M:%S");break;case 11:s=Time.tables.b[date.month-1]+" "+date.mday+", "+date.year;break;case 12:s=Time.strftime(date,
"%Y-%m-%d %H:%M:%S");break;case 13:s=Time.strftime(date,"%B %Y");break;case 14:s=Time.strftime(date,"%m/%d/%Y");break;default:s=badFormatStr}else if(typeof format==="string"){var formattingObj=Time.timeFormats[locale][format];var formatStr=formattingObj["form"];if(typeof timezone!=="undefined"){s=Time.shiftDate(date,locale,timezone);date=s.date;formatStr=formatStr.replace(/%(Z)/g,s.tzname)}if("localize"in formattingObj){var localize=formattingObj["localize"];var locale_values=Time.localizedTimeValues[locale];
localize.forEach(function(field){var values=locale_values[field];switch(field){case "month_short":formatStr=formatStr.replace(/%b/g,values[date.getMonth()]);break;case "month":formatStr=formatStr.replace(/%B/g,values[date.getMonth()]);break;case "weekday":formatStr=formatStr.replace(/%A/g,values[date.getDay()]);break;default:formatStr=badFormatStr;break}})}s=Time.strftime(date,formatStr)}else s=badFormatStr;return s},toUi:function(date,fourDigitYear,asUTC,as24){if(Y.lang.isString(date))date=new Date(date);
var hour=date[asUTC?"getUTCHours":"getHours"]();var min=date[asUTC?"getUTCMinutes":"getMinutes"]();min=min<10?"0"+min:min;if(as24){hour=hour<10?"0"+hour:hour;var ampm=""}else{var hour12=hour>12?hour-12:hour;if(hour12==0)hour12=12;ampm=hour>=12?"pm":"am";hour=hour12}return Time.toUiDate(date,fourDigitYear,asUTC)+" "+hour+":"+min+ampm},toUiDate:function(date,fourDigitYear,asUTC){if(Y.lang.isString(date))date=new Date(date);var year=date[asUTC?"getUTCFullYear":"getFullYear"]().toString();if(!fourDigitYear)year=
year.substr(2);return date[asUTC?"getUTCMonth":"getMonth"]()+1+"/"+date[asUTC?"getUTCDate":"getDate"]()+"/"+year},relativeTimeFormats:{en:{today:"today",yesterday:"yesterday",days_ago:"{{days_ago}} days ago",one_hour_ago:"1 hour ago",hours_ago:"{{hours_ago}} hours ago",one_minute_ago:"1 minute ago",minutes_ago:"{{minutes_ago}} minutes ago",seconds_ago:"{{seconds_ago}} seconds ago",just_now:"just now"},fr:{today:"aujourd'hui",yesterday:"hier",days_ago:"il y a {{days_ago}} jours",one_hour_ago:"il y a 1 heure",
hours_ago:"il y a {{hours_ago}} heures",one_minute_ago:"il y a 1 minute",minutes_ago:"il y a {{minutes_ago}} minutes",seconds_ago:"il y a {{seconds_ago}} secondes",just_now:"\u00e0 l'instant"},ja:{today:"\u4eca\u65e5",yesterday:"\u6628\u65e5",days_ago:"{{days_ago}}\u65e5\u524d",one_hour_ago:"1\u6642\u9593\u524d",hours_ago:"{{hours_ago}}\u6642\u9593\u524d",one_minute_ago:"1\u5206\u524d",minutes_ago:"{{minutes_ago}}\u5206\u524d",seconds_ago:"{{seconds_ago}}\u79d2\u524d",just_now:"\u3061\u3087\u3046\u3069\u4eca"}},
timeStr:function(timeInSeconds){var str="";for(timeInSeconds=Math.floor(timeInSeconds);timeInSeconds>0;){var part=timeInSeconds%60;var partstr=part.toString();if(partstr.length<2)partstr="0"+partstr;if(str.length>0)str=partstr+":"+str;else str=partstr;timeInSeconds-=part;timeInSeconds/=60}if(str.length==0)str="00:00";else if(str.length<3)str="00:"+str;return str},calc_days_ago:function(date){return Math.floor((new Date-date)/(60*60*24*1E3))},relative_day:function(date,format,locale){if(Y.lang.isString(date))date=
new Date(date);locale=Time.get_locale(locale);var localeFormats=Time.relativeTimeFormats[locale];var days_ago=Time.calc_days_ago(date);if(days_ago==0)return localeFormats.today;else if(days_ago==1)return localeFormats.yesterday;if(format)return Time.to_ui(date,format,locale);var str=localeFormats.days_ago;var vars={days_ago:days_ago};return str.replace(/\{\{(.*?)\}\}/g,function(w,expr){return vars[expr]})},relative_time:function(date,format,locale){if(Y.lang.isString(date))date=new Date(date);locale=
Time.get_locale(locale);var localeFormats=Time.relativeTimeFormats[locale];var days_ago=Time.calc_days_ago(date);if(days_ago!=0)return Time.relative_day(date,format,locale);var secondsAgo=(new Date-date)/1E3;var minutesAgo=secondsAgo/60;var hoursAgo=minutesAgo/60;secondsAgo=Math.floor(secondsAgo);minutesAgo=Math.floor(minutesAgo);hoursAgo=Math.floor(hoursAgo);var str;var vars={};if(hoursAgo>4)return localeFormats.today;else if(hoursAgo>1){vars.hours_ago=hoursAgo;str=localeFormats.hours_ago}else if(hoursAgo>
0)return localeFormats.one_hour_ago;else if(minutesAgo>1){vars.minutes_ago=minutesAgo;str=localeFormats.minutes_ago}else if(minutesAgo>0)return localeFormats.one_minute_ago;else if(secondsAgo>15){vars.seconds_ago=secondsAgo;str=localeFormats.seconds_ago}else return localeFormats.just_now;return str.replace(/\{\{(.*?)\}\}/g,function(w,expr){return vars[expr]})},relativeDurationFormats:{en:{days:"{{days}} days",day:"1 day",hours:"{{hours}} hours",hour:"1 hour",minutes:"{{minutes}} minutes",minute:"1 minute",
less_than_a_minute:"under a minute"},fr:{days:"{{days}} jours",day:"Un jour",hours:"{{hours}} heures",hour:"1 heure",minutes:"{{minutes}} minutes",minute:"1 minute",less_than_a_minute:"sous une minute"},ja:{days:"{{days}}\u65e5",day:"1\u65e5",hours:"{{hours}}\u6642\u9593",hour:"1\u6642\u9593",minutes:"{{minutes}}\u5206",minute:"1\u5206",less_than_a_minute:"\u3082\u3046\u3059\u3050"}},relative_duration:function(time_seconds,locale){locale=Time.get_locale(locale);var localeFormats=Time.relativeDurationFormats[locale];
var minutes=time_seconds/60;var hours=time_seconds/3600;var days=time_seconds<86400?0:time_seconds/86400;minutes=Math.floor(minutes);hours=Math.floor(hours);days=Math.round(days);var str;var vars={};if(days>1){vars.days=days;str=localeFormats.days}else if(days==1)return localeFormats.day;else if(hours>1){vars.hours=hours;str=localeFormats.hours}else if(hours==1)return localeFormats.hour;else if(minutes>1){vars.minutes=minutes;str=localeFormats.minutes}else if(minutes==1)return localeFormats.minute;
else return localeFormats.less_than_a_minute;return str.replace(/\{\{(.*?)\}\}/g,function(w,expr){return vars[expr]})},toUpcomingDate:function(date,asUTC){if(Y.lang.isString(date))date=new Date(date);return Time.getMonthName(date[asUTC?"getUTCMonth":"getMonth"]())+" "+date[asUTC?"getUTCDate":"getDate"]()},getMonthName:function(i){var m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return m[i]},strToDate:function(str){if(!str)return null;str=str.replace(/-/g,"/");if(!~str.indexOf("UTC")&&
!~str.indexOf("GMT"))str+=" UTC";var d=new Date(str);var missingYearResultsInNaN=isNaN(new Date("3/7"));var tryAddingYear=isNaN(d)||!missingYearResultsInNaN;if(tryAddingYear){var recentMonths=3;var mindate=new Date;mindate.setMonth(mindate.getMonth()-recentMonths);var year=(new Date).getFullYear()-1;for(var y=year;y<year+3;y++){var candiDate=new Date(str+" "+y);if(candiDate>mindate){d=candiDate;break}}if(isNaN(d))return null}else{var fullYear=d.getFullYear();if(fullYear<2E3&&str.indexOf(fullYear)==
-1){var twoDigitYearStr=fullYear.toString().substr(2,2);var twoDigitYear=parseInt(twoDigitYearStr);var offset=25;var twoDigitCutoff=parseInt(((new Date).getFullYear()+25).toString().substr(2,2));if(twoDigitYear<=twoDigitCutoff)d.setFullYear(fullYear+100)}}return d},tables:{a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March",
"April","May","June","July","August","September","October","November","December"],p:["AM","PM"],P:["A","P"]},formats:{"a":function(d){return Time.tables.a[d.getUTCDay()]},"A":function(d){return Time.tables.A[d.getUTCDay()]},"b":function(d){return Time.tables.b[d.getUTCMonth()]},"B":function(d){return Time.tables.B[d.getUTCMonth()]},"-d":function(d){return d.getUTCDate()},"d":function(d){return TextFormat.pad(d.getUTCDate(),"0",10)},"e":function(d){return TextFormat.pad(d.getUTCDate()," ",10)},"H":function(d){return TextFormat.pad(d.getUTCHours(),
"0",10)},"-I":function(d){var I=d.getUTCHours()%12;return I===0?12:I},"I":function(d){var I=d.getUTCHours()%12;return TextFormat.pad(I===0?12:I,"0",10)},"l":function(d){var I=d.getUTCHours()%12;return I===0?12:I},"j":function(d){var ms=d-new Date(d.getUTCFullYear()+"/1/1 GMT");var doy=parseInt(ms/6E4/60/24,10)+1;return TextFormat.pad(doy,"0",100)},"-m":function(d){return d.getUTCMonth()+1},"m":function(d){return TextFormat.pad(d.getUTCMonth()+1,"0",10)},"M":function(d){return TextFormat.pad(d.getUTCMinutes(),
"0",10)},"p":function(d){return Time.tables.p[d.getUTCHours()>=12?1:0]},"P":function(d){return Time.tables.P[d.getUTCHours()>=12?1:0]},"s":function(d){return parseInt(d.getTime()/1E3)},"S":function(d){return TextFormat.pad(d.getUTCSeconds(),"0",10)},"u":function(d){var dow=d.getUTCDay();return dow===0?7:dow},"U":function(d){var doy=parseInt(Time.formats.j(d),10);var rdow=6-d.getUTCDay();var woy=parseInt((doy+rdow)/7,10);return TextFormat.pad(woy,"0",10)},"w":function(d){return d.getUTCDay().toString()},
"W":function(d){var doy=parseInt(Time.formats.j(d),10);var rdow=7-Time.formats.u(d);var woy=parseInt((doy+rdow)/7,10);return TextFormat.pad(woy,"0",10)},"y":function(d){return TextFormat.pad(d.getUTCFullYear()%100,"0",10)},"Y":function(d){return d.getUTCFullYear().toString()},"Z":function(d){return"UTC"},"%":function(d){return"%"}},aggregates:{"c":"%a %b %e %X %Y","x":"%m/%d/%y","X":"%H:%M:%S"},strftime:function(date,fmt){for(;fmt.match(/%[cDhnrRtTxX]/);)fmt=fmt.replace(/%([cDhnrRtTxX])/g,function(m0,
m1){return Time.aggregates[m1]});fmt=fmt.replace(/%(\-[dmI])/g,function(m0,m1){return Time.formats[m1](date)});return fmt.replace(/%([aAbBCdegGHIjlmMpPsSuUVwWyYzZ%])/g,function(m0,m1){return Time.formats[m1](date)})}};
var TextFormat={currency:function(num,currencyInfo,numericOnly,informal,terse){if(num.is_money){if(!window.CurrencyData)Log.server("Missing CurrencyData for TextFormat.currency on "+window.location.pathname,"error");currencyInfo=window.CurrencyData.info[num.currency];num=num.amount/100}var fmt=currencyInfo||{prefix:"$",symbol:"USD",places:2};var places=num>=1||num==0?fmt.places:2;if(informal&&num>=1&&Math.round(num)==num)places=0;var base=num.toFixed(places);if(numericOnly)return base;base=TextFormat.commafyNumber(base);
if(fmt.symbol&&!terse)base+=" "+fmt.symbol;return fmt.prefix_utf8+base},money:function(input,currency,format){if(!window.CurrencyData)Log.server("Missing CurrencyData for TextFormat.money on "+window.location.pathname,"error");if(input&&input.is_money){if("number"===typeof currency)format=currency;currency=input.currency;input=input.amount/100}input=input||0;currency=currency||"USD";format=format||1;var fmt=CurrencyData.info[currency];var places=fmt.places;var isWholeNumber=input===Math.round(input);
if(isWholeNumber){if(format===2||format===7||format===9)places=0}else if(places===0)places=2;var s=input.toFixed(places);if(format!==5&&format!==8&&format!==9)s=this.commafyNumber(s);if(format===4)if(s[0]==="-")s="("+s.substr(1)+")";if(format===1||format===2)s=fmt.prefix_utf8+s;else if(format===6||format===7)s=fmt.prefix_utf8+" "+s;if(format===5)s=Array(8-s.length).join(" ")+s;return s},million_usd:function(value,locale){var s="";switch(locale){case "ja":if(value>=100)s=(value/100).toFixed(1)+"\u5104\u30c9\u30eb";
else s=(value*100).toFixed(0)+"\u4e07\u30c9\u30eb";break;case "fr":if(value>=100)s=value.toFixed(0)+" millions de dollars";else s=value.toFixed(1)+" millions de dollars";s=s.replace(".",",");break;default:if(value>=100)s="$"+value.toFixed(0)+" million";else s="$"+value.toFixed(1)+" million";break}return s},toMb:function(num,si){var base=si?1E3:1024;var d=1;var n=base;var m=Iter.find([" bytes","K","MB","GB","TB","PB"],function(){if(num<n)return true;else{d=n;n*=base;return false}});if(!m)return num.toString();
var a=Math.round(num/d*10);if(a%10==0)return a/10+m;else return(a/10).toFixed(1)+m},pad:function(x,str,r){for(x=x.toString();parseInt(x,10)<r&&r>1;r/=10)x=str+x;return x},_determine_locale_separators:function(){var test=(1.2).toFixed(1);if(test.indexOf(".")>=0)TextFormat._separators={decimal:".",thousands:","};else TextFormat._separators={decimal:",",thousands:"."}},commafyNumber:function(str){if(!TextFormat._separators)TextFormat._determine_locale_separators();var parts=str.split(TextFormat._separators.decimal);
var intpart=parts[0];var decimalpart=parts[1]?TextFormat._separators.decimal+parts[1]:"";var isNeg=false;if(intpart==0&&!decimalpart)return"0";if(intpart.substr(0,1)==="-"){intpart=intpart.substr(1);isNeg=true}var length=intpart.length;var out="";for(var i=0;(length-i)%3>0;){out+=intpart.substr(i,1);i++}if(out.length>0&&length-i>0)out+=TextFormat._separators.thousands;for(;length-i>3;){out+=intpart.substr(i,3)+TextFormat._separators.thousands;i+=3}if(length-i>0)out+=intpart.substr(i);return(isNeg?
"-":"")+out+decimalpart},noOrphan:function(str){return str.replace(/([^ ]+) +([^ ]+)$/,"$1\u00a0$2")}};function addExpandEventListeners(field){$(field).off(".bcExpand").on("paste.bcExpand keyup.bcExpand focus.bcExpand",updateFieldHeight)}
function updateFieldHeight(event){var field=event.target;var maxHeight=250;var clientHeight=parseInt(field.clientHeight);var scrollHeight=parseInt(field.scrollHeight);if(scrollHeight>clientHeight){if(scrollHeight>maxHeight)scrollHeight=maxHeight;field.style.height=scrollHeight+"px"}}function addShrinkEventListeners(field,maxInactiveHeight){$(field).blur(function(event){shrinkFieldHeight(event,maxInactiveHeight)})}
function shrinkFieldHeight(event,maxInactiveHeight){var field=event.target;var contentHeight=parseInt(field.scrollHeight);if(contentHeight>maxInactiveHeight)field.style.height=maxInactiveHeight+"px"}
function addCharacterCountdownEventListeners(field,counterDiv,max){function update(doTruncate){var remaining=max-$(field).val().length;$(counterDiv).toggleClass("notable",remaining<=0);if(remaining<0&&doTruncate){$(field).val($(field).val().substr(0,max));remaining=0}$(counterDiv).find(".counter").text(""+remaining)}$(field).on("input",function(){update(true)});if(!("oninput"in field)||Browser.make==="ie"&&Browser.version[0]<=9)$(field).on("paste cut keyup",function(){setTimeout(update,0,true)});
update(false)}function InterruptibleTimer(){this._timer=null}InterruptibleTimer.prototype={start:function(code,delay){this.stop();this._timer=setTimeout(code,delay)},stop:function(){clearTimeout(this._timer)}};
var FarbLoader={_ready:false,whenready:function(callback){if(FarbLoader._ready){callback();return}var cssLoaded=false;var scriptLoaded=false;var checkinit=function(){if(cssLoaded&&scriptLoaded){FarbLoader._ready=true;callback()}};var cssSuccessFn=function(){Log.debug("farb css loaded");cssLoaded=true;checkinit()};var scriptSuccessFn=function(){Log.debug("farb script loaded");scriptLoaded=true;checkinit()};YAHOO.util.Get.css(FarbtasticUrls.css,{onSuccess:cssSuccessFn});YAHOO.util.Get.script(FarbtasticUrls.js,
{onSuccess:scriptSuccessFn})}};
var PopupPicker={pick:function(x,y,startcolor,onchange){var event=$.Event("click",{pageX:x,pageY:y});if(!startcolor)startcolor="#FF0000";var dialog=$("\x3cdiv\x3e").dialog({dialogClass:"popuppicker",width:"225",modal:true,position:{my:"center",at:"center",of:event}});dialog.html("\x3cdiv id\x3d'popup_picker'\x3e\x3cdiv id\x3d'picker_container'\x3e\x3c/div\x3e\x3cdiv class\x3d'swatches'\x3e\x3cspan id\x3d'picker_oldcolor' class\x3d'swatch'\x3e\x3c/span\x3e\x3cspan id\x3d'picker_newcolor' class\x3d'swatch'\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e");var oldswatch=
$("#picker_oldcolor");var newswatch=$("#picker_newcolor");var currentcolor=startcolor;dialog.on("dialogbeforeclose",function(){onchange(currentcolor,true)});var colorpicked=function(color){newswatch.css("background",color);currentcolor=color;onchange(currentcolor,false)};FarbLoader.whenready(function(){var farb=$.farbtastic("#picker_container",colorpicked);farb.setColor(startcolor);$("#picker_oldcolor,#picker_newcolor").css("background",farb.color);oldswatch.click(function(){currentcolor=startcolor;
farb.setColor(currentcolor)})});return dialog},destroy:function(picker){picker.remove()}};
var WatchInput={watchInput:function(eltID,defaultValue,valueType){$assert(typeof eltID=="string");if(this.__watching==null)this.__watching={};var stuff=this.__watching[eltID]={};stuff.__watchInput_elt=eltID;stuff.__watchInput_default=defaultValue;stuff.__watchInput_type=valueType||"float";var Self=this;setTimeout(function(){Self.__watchInput(eltID)},500)},__watchInput:function(whichID){var stuff=this.__watching[whichID];if(!stuff)return;var e$$0;var el=elt(stuff.__watchInput_elt);if(!el){this.__watching[whichID]=
null;return}var val=el.value==undefined?el.innerHTML:el.value;switch(stuff.__watchInput_type){case "float":var amt=parseFloat(val);if(isNaN(amt))amt=stuff.__watchInput_default;break;case "integer":amt=parseInt(val);if(isNaN(amt))amt=stuff.__watchInput_default;break;default:amt=val;break}if(amt!=stuff.__watchInput_Last&&this.inputChanged)try{this.inputChanged(amt,stuff.__watchInput_elt)}catch(e){Log.error(e)}stuff.__watchInput_Last=amt;var Self=this;setTimeout(function(){Self.__watchInput(whichID)},
500)}};
var Expression={eval:function(expr,eval_lambda,handle_constants){var p=this.init(expr,eval_lambda,handle_constants);var value=this.parse_top(p);if(this.next_token(p).kind!="end")throw"Expression error: '"+p.expr+"' -- end expected";return value},dump:function(expr,eval_lambda,handle_constants){for(var p=this.init(expr,eval_lambda,handle_constants);true;){var t=this.next_token(p);console.log(t.kind+" "+t.value);if(t.kind=="end")break}},init:function(expr,eval_lambda,handle_constants){var p={};p.expr=
expr;p.handle_constants=handle_constants;p.eval_lambda=eval_lambda;p.return_prev_token=false;p.short_circuit=false;return p},OPERATORS:["||","\x26\x26","\x3c\x3d","\x3d\x3d","!\x3d","\x3e\x3d","\x3c","\x3e","+","-","*","/","%","!","(",")"],next_token:function(p){if(p.return_prev_token){p.return_prev_token=false;return p.previous_token}var token={};p.expr=p.expr.replace(/^\s+/,"");if(p.expr=="")token.kind="end";else{for(var i=0;i<this.OPERATORS.length;++i){var op=this.OPERATORS[i];if(p.expr.substr(0,
op.length)==op){token.kind=op;p.expr=p.expr.slice(op.length);break}}if(!token.kind){var m;m=p.expr.match(/^(\'[^\']*\')/)||p.expr.match(/^(\"[^\"]*\")/)||p.expr.match(/([^\s\+\-\*\/\%\(\)\<\=\>\!\&\|\'\"]+)/);if(m){token.value=m[1];token.kind="term";p.expr=p.expr.slice(token.value.length)}}}p.previous_token=token;return token},backup:function(p){p.return_prev_token=true},is_true:function(val){return val!==false&&val!=null},parse_top:function(p){return this.parse_boolean_op(p)},parse_boolean_op:function(p){for(var value=
this.parse_comparison_op(p);true;)switch(this.next_token(p).kind){case "||":if(this.is_true(value)){var s=p.short_circuit;p.short_circuit=true;this.parse_boolean_op(p);p.short_circuit=s}else value=this.parse_comparison_op(p);break;case "\x26\x26":if(!this.is_true(value)){s=p.short_circuit;p.short_circuit=true;this.parse_boolean_op(p);p.short_circuit=s}else value=this.parse_comparison_op(p);break;default:this.backup(p);return value}},parse_comparison_op:function(p){var value=this.parse_additive_op(p);
for(var op;true;)switch(op=this.next_token(p).kind){case "\x3c":case "\x3c\x3d":case "\x3d\x3d":case "!\x3d":case "\x3e\x3d":case "\x3e":value=this.evaluate_comparison(op,value,this.parse_additive_op(p));break;default:this.backup(p);return value}},evaluate_comparison:function(op,l,r){if(op==="\x3d\x3d")if(l&&l.is_money)return r&&r.is_money&&l.currency===r.currency&&l.amount===r.amount;else return l==r;else if(op==="!\x3d")return!this.evaluate_comparison("\x3d\x3d",l,r);else{if("undefined"===typeof l||
"undefined"===typeof r)Log.error("Expression: inequality comparison with an undefined operand will always return false");if(l&&l.is_money){if(!(r&&r.is_money))throw"money cannot be compared with non-money";if(l.currency!==r.currency)throw"money comparison currency mismatch";l=l.amount;r=r.amount}switch(op){case "\x3c":return l<r;case "\x3e":return l>r;case "\x3c\x3d":return l<=r;case "\x3e\x3d":return l>=r;default:throw"invalid comparison operator: "+op;}}},parse_additive_op:function(p){for(var value=
this.parse_multiplicative_op(p);true;)switch(this.next_token(p).kind){case "+":value+=this.parse_multiplicative_op(p);break;case "-":value-=this.parse_multiplicative_op(p);break;default:this.backup(p);return value}},parse_multiplicative_op:function(p){for(var value=this.parse_term(p);true;)switch(this.next_token(p).kind){case "*":value*=this.parse_term(p);break;case "/":value/=this.parse_term(p);break;case "%":value%=this.parse_term(p);break;default:this.backup(p);return value}},parse_term:function(p){var token=
this.next_token(p);var value;switch(token.kind){case "(":value=this.parse_top(p);if(this.next_token(p).kind!=")")throw"Expression error: '"+p.expr+"' -- unbalanced parentheses";break;case "+":value=this.parse_term(p);break;case "-":value=-this.parse_term(p);break;case "!":value=!this.is_true(this.parse_term(p));break;case "term":if(!p.short_circuit){var con=p.handle_constants;if(con){con=this.constant(token.value);if(con)value=con.v}if(!con)if(p.eval_lambda)value=p.eval_lambda(token.value);else throw"Expression error: '"+
p.expr+"' -- not a term";}}return p.short_circuit?1:value},constant:function(x){var m;if(x.match(/^\d/))if(x.match(/e|E|\./))return{"v":parseFloat(x)};else return{"v":parseInt(x)};else if(m=x.match(/^\'(.*)\'$/)||x.match(/^\"(.*)\"$/))return{"v":m[1]};else if(x=="true")return{"v":true};else if(x=="false")return{"v":false};else if(x=="nil")return{"v":null};else return null}};
var StatusSpinny={spinnyID:"status-spinny",spinningClass:"spinning",timeouts:[],showQueue:[],showingQueue:false,isShown:false,spinny:function(spins){var spinnyEl=$("#"+StatusSpinny.spinnyID);if(spinnyEl.length===0)spinnyEl=$('\x3cdiv id\x3d"'+StatusSpinny.spinnyID+'"\x3e\x3c/div\x3e').appendTo(document.body);if(typeof spins=="boolean")spinnyEl[spins?"addClass":"removeClass"](StatusSpinny.spinningClass);return spinnyEl},show:function(speed,spins,message,duration){if(message===undefined||message==null)message=
"";StatusSpinny.resetTimeouts();var showFn=function(){StatusSpinny.isShown=true;StatusSpinny.spinny(spins).html(message).fadeIn(speed);if(typeof duration=="number")StatusSpinny.timeout(duration)};if(StatusSpinny.isShown)StatusSpinny.scheduleShow(message,showFn);else showFn()},scheduleShow:function(message,showFn){StatusSpinny.showQueue.push({message:message,fn:showFn});if(!StatusSpinny.showingQueue){StatusSpinny.showingQueue=true;var runShowScheduler=function(){StatusSpinny.hide(100,null,function(){if(StatusSpinny.showQueue.length>
2){for(var queuedShow=StatusSpinny.showQueue.shift();StatusSpinny.showQueue.length>1&&queuedShow.message==StatusSpinny.showQueue[1].message;)StatusSpinny.showQueue=StatusSpinny.showQueue.slice(2);queuedShow.fn()}else if(StatusSpinny.showQueue.length>0)StatusSpinny.showQueue.shift().fn();else{StatusSpinny.showingQueue=false;return null}window.setTimeout(runShowScheduler,1500)})};runShowScheduler()}},wouldShowAfter:function(afterTime,speed,spins,message,duration){var uniqueTimeoutID=StatusSpinny.timeoutId();
var spinny=StatusSpinny.spinny();spinny.on(uniqueTimeoutID,function(){StatusSpinny.show(speed,spins,message,duration)});window.setTimeout(function(){spinny.trigger(uniqueTimeoutID)},afterTime);return uniqueTimeoutID},hide:function(speed,cancelID,animCB){if(cancelID!==undefined&&typeof cancelID=="string")StatusSpinny.spinny().off(cancelID);if(speed===undefined)speed="fast";StatusSpinny.spinny().fadeOut(speed,animCB);StatusSpinny.isShown=false},timeout:function(duration){var uniqueTimeoutID=StatusSpinny.timeoutId();
var spinny=StatusSpinny.spinny();spinny.on(uniqueTimeoutID,StatusSpinny.hide);StatusSpinny.timeouts.push(uniqueTimeoutID);window.setTimeout(function(){spinny.trigger(uniqueTimeoutID)},duration)},resetTimeouts:function(){for(;StatusSpinny.timeouts.length>0;)StatusSpinny.spinny().off(StatusSpinny.timeouts.shift())},timeoutId:function(){return(new Date).getTime()+""+Math.random()},zzz:null};
$.extend(Url,{parseVideoURL:function(url){var parts=Url.toHash(url);var params=Url.parseQuery(parts.search);var path=parts.pathname.replace(/^\/*(.*?)\/*$/,"$1");var youtubeIDRe=/^[\w,\-]+$/;var vimeoIDRe=/^\d+$/;var id=null;var type=null;if(parts.protocol)if(/(^|\.)youtube\.com$/.test(parts.host)){if(/^\/watch\/?$/.test(parts.pathname)&&youtubeIDRe.test(params["v"])){id=params["v"];type="y"}}else if(/(^|\.)youtu\.be$/.test(parts.host)){if(youtubeIDRe.test(path)){id=path;type="y"}}else if(/(^|\.)vimeo\.com$/.test(parts.host))if(vimeoIDRe.test(path)){id=
path;type="v"}return{id:id,type:type}},makeVideoUrl:function(videoID,videoType){if(videoID)switch(videoType){case "y":return"http://www.youtube.com/watch?v\x3d"+encodeURIComponent(videoID);case "v":return"http://vimeo.com/"+encodeURIComponent(videoID)}return null}});
var EmailAddressPattern={toHash:function(str){var EMAIL_ADDRESS_PATTERN=/^([^\s\(\)"'\/><,@]+)@(\w[^\s\(\)"'\/><&,@]*\w)?\.(\w[^\s\(\)"'\/><&,@]*\w)$/;var matches=str.match(EMAIL_ADDRESS_PATTERN);return!matches?null:{address:matches[0],left:matches[1],domain:matches[2],tld:matches[3]}}};var TaskQueue=function(){this.queue=[]};TaskQueue.prototype.addTask=function(task,delay){this.queue.push({task:task,delay:delay})};
TaskQueue.prototype.run=function(){var item=this.queue.shift();var self=this;if(item)setTimeout(function(){item.task();self.run()},item.delay)};var PromiseQueue=function(){this._queue=[]};PromiseQueue.prototype.add=function(fn){this._queue.push(fn);if(this._queue.length===1)this.execute()};PromiseQueue.prototype.execute=function(){var self=this;if(this._queue.length===0)return;var firstFn=this._queue[0];firstFn().then(function(){self._queue.splice(self._queue.indexOf(firstFn),1);self.execute()})};
var Templ=function(){function formatAsterisks(input,tag){input=""+input;var out="";for(ASTERISKS_REGEXP.lastIndex=0;true;){var start=ASTERISKS_REGEXP.lastIndex;var m=ASTERISKS_REGEXP.exec(input);if(m){out+=input.substring(start,m.index);out+=m[1];if(tag)out+="\x3c"+tag+"\x3e";out+=m[2];if(tag)out+="\x3c/"+tag+"\x3e"}else{out+=input.substring(start,input.length);break}}return out}function equalOperator(l,r){if(l==Templ.EMPTY)return l.equals(r);else if(r==Templ.EMPTY)return r.equals(l);else return Expression.evaluate_comparison("\x3d\x3d",
l,r)}function addNoFollow(display,linkAttribs){var host=display.split("/")[0];var m;if(BANDCAMP_DOT_COM_REGEX.test(host))return linkAttribs;else if(m=REL_ATTR_REGEX.exec(linkAttribs)){var val=m[1];if(val.indexOf("nofollow")===-1)val+=" nofollow ugc";return linkAttribs.substring(0,m.index)+'rel\x3d"'+val+'"'+linkAttribs.substring(m.index+m[0].length)}else return linkAttribs+' rel\x3d"nofollow ugc"'}var EN_DEFAULT="en";var pageData$$0=$("#pagedata").data("blob");var locale=pageData$$0&&pageData$$0.locale||
EN_DEFAULT;var locale_suffix=locale!==EN_DEFAULT?"."+locale:"";var start_re="(\\s+|^)";var open_paren_re="(\\()?";var scheme_re="(http://|https://)?";var host_re="(([^@\\./\\s\\/'\"\x3e\x3c\x26]+)(\\.[^@\\./\\s\\/'\"\x3e\x3c\x26]+)*(\\.[a-z]{2,}))";var port_re="(?::\\d+)?";var path_re="(/[^?\\s]*?)?";var params_re="(\\?[^#\\s]*?)?";var anchor_re="(#[^\\s]*?)?";var close_paren_re="(\\))?";var end_re="([.,;](\\s|$)|\\s+|$)";var email_address_re="([^\\s\\(\\)\"'/\x3e\x3c,@]+@\\w([^\\s\\(\\)\"'/\x3e\x3c\x26,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/\x3e\x3c\x26,@]*\\w)";
var email_start_re="(\\s+\\(?|^\\(?)";var email_end_re="(\\)?\\s+|\\)?$)";var url_or_email_loose_contextual=new RegExp(start_re+open_paren_re+scheme_re+host_re+port_re+path_re+params_re+anchor_re+close_paren_re+end_re+"|"+email_start_re+email_address_re+email_end_re,"i");var tld_set={".com":true,".ru":true,".org":true,".net":true,".de":true,".jp":true,".uk":true,".br":true,".it":true,".pl":true,".fr":true,".in":true,".au":true,".ir":true,".info":true,".nl":true,".cn":true,".es":true,".cz":true,".kr":true,
".ca":true,".eu":true,".ua":true,".co":true,".gr":true,".za":true,".ro":true,".biz":true,".ch":true,".se":true,".tw":true,".mx":true,".vn":true,".hu":true,".be":true,".tr":true,".at":true,".dk":true,".tv":true,".me":true,".ar":true,".sk":true,".no":true,".us":true,".fi":true,".id":true,".cl":true,".xyz":true,".io":true,".pt":true,".by":true,".il":true,".ie":true,".nz":true,".kz":true,".hk":true,".lt":true,".cc":true,".my":true,".sg":true,".club":true,".bg":true,".edu":true,".pk":true,".su":true,".top":true,
".th":true,".hr":true,".rs":true,".pe":true,".pro":true,".si":true,".lv":true,".az":true,".pw":true,".ae":true,".ph":true,".online":true,".ng":true,".ee":true,".ws":true,".ve":true,".pizza":true,".cat":true};var BANDCAMP_DOT_COM_REGEX=/\.?bandcamp.com$/i;var REL_ATTR_REGEX=/\brel=["']([^"']*)["']/i;var ASTERISKS_REGEXP=/(^|\s)\*(\S|\S.*?\S)\*(?=\s|$)/g;return{cfgFlags:pageData$$0&&pageData$$0.cfg||{},locale:locale,locale_suffix:locale_suffix,templates:{},globals:null,register:function(hashOfTemplates){$.extend(Templ.templates,
hashOfTemplates)},refresh:function(set){$assert(set);var url="/js_templates?x\x3d"+Math.random()+"\x26set\x3d"+set;var head=document.getElementsByTagName("head")[0];var newscript=document.createElement("script");newscript.type="text/javascript";newscript.src=url;head.appendChild(newscript)},getGlobals:function(){if(!Templ.globals){var pageData=$("#pagedata").data("blob");var newGlobals=pageData&&pageData.templglobals;var oldGlobals=typeof TemplGlobals!="undefined"?TemplGlobals:null;Templ.globals=
$.extend({},oldGlobals,newGlobals)}return Templ.globals},RENDER_SPEED_TEST:false,render:function(templName,hash){var myhash=$.extend({},Templ.getGlobals(),hash);var context=new Templ.Context(myhash);var out=[];if(this.RENDER_SPEED_TEST){Log.debug("\x3e\x3e\x3e start rendering "+templName);var start_date=new Date;for(var i=0;i<100;++i){out=[];Templ.renderInternal(templName,context,out)}var end_date=new Date;Log.debug("\x3e\x3e\x3e end rendering "+templName+" - "+(end_date-start_date)/100+"ms")}else{Templ.current_context=
context;Templ.renderInternal(templName,context,out);Templ.current_context=null}return out.join("")},runWithContext:function(cb){var context=new Templ.Context(Templ.getGlobals());Templ.current_context=context;cb();Templ.current_context=null},renderElem:function(el,templName,hash){console.log("element",el);el=elt(el);Y.util.Dom.batch(Y.util.Dom.getChildren(el),function(thisEl){Y.util.Event.purgeElement(thisEl,true)});el.innerHTML=Templ.render(templName,hash)},renderTableRow:function(el,templName,hash){el=
elt(el);Y.util.Dom.batch(Y.util.Dom.getChildren(el),function(thisEl){Y.util.Event.purgeElement(thisEl,true)});var parent=document.createElement("DIV");parent.innerHTML="\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e"+Templ.render(templName,hash)+"\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e";for(var newrow=parent.firstChild.firstChild.firstChild;el.firstChild!=null;)el.removeChild(el.firstChild);for(;newrow.firstChild!=null;)el.appendChild(newrow.removeChild(newrow.firstChild))},renderInternal:function(templName,
context,out){var tokens=Templ.templates[templName+Templ.locale_suffix]?Templ.templates[templName+Templ.locale_suffix]:Templ.templates[templName];if(!tokens){var msg="[template not found: "+templName+"]";out.push(msg);Log.server(msg,"warn")}else Templ.renderTokens(tokens,context,out)},renderTokens:function(tokens,context,out){if(tokens)for(var i=0;i<tokens.length;i++){var token=tokens[i];if(typeof token==="string")out.push(token);else try{Templ.renderOneToken(token,context,out)}catch(e){Log.error("Error rendering token",
token,"context",context);throw e;}}},renderOneToken:function(token,context,out){var i;var block;switch(token.type){case "translate":Templ.renderTokens(token.nodelist,context,out);break;case "translatePlural":for(i=0;i<token.blocks.length;i++){block=token.blocks[i];if(Templ.evalNCondition(block,context)){Templ.renderTokens(block.attachment,context,out);break}}break;case "translateVariable":Templ.renderTokens(token.nodelist,context,out);break;case "variable":if(!token.name)return;var value=Expression.eval(token.name,
function(term){return context.resolve(term)});var filters=Templ.filters;Iter.each(token.filters,function(filterToken){var args=Iter.collect(filterToken[1],function(thisArg){return context.resolve(thisArg)});var filterFn=filterToken[0]?filters[filterToken[0]]:null;if(!filterFn){value="[template error: filter not found: "+filterToken[0]+"]";Log.error(value)}else{args.unshift(value);value=filterFn.apply(null,args)}});if(value!=null){if($.isArray(value))value=value.join("");out.push(value)}break;case "assign":context.hash[token.to]=
context.resolve(token.from);break;case "case":case "if":var blocks=token.blocks;for(i=0;i<blocks.length;i++){block=blocks[i];if(Templ.evalCondition(block,context)){Templ.renderTokens(block.attachment,context,out);break}}break;case "for":var collection=context.resolve(token.collection_name);if(collection instanceof Templ.Range)collection=collection.expand();var nodelist=token.nodelist;var offset=token.attribs.offset!=null?context.resolve(token.attribs.offset):0;var limit=collection?collection.length-
offset:0;if(token.attribs.limit!=null)limit=Math.min(limit,context.resolve(token.attribs.limit));var collectionSlice=collection?collection.slice(offset,offset+limit):[];if(token.reversed)collectionSlice.reverse();context.stashLoopvars();for(i=0;i<limit;i++){context.hash[token.variable_name]=collectionSlice[i];context.hash.forloop={"length":limit,"index":i+1,"index0":i,"rindex":limit-i,"rindex0":limit-i-1,"first":i===0,"last":i===limit-1};Templ.renderTokens(nodelist,context,out)}context.restoreLoopvars();
break;case "include":var subtemplateName=context.resolve(token.template_name);Templ.renderInternal(subtemplateName,context,out);break;case "capture":var capture_out=[];Templ.renderTokens(token.nodelist,context,capture_out);var strval="";for(i=0;i<capture_out.length;i++)strval+=capture_out[i];context.hash[token.to]=strval;break;case "ef":blocks=token.blocks;for(i=0;i<blocks.length;i++){block=blocks[i];if(Templ.evalNCondition(block,context)){Templ.renderTokens(block.attachment,context,out);break}}break;
case "let":context.hash[token.variable]=Expression.eval(token.expression,function(term){return context.resolve(term)});break}},evalNCondition:function(block,context){if(block.type=="else_ncondition")return true;return Templ.isTrue(Expression.eval(block.expression,function(term){return context.resolve(term)}))},evalCondition:function(block,context){if(block.type=="else_condition")return true;var result;var left=context.resolve(block.left);var operator=block.operator;if(!operator)result=Templ.isTrue(left);
else{var operatorFn=Templ.operators[operator];if(!operatorFn){Log.error("template: unrecognized operator: "+operator);return false}var right=context.resolve(block.right);result=operatorFn(left,right)}if(block.child_relation=="or")result=Templ.isTrue(result)||Templ.isTrue(Templ.evalCondition(block.child_condition,context));else if(block.child_relation=="and")result=Templ.isTrue(result)&&Templ.isTrue(Templ.evalCondition(block.child_condition,context));return result},isTrue:function(val){return val!==
false&&val!=null},EMPTY:{equals:function(other){if(other==this)return true;return!other||other.toString()===""}},Range:function(start,end){this.start=start;this.end=end;this.expand=function(){var out=[];for(var i=this.start;i<=this.end;i++)out.push(i);return out}},operators:{"\x3d\x3d":equalOperator,"!\x3d":function(l,r){return!equalOperator(l,r)},"\x3c\x3e":function(l,r){return!equalOperator(l,r)},"\x3c":function(l,r){return Expression.evaluate_comparison("\x3c",l,r)},"\x3e":function(l,r){return Expression.evaluate_comparison("\x3e",
l,r)},"\x3c\x3d":function(l,r){return Expression.evaluate_comparison("\x3c\x3d",l,r)},"\x3e\x3d":function(l,r){return Expression.evaluate_comparison("\x3e\x3d",l,r)},"contains":function(l,r){if(typeof l==="string")return l.indexOf(r)>=0;if($.isArray(l)){for(var i=0;i<l.length;i++)if(l[i]==r)return true;return false}if(l instanceof Templ.Range)return r>=l.start&&r<=l.end;return false}},filters:{size:function(input){return input?input.length:0},downcase:function(input){return input!=null?input.toString().toLowerCase():
""},upcase:function(input){return input!=null?input.toString().toUpperCase():""},escape:function(input){return input!=null?Text.escapeHtml(input.toString()):""},escape_html_attr:function(input){return Templ.filters.escape(input)},noblanks:function(input,aggressive){var s;if(aggressive)s=input.replace(/(\n *)+/g,"").replace(/\n--/g,"\n");else s=input.replace(/(\n *)+/g,"\n").replace(/\n--/g,"\n");return s},strip:function(input){return input!=null?input.toString().trim():""},strip_html:function(input){return input!=
null?input.toString().replace(/<.*?>/g,""):""},strip_newlines:function(input){return input!=null?input.toString().replace(/\n/g,""):""},newline_to_br:function(input){return input!=null?input.toString().replace(/\n/g,"\x3cbr /\x3e\n"):""},newline_to_gap:function(input){return input!=null?input.toString().replace(/\n[\r\t ]*\n/g,'\x3cbr /\x3e\x3cspan class\x3d"lightweightBreak" /\x3e\x3c/span\x3e\x3cbr /\x3e').replace(/\n/g,"\x3cbr /\x3e\n"):""},replace:function(input,str,repl){return Templ.filters.replace_regex(input,
Text.regexpEscape(str),repl)},replace_regex:function(input,str,repl){if(input==null)return"";if(repl==null)repl="";input=input.toString();var result=input.replace(new RegExp(str,"gm"),repl);return result},replace_first:function(input,str,repl){if(repl==null)repl="";return input!=null?input.toString().replace(str,repl):""},remove:function(input,str){return Templ.filters.replace(input,str)},remove_first:function(input,str){return Templ.filters.replace_first(input,str)},encode_uri_c:function(input){return input!=
null?encodeURIComponent(input).replace(/'/g,"%27"):""},join:function(input,glue){if(glue==null)glue=" ";return $.isArray(input)?input.join(glue):input},sort:function(input){function comparator(a,b){if(a>b)return 1;if(a<b)return-1;return 0}return $.isArray(input)?input.slice(0).sort(comparator):input},first:function(input){return $.isArray(input)?input[0]:null},last:function(input){return $.isArray(input)&&input.length?input[input.length-1]:null},edit_if_empty:function(input,club_id,fieldname,linktext){if(input&&
input.length>0)return input;return Templ.filters.edit_field(linktext,club_id,fieldname)},edit_field:function(linktext,club_id,fieldname){return'\x3ca href\x3d"/edit?id\x3d'+club_id+"\x26focus\x3d"+fieldname+'"\x3e'+linktext+"\x3c/a\x3e"},date:function(date,format){if(typeof date=="string")date=new Date(Date.parse(date));return Time.strftime(date,format)},time:function(input,format,timezone){return Time.to_ui(input,format,locale,timezone)},ui_datetime:function(input){return input?Time.toUi(input,false,
true):""},ui_date:function(input,fourDigitYear){return input?Time.toUiDate(input,fourDigitYear,true):""},to_date:function(input){return new Date(input*1E3)},relative_day:function(input,format){return input?Time.relative_day(input,format,locale):""},relative_time:function(input,format){return input?Time.relative_time(input,format,locale):""},relative_duration:function(input){return input?Time.relative_duration(input,locale):""},json:function(input){return JSON.stringify(input)},plural:function(input,
si,pl){if(pl==null)pl=si+"s";return input=="1"?si:pl},capitalize:function(input){return input.charAt(0).toUpperCase()+input.substring(1).toLowerCase()},capitalize_first_character:function(input){return input.charAt(0).toUpperCase()+input.slice(1)},titlecase:function(input){if(input!=null)return input.toString().replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()});else return""},currency:function(input,currency,numeric,informal,terse){if(input==null)return"";
return TextFormat.currency(input,window.CurrencyData?CurrencyData.info[currency||"USD"]:null,numeric,informal,terse)},money:function(input,currency,format){return TextFormat.money(input,currency,format)},million_usd:function(input){return TextFormat.million_usd(input,locale)},negate:function(input){if(input&&input.is_money)return{amount:-input.amount,currency:input.currency,is_money:true};else if("number"===typeof input)return-input;return""},abs:function(input){if(input&&input.is_money)return{amount:Math.abs(input.amount),
currency:input.currency,is_money:true};else if("number"===typeof input)return Math.abs(input);return""},truncate:function(input,len,ellipsis){ellipsis=ellipsis||"...";return Text.truncate(input,len,ellipsis)},add_query_parm:function(input,query_parm){if(!input)return"";if(query_parm===null||query_parm.length===0)return input;return input+(input.indexOf("?")>-1?"\x26":"?")+query_parm},mb:function(input){return TextFormat.toMb(input)},mb_si:function(input){return TextFormat.toMb(input,true)},url:function(input,
isHttps,prefix){var key=!isHttps?"url":"https_url";if(prefix){prefix=prefix+"";if(prefix.charAt(prefix.length-1)!="_")prefix=prefix+"_";key=prefix+key}return input[key]},commafy:function(input){return TextFormat.commafyNumber(""+input)},smallest_number_text:function(input,maxDigits){var number=parseInt(input);var text=number.toString();if(isNaN(number)||text.length<=maxDigits)return TextFormat.commafyNumber(text);var thousands=Math.floor(number/1E3*10)/10;if(thousands>0)text=thousands+"K";if(text.length<=
maxDigits)return text;thousands=Math.floor(thousands);if(thousands>0)text=thousands+"K";if(text.length<=maxDigits||number<1E6)return text;var millions=Math.floor(number/1E6*10)/10;text=millions+"M";if(text.length<=maxDigits)return text;millions=Math.floor(millions);text=millions+"M";if(text.length<=maxDigits)return text;return text},fan_link:function(input,style){return"\x3ca href\x3d'"+input.trackpipe_url+"' style\x3d'"+style+"'\x3e"+input.name+"\x3c/a\x3e"},html_autolink:function(input,linkAttribs){var result=
"";if(!input)return result;if(!linkAttribs)linkAttribs="";else if(linkAttribs[0]!==" ")linkAttribs=" "+linkAttribs;input=input.replace(/ +/g," ");var i=0;var m;for(var rest=input;i<300&&(m=url_or_email_loose_contextual.exec(rest));){i++;result+=Text.escapeHtml(rest.substring(0,m.index));rest=rest.substring(m.index+m[0].length);if(m[15]){result+=" ";result+=Text.escapeHtml(m[14].substring(m[14].length-1));result+='\x3ca href\x3d"mailto:';result+=Text.escapeHtml(m[15]);result+='"\x3e';result+=Text.escapeHtml(m[15]);
result+="\x3c/a\x3e";result+=Text.escapeHtml(m[17]===undefined?" ":m[17])}else{console.log(m);if(!m[3]&&!tld_set[m[7].toLowerCase()]){result+=m[0];continue}var display=[m[4],m[8]==="/"?"":m[8],m[9],m[10],m[11]].join("");var href=[m[3]||"http://",m[4],m[8],m[9],m[10],m[11]].join("");var extraClosingParen="";if(m[2]==="("&&href[href.length-1]===")"){href=href.substring(0,href.length-1);display=display.substring(0,display.length-1);extraClosingParen=")"}result+=" ";result+=Text.escapeHtml((m[1]||"")+
(m[2]||""));result+='\x3ca href\x3d"';result+=Text.escapeHtml(href);result+='"';result+=addNoFollow(display,linkAttribs);result+="\x3e";result+=Text.escapeHtml(display);result+="\x3c/a\x3e";result+=extraClosingParen;result+=Text.escapeHtml(m[12]===undefined?" ":m[12])}result+=" "}result+=Text.escapeHtml(rest);return result},plus:function(a,b){return a+b},minus:function(a,b){return a-b},times:function(a,b){return a*b},divided_by:function(a,b){if(a==Math.floor(a)&&b==Math.floor(b))return Math.floor(a/
b);else return a/b},image:function(info,format){var id_only=typeof info=="number"||!info;var image_id=id_only?info:info.image_id;var url=Templ.filters.image_url(image_id,format);if(id_only)return'src\x3d"'+url+'"';else{var dims=ImageUtils.imageDimensions(info.width,info.height,format);return'src\x3d"'+url+'" width\x3d"'+dims.width+'" height\x3d"'+dims.height+'"'}},image_url:function(image_id,format){return ImageUtils.imageURL(image_id,format,Templ.current_context.resolve("is_https"))},art:function(art_id,
format){var url=Templ.filters.art_url(art_id,format);return'src\x3d"'+url+'"'},art_url:function(art_id,format){return ImageUtils.artURL(art_id,format,Templ.current_context.resolve("is_https"))},popup_image:function(info,format){var id_only=typeof info=="number";var image_id=id_only?info:info.image_id;var url=Templ.filters.image_url(image_id,format);if(id_only)return'href\x3d"'+url+'"';else{var dims=ImageUtils.imageDimensions(info.width,info.height,format);return'href\x3d"'+url+'" data-image-size\x3d"'+
dims.width+","+dims.height+'"'}},image_width:function(info,format){var dims=ImageUtils.imageDimensions(info.width,info.height,format);return dims.width},image_height:function(info,format){var dims=ImageUtils.imageDimensions(info.width,info.height,format);return dims.height},possessify:function(name){if(name===null||typeof name!=="string")return name;if(!locale||locale==EN_DEFAULT)return/s$/.test(name)?name+"'":name+"'s";else return name},possessify_smart:function(name){if(name===null||typeof name!==
"string")return name;if(!locale||locale==EN_DEFAULT)return/s$/.test(name)?name+"\u2019":name+"\u2019s";else return name},enumerate_items:function(items,connector){if(typeof connector==="undefined")connector="and";var f=function(items){if(items.length===0||items===null)return"";if(items.length===1)return items[0];if(items.length===2)return items[0]+" "+connector+" "+items[1];return items[0]+", "+f(items.slice(1,items.length))};return f(items)},fan_page_url:function(username){return Templ.current_context.resolve("siteroot_current")+
"/"+username},band_url:function(url_hints){if(!url_hints)return"";var customDomain=url_hints.custom_domain;var customDomainVerified=url_hints.custom_domain_verified;var subdomain=url_hints.subdomain;var customDomainsActive=Templ.current_context.resolve("custom_domains_active");var basePortStr=Templ.current_context.resolve("base_port_str")||"";var baseDomainWithPort=Templ.current_context.resolve("sitedomain");if(customDomainsActive&&customDomain&&customDomainVerified)return"http://"+customDomain+basePortStr;
else if(subdomain)return location.protocol+"//"+subdomain+"."+baseDomainWithPort;return""},lpad:function(input,amount){if(typeof amount==="undefined")amount=10;input=String(input);var length=input.length;var result="";if(amount-length>0)result=(new Array(amount-length+1)).join(" ");return result+input},asterisks_to_em:function(input){return formatAsterisks(input,"em")},strip_asterisks:function(input){return formatAsterisks(input,null)},tralbum_url:function(url_hints){if(!url_hints)return"";var pagebase=
"";switch(url_hints.item_type){case "a":pagebase="/album/";break;case "t":pagebase="/track/";break;case "p":pagebase="/merch/";break;case "c":pagebase="/campaign/";break}return Templ.filters.band_url(url_hints)+pagebase+url_hints.slug},subscribe_url:function(url_hints){if(!url_hints)return"";var url_fragment=url_hints.subscribe_url_fragment||"subscribe";return Templ.filters.band_url(url_hints)+"/"+url_fragment},featured_track_url:function(url_hints,featured_track_number){if(!url_hints)return"";return Templ.filters.tralbum_url(url_hints)+
"?t\x3d"+featured_track_number},hex_to_rgb:function(hex){if(!hex)return null;if(hex[0]==="#")hex=hex.substring(1);if(!hex.match(/[0-9A-Fa-f]{6}/))return null;var bigint=parseInt(hex,16);var r=bigint>>16&255;var g=bigint>>8&255;var b=bigint&255;return r+", "+g+", "+b},fixnum:function(number,decimals){return number.toFixed(decimals)}},Context:function(hash){this.hash=hash||{};this.loopvars=null}}}();Templ.filters.h=Templ.filters.escape;Templ.filters.a=Templ.filters.attr=Templ.filters.escape_html_attr;
Templ.filters.u=Templ.filters.encode_uri_c;
Templ.Context.prototype=function(){return{resolve:function(name){switch(name){case null:case "nil":case "null":case "":return null;case "true":return true;case "false":return false;case "empty":return Templ.EMPTY}var match;if(match=/^'(.*)'$/.exec(name))return match[1];if(match=/^"(.*)"$/.exec(name))return match[1];if(/^\d+$/.test(name))return parseInt(name);if(match=/^\((\S+)\.\.(\S+)\)$/.exec(name))return new Templ.Range(this.resolve(match[1]),this.resolve(match[2]));if(/^(\d[\d\.]+)$/.test(name))return parseFloat(name);
return this.variable(name)},variable:function(nameExpr){var match=nameExpr.match(/\.(size|first|last)$/);if(match){var method=match[1];var methodVal=this.variable(nameExpr.substr(0,match.index));if(!(methodVal&&"object"===typeof methodVal&&methodVal.hasOwnProperty(method)))return Templ.filters[method](methodVal)}var val=null;try{val=eval("this.hash."+nameExpr)}catch(e){try{val=eval("this.hash."+nameExpr.replace(/\[([\w.]+)\]/,"[this.hash.$1]"))}catch(e2){Log.debug("Failed template hash lookup: ["+
nameExpr+"]; message: "+e2.message)}}return val},stashLoopvars:function(){var vars=this.hash.forloop;if(vars){this.loopvars=this.loopvars||[];this.loopvars.push(vars)}},restoreLoopvars:function(){if(this.loopvars)this.hash.forloop=this.loopvars.pop()}}}();
var HTMLEmbeddedPlayer3=function(){function HEP(playlist,params,playerdata){var self=this;this._playlist=playlist;this._params=params;this._playerdata=playerdata;this._tracklistelems=[];this._artist=playerdata.artist;this._elems={};this._root_elem=document.getElementById("player");for(var x in ALL_ELEMS){var name=ALL_ELEMS[x];this._elems[name]=document.getElementById(name)}this._albumtitle=playerdata.album_title;this._is_exclusive=!!params["esig"]||!!params["fesig"];this.effectively_single_track=
false;if(this._is_exclusive&&this._playlist.first_playable_track===this._playlist.last_playable_track)this.effectively_single_track=true;this._hookup_ui();if(params.bgcol){if(!params.transparent)this._elems.player.style.background="#"+params.bgcol;if(Color.isDark(params.bgcol)){addClass(document.body,"invertIconography");addClass(this._root_elem,"theme-dark")}}var is_twittercard=params.twittercard&&params.twittercard=="true";var linkurl=playerdata.linkback+"?from\x3d"+(is_twittercard?"twittercard":
"embed")+(params.daily?"\x26context\x3ddaily":"");var campaign_string="";if(params.campaign&&params.campaign!=""&&params.campaign.length<=50&&/^[a-z0-9_-]+$/.test(params.campaign)){campaign_string="\x26campaign\x3d"+params.campaign;linkurl+=campaign_string}this._elems.maintextlink.href=linkurl;this._elems.subtextlink.href=linkurl;this._elems.tracknamelink.href=linkurl;this._elems.artlink.href=linkurl;$(this._root_elem).find(".artlink").attr("href",linkurl);this._elems.infolink.href=linkurl;$(this._root_elem).find(".logo").attr("href",
linkurl);this._elems.logoalt.href=linkurl;this._elems.logoalt2.href=linkurl;this._elems.buyordownloadlink.href=playerdata.linkback+"?action\x3d"+(playerdata.linkback_action?playerdata.linkback_action:"download")+"\x26from\x3d"+(is_twittercard?"twittercard":"embed")+(params.daily?"\x26context\x3ddaily":"")+campaign_string;this._elems.buyordownloadlinkalt.href=this._elems.buyordownloadlink.href;this._elems.sharelink.href=playerdata.linkback+"?action\x3dshare"+"\x26from\x3d"+(is_twittercard?"twittercard":
"embed")+(params.daily?"\x26context\x3ddaily":"")+campaign_string;this._elems.sharelinkalt.href=this._elems.sharelink.href;$(this._elems.sharelink).click(this._makehandler("_handle_share_click"));$(this._elems.sharelinkalt).click(this._makehandler("_handle_share_click"));if(playerdata.linkback_action){var linkclass=playerdata.linkback_action=="buy"?"buy":"download";$(this._root_elem).addClass(linkclass);if(this._is_exclusive){if(playerdata.is_preorder)$(this._root_elem).addClass("preorder");else $(this._root_elem).addClass("optional-streaming");
this._elems.buyordownloadlink.innerHTML=playerdata.linkback_action=="buy"?playerdata.is_preorder==1?"pre-order":"buy":"download";this._elems.buyordownloadlinkalt.innerHTML=playerdata.linkback_action=="buy"?playerdata.is_preorder==1?"pre-order":"buy":"download"}else{if(playerdata.is_preorder)$(this._root_elem).addClass("preorder");this._elems.buyordownloadlink.innerHTML=playerdata.linkback_action=="buy"?playerdata.is_preorder==1?"pre-order":"buy":"download";this._elems.buyordownloadlinkalt.innerHTML=
playerdata.linkback_action=="buy"?playerdata.is_preorder==1?"pre-order":"buy":"download"}}else{this._elems.buyordownload.style.display="none";this._elems.buyordownloadalt.style.display="none"}var track_index=null;if(params.album&&params.track){var target_id=Number(params.track);for(var i=0;i<playlist.length();i++){var info=playlist.get_track_info(i);if(info.id==target_id){params.t=i+1;break}}}if(params.t){var t=Number(params.t)-1;if(t>=0&&t<playlist.length()){track_index=t;playlist.set_initial_track(track_index)}}if(track_index!=
null&&params.size=="small"&&params.album){info=playlist.get_track_info(track_index);this._elems.tracknamelink.href=info.title_link;playlist.load([info])}else for(i=0;i<playlist.length();i++){info=playlist.get_track_info(i);var item=this._create_playlist_item(info);var that=this;if(info.file)$(item).click(function(n){return function(){that._playlist.play_track(n)}}(i));else $(item).addClass("nostream");$(this._elems.tracklist_ul).append(item);this._tracklistelems[info.tracknum+1]=item}var wparam=params["width"];
if(wparam&&wparam.match(/^[0-9]+$/))$(this._root_elem).css("width",wparam+"px");var size=params["size"];var artparam=params["artwork"];var hastracklist=size=="large"&&(params["notracklist"]!="true"&&params["tracklist"]!="false");var noartwork=(size=="large"||size=="medium")&&(artparam=="none"||artparam=="false");var smallartwork=size=="medium"&&artparam!="none"&&artparam!="false";if(hastracklist)$(this._root_elem).addClass("hastracklist");if(noartwork)$(this._root_elem).addClass("noartwork");if(smallartwork)$(this._root_elem).addClass("smallartwork");
if(params["package"]&&playerdata.packages){addClass(this._root_elem,"hasmerch");var pkgid=Number(params["package"]);for(i=0;i<playerdata.packages.length;i++){var pkg=playerdata.packages[i];if(pkg.id!=pkgid)continue;this._package=pkg;if(pkg.arts)for(var artidx=0;artidx<pkg.arts.length;artidx++){var art=pkg.arts[artidx];if(!art)continue;var thumb=document.createElement("div");var thumburl=ImageUtils.imageURL(art.image_id,"art_thumbthumb");addClass(thumb,"merchthumb");thumb.style.backgroundImage="url("+
thumburl+")";var handler=function(ui,artidx,thumb){var th=thumb;return function(e){$(".merchthumb").removeClass("selected");if(ui._showing_package_image!=artidx)$(th).addClass("selected");U.stopEvent(e);ui.toggle_package_image(artidx)}}(this,artidx,thumb);$(thumb).click(handler);this._elems.merch.appendChild(thumb)}break}}if(this.isAlbum())if(!this.effectively_single_track)addClass(this._root_elem,"albumplayer");else addClass(this._root_elem,"standalonetrackplayer");else if($(this._root_elem).is(".classic"))addClass(this._root_elem,
"trackplayer");else if(this._albumtitle&&this._albumtitle!="")addClass(this._root_elem,"albumtrackplayer");else addClass(this._root_elem,"standalonetrackplayer");if(this._is_exclusive)addClass(this._root_elem,"exclusive");this._choose_size_classes();this._root_elem.style.display="block";this._switch_track_artwork(track_index);this._setup_infolayer();this._adjust_tracklist();$(window).resize(function(){self._choose_size_classes();self._setup_infolayer();self._adjust_tracklist()});try{window.parent.postMessage("playerinited",
"*")}catch(e){Log.warn("failed to postMessage: "+e)}}function find_art_format(width,anim){var squarethumbs=[];for(var i=0;i<TemplGlobals.image_formats.length;i++){var fmt=TemplGlobals.image_formats[i];if(fmt.resize_algo=="thumb"&&fmt.height==fmt.width&&(anim&&fmt.anim_ok||!anim&&!fmt.anim_ok))squarethumbs.push(fmt)}squarethumbs.sort(function(a,b){return a.width-b.width});if(anim)width=width*2;for(i=0;i<squarethumbs.length;i++)if(squarethumbs[i].width>=width)return squarethumbs[i].name;return squarethumbs[squarethumbs.length-
1].name}HEP.prototype={_switch_track_artwork:function(track_index){var self=this;$(this._root_elem).find(".art, #art").each(function(index,elem){elem=$(elem);if(!elem.is(":visible"))return;var artWidth=elem.width();var elemId=elem.attr("id");var arturl=self._track_art_url(track_index,artWidth);if(elemId=="art"){artWidth=$(self._elems.art).width();arturl=self._track_art_url(track_index,artWidth);self._original_art=arturl;if(self._showing_package_image)return}elem.css("backgroundImage","url("+arturl+
")")})},toggle_package_image:function(i){if(this._showing_package_image==i){this._elems.art.style.backgroundImage="url("+this._original_art+")";this._showing_package_image=null}else{var pkg=this._package;this._elems.art.style.backgroundImage="url("+ImageUtils.imageURL(pkg.arts[i].image_id,"screen")+")";this._showing_package_image=i}},_hookup_ui:function(){$(this._elems.play).click(this._makehandler("_handle_play_click"));$(this._elems.tinyplayer).click(this._makehandler("_handle_tiny_click"));$(this._elems.next).click(this._makehandler("_handle_next_click"));
$(this._elems.prev).click(this._makehandler("_handle_prev_click"));$("#artlink").click(this._makehandler("_handle_art_click"));$(".artlink").click(this._makehandler("_handle_art_click"));$("#artarea").click(this._makehandler("_handle_art_click"));$(".art").click(this._makehandler("_handle_art_click"));this._playlist.onstatechanged(this._handle_playlist_statechanged,this);this._playlist.ontime(this._handle_playlist_time,this);this._playlist.onloaded(this._handle_playlist_loaded,this);this._playlist.ontrackchanged(this._handle_playlist_trackchanged,
this);this._playlist.onplaylistchanged(this._handle_playlist_playlistchanged,this);var track=this._playlist.get_track();this._handle_playlist_trackchanged(this._playerdata.tracks[track]);this._handle_playlist_time({position:0});$("#shareurl").focus(function(){$(this).select().one("mouseup",function(e){$(this).unbind("keyup");e.preventDefault()}).one("keyup",function(){$(this).select().unbind("mouseup")})});if(this._is_iphone())$(this._elems.timeline).on("touchstart",this._makehandler("_handle_seek_touchstart"));
else $(this._elems.progbar_thumb).draggable({start:this._makehandler("_handle_thumb_startdrag"),drag:this._makehandler("_handle_thumb_drag"),stop:this._makehandler("_handle_thumb_enddrag"),containment:"parent",axis:"x"})},_adjust_tracklist:function(){if($(this._root_elem).hasClass("has_info_slider")){$(this._root_elem).removeClass("hastracklist");return}var viewheight=$(this._root_elem).height();var tl=$(this._elems.tracklist);var il=$(this._elems.infolayer);var ilbottom=il.position().top+il.outerHeight();
var tltop=tl.position().top;var tlbottom=tl.outerHeight()+tltop;var bottom_pad=$("#nonartarea").outerHeight()-$("#nonartarea").height();tl.css("height",viewheight-ilbottom-bottom_pad+"px")},_scroll_tracklist:function(tracknum){var list=$("#tracklist");var li=$("#tracklist li")[tracknum-1];if(!li)return;var li_top=$(li).position().top-$("#tracklist").position().top;var li_bot=li_top+$(li).outerHeight();var listpos=list.scrollTop();var listheight=list.outerHeight();if(li_top<0)list.scrollTop(listpos+
li_top);else if(li_bot>listheight)list.scrollTop(listpos+li_bot-listheight)},_setup_infolayer:function(){removeClass(this._root_elem,"has_info_slider");removeClass(this._elems.infolayer,"fixed");var infolayer=$(this._elems.infolayer);var artwidth=$("#artarea").width();var artheight=$("#artarea").height();var playerwidth=$(this._root_elem).width();var playerheight=$(this._root_elem).height();if(playerheight>artheight||playerwidth>artwidth){addClass(this._elems.infolayer,"fixed");return}var infopos=
infolayer.position();var ix=infopos.left;var iy=infopos.top;var iw=infolayer.outerWidth();var ih=infolayer.outerHeight();this._infolayer_show_x=null;this._infolayer_show_y=null;if(ix<0)this._infolayer_show_x=0;else if(ix>=playerwidth)this._infolayer_show_x=playerwidth-iw;if(iy<0)this._infolayer_show_y=0;else if(iy>=playerheight)this._infolayer_show_y=playerheight-ih;if(this._infolayer_show_x!=null||this._infolayer_show_y!=null){addClass(this._root_elem,"has_info_slider");this._infolayer_hide_x=ix;
this._infolayer_hide_y=iy;if(this._infolayer_show_x===null)this._infolayer_show_x=ix;if(this._infolayer_show_y===null)this._infolayer_show_y=iy;infolayer.css({left:ix+"px",top:iy+"px",bottom:"auto"});$(this._root_elem).hover(this._makehandler("_handle_hover"),this._makehandler("_handle_unhover"));$(window).resize(this._makehandler("_handle_doc_resize"))}},_choose_size_classes:function(){removeClass(this._elems.play,"big");if($(this._elems.play).width()>35)addClass(this._elems.play,"big")},_handle_doc_resize:function(){if(this._infolayer_hide_x>
0){var xoff=$(this._root_elem).width()-this._infolayer_hide_x;this._infolayer_hide_x+=xoff;this._infolayer_show_x+=xoff}if(this._infolayer_hide_y>0){var yoff=$(this._root_elem).height()-this._infolayer_hide_y;this._infolayer_hide_y+=yoff;this._infolayer_show_y+=yoff}if(this._infolayer_hide_x>0||this._infolayer_hide_y>0)this._handle_unhover()},_makehandler:function(name){var that=this;return function(event){that[name].apply(that,[event])}},_handle_hover:function(){if($(this._root_elem).hasClass("has_info_slider")){var infolayer=
$(this._elems.infolayer);infolayer.stop(true,false).delay(400).animate({left:this._infolayer_show_x+"px",top:this._infolayer_show_y+"px",opacity:"1"},"fast","linear")}},_handle_unhover:function(){if($(this._root_elem).hasClass("has_info_slider")){var infolayer=$(this._elems.infolayer);infolayer.stop(true,false).delay(1E3).animate({left:this._infolayer_hide_x,top:this._infolayer_hide_y,opacity:"0"})}},_handle_play_click:function(event){U.stopEvent(event);this._playlist.playpause();this._hasplayed()},
_handle_tiny_click:function(event){if(event.target.id=="tinyplayer")this._handle_play_click(event)},_handle_next_click:function(event){U.stopEvent(event);this._playlist.next_track();this._playlist.play();this._hasplayed()},_handle_prev_click:function(event){U.stopEvent(event);this._playlist.prev_track();this._playlist.play();this._hasplayed()},_handle_art_click:function(event){U.stopEvent(event);if(!this._classic){event.preventDefault();this._playlist.playpause();this._hasplayed()}},_handle_share_click:function(event$$0){var vw=
$(this._root_elem).width();var vh=$(this._root_elem).height();if(!$(playerui._root_elem).is(".classic")&&vw>=300&&vh>=300){U.stopEvent(event$$0);$("#sharedialog").dialog({width:"280px",height:210,modal:true,position:{at:"center",of:"#artarea"},open:function(event,ui){$(".ui-widget-overlay").bind("click",function(){$("#sharedialog").dialog("close")});if(!this._social_controls_inited){SocialControls.initFromDOM($("#sharedialog"));$(".share-embed-container").show();this._social_controls_inited=true}}})}},
_handle_playlist_statechanged:function(arg){switch(arg.newstate){case "PLAYING":addClass(this._root_elem,"playing");removeClass(this._elems.play,"busy");addClass(this._elems.play,"playing");addClass(this._elems.tinyplayer,"playing");break;case "BUFFERING":case "BUSY":addClass(this._root_elem,"playing");removeClass(this._elems.play,"playing");addClass(this._elems.play,"busy");addClass(this._elems.tinyplayer,"playing");break;default:removeClass(this._root_elem,"playing");removeClass(this._elems.tinyplayer,
"playing");removeClass(this._elems.play,"busy");removeClass(this._elems.play,"playing");break}},_handle_playlist_time:function(arg){if(!this._dragging)this._trackpos=arg.position;if(arg.duration)this._tracklength=arg.duration;this._updateprog()},_handle_playlist_loaded:function(arg){this._loadpercent=arg;this._updateprog()},_handle_playlist_trackchanged:function(trackinfo){this._trackinfo=trackinfo;this._tracklength=trackinfo.duration;this._songtitle=trackinfo.title||"";var listelem=this._tracklistelems[this._currentTrack];
if(listelem)removeClass(listelem,"currenttrack");this._currentTrack=trackinfo.tracknum+1;this._scroll_tracklist(this._currentTrack);listelem=this._tracklistelems[this._currentTrack];if(listelem)addClass(listelem,"currenttrack");$("#tracklist .currenttrack .currenttime").html(Time.timeStr(0));this._numTracks=this._playlist.length;this._update_text();this._showhide_nextprev();this._switch_track_artwork(this._currentTrack-1)},_handle_playlist_playlistchanged:function(arg){var ti=this._playlist.get_track_info();
if(ti)this._handle_playlist_trackchanged(ti)},_handle_thumb_startdrag:function(event){this._dragging=true;this._playlist.seeking=true;this._dragoffset=event.pageX-$(event.target).offset().left},_handle_thumb_drag:function(event){var progLeft=$(this._elems.timeline).offset().left;var progRange=$(this._elems.timeline).width()-$(this._elems.progbar_thumb).width();var pos=event.pageX-progLeft-this._dragoffset;if(pos<0)pos=0;else if(pos>progRange)pos=progRange;pos*=this._tracklength/progRange;this._trackpos=
pos;this._updateprog()},_handle_thumb_enddrag:function(event){this._playlist.seek(this._trackpos);this._dragging=false;this._playlist.seeking=false;this._hasplayed()},_create_playlist_item:function(trackinfo){var item=$("\x3cli\x3e");var title=Text.escapeHtml(trackinfo.title);if(trackinfo.artist&&trackinfo.artist!=""&&trackinfo.artist!=this._artist)title=Text.escapeHtml(trackinfo.artist)+" \x26mdash; "+title;item.append($("\x3cspan\x3e",{"class":"tracknum",text:trackinfo.tracknum+1+"."}));item.append($("\x3ca\x3e",
{"href":"#"}).append($("\x3cspan\x3e",{"class":"tracktitle",html:title})).append($("\x3cspan\x3e",{"class":"currenttime"})).append($("\x3cspan\x3e",{"class":"tracktime",text:Time.timeStr(trackinfo.duration)})));return item},_handle_seek_touchstart:function(event){event.preventDefault();var timeline=$(this._elems.timeline);this._seek_move_handler=this._makehandler("_handle_seek_touchmove");this._seek_end_handler=this._makehandler("_handle_seek_touchend");this._seek_cancel_handler=this._makehandler("_handle_seek_touchcancel");
timeline.on("touchmove",this._seek_move_handler);timeline.on("touchend",this._seek_end_handler);timeline.on("touchcancel",this._seek_cancel_handler);this._playlist.seeking=true;this._dragging=true;this._dragtimerhandler=this._makehandler("_handle_drag_timeout");this._dragtimer=setTimeout(this._dragtimerhandler,1E3)},_handle_seek_touchmove:function(e){var event=e.originalEvent;var thisX=event.changedTouches[0].pageX;var obj=this._elems.timeline;var thumbWidth=this._elems.progbar_thumb.clientWidth;
var scrollMin=thumbWidth/2;do scrollMin+=obj.offsetLeft;while(obj=obj.offsetParent);var scrollMax=scrollMin+this._elems.timeline.clientWidth-thumbWidth;var frac=(thisX-scrollMin)/(scrollMax-scrollMin);if(frac>1)frac=1;else if(frac<0)frac=0;this._trackpos=this._tracklength*frac;this._updateprog();clearTimeout(this._dragtimer);this._dragtimer=setTimeout(this._dragtimerhandler,1E3)},_handle_seek_touchend:function(event){clearTimeout(this._dragtimer);this._finishdrag(true)},_handle_seek_touchcancel:function(event){this._finishdrag(false)},
_handle_drag_timeout:function(event){this._finishdrag(true)},_finishdrag:function(doseek){var timeline=$(this._elems.timeline);timeline.off("touchmove",this._seek_move_handler);timeline.off("touchend",this._seek_end_handler);timeline.off("touchcancel",this._seek_cancel_handler);this._playlist.seeking=false;this._dragging=false;if(doseek){if(this._trackpos==this._tracklength)this._playlist.next_track();else if(this._trackpos==0&&this._seekorigpos<3)this._playlist.prev_track();else this._playlist.seek(this._trackpos);
this._hasplayed()}},isAlbum:function(){return!!this._params.album},_update_text:function(){var title=Text.escapeHtml(this._songtitle||"");if(this._trackinfo.artist&&this._trackinfo.artist!=""&&this._trackinfo.artist!=this._artist)title=Text.escapeHtml(this._trackinfo.artist)+" \x26mdash; "+title;if(this.isAlbum()){this._elems.maintextlink.innerHTML=Text.escapeHtml(this._albumtitle||"");this._elems.tracknamelink.innerHTML=Text.escapeHtml(this._songtitle||"");this._elems.currenttitle_title.innerHTML=
title;this._elems.currenttitle_tracknum.innerHTML=Text.escapeHtml(this._currentTrack.toString()||"")+"."}else{this._elems.maintextlink.innerHTML=Text.escapeHtml(this._songtitle||"");this._elems.currenttitle_title.innerHTML=title;this._elems.currenttitle_tracknum.innerHTML=Text.escapeHtml(this._currentTrack.toString()||"")+"."}this._elems.subtextlink.innerHTML=Text.escapeHtml(this._trackinfo.artist||"");this._elems.artist.innerHTML=Text.escapeHtml(this._artist||"");this._elems.album.innerHTML=Text.escapeHtml(this._albumtitle||
"")},_updateprog:function(){var fillwidth=$("#timeline .progbar_empty").width();var thumbrange=fillwidth-this._elems.progbar_thumb.offsetWidth;var thumbpos=this._tracklength?this._trackpos/this._tracklength*thumbrange:0;this._elems.progbar_thumb.style.left=Math.round(thumbpos)+"px";this._elems.progbar_fill.style.width=(this._loadpercent||0)+"%";this._elems.currenttime.innerHTML=Time.timeStr(this._trackpos);this._elems.totaltime.innerHTML=Time.timeStr(this._tracklength);if(!this._playlist.seeking){var loadedlength=
this._loadpercent/100*this._tracklength;var playedpct=loadedlength>0?100*(this._trackpos/loadedlength):0;this._elems.progbar_fill_played.style.width=playedpct+"%"}$("#tracklist .currenttrack .currenttime").html(Time.timeStr(this._trackpos))},_showhide_nextprev:function(){var cur=this._playlist.get_track();var first=this._playlist.first_playable_track;var last=this._playlist.last_playable_track;if(this._elems.prev)this.showhide_elem(this._elems.prev,first>=0&&cur>first);if(this._elems.next)this.showhide_elem(this._elems.next,
last>=0&&cur<last)},showhide_elem:function(elem,bShow){if(bShow)removeClass(elem,"hiddenelem");else addClass(elem,"hiddenelem")},_is_iphone:function(){return Browser.platform=="iphone"},_hasplayed:function(){removeClass(this._root_elem,"initialstate")},_track_art_url:function(track_index,width){var artid=null;if(track_index!=null){var track=this._playerdata.tracks[track_index];artid=track&&track.art_id}if(!artid){track=this._playlist.get_track();artid=this._playerdata.album_art_id||this._playerdata.tracks[track].art_id}var artformat=
find_art_format(width,this._params.anim_ok);return ImageUtils.artURL(artid,artformat)}};var addClass=function(elem,toadd){$(elem).addClass(toadd)};var removeClass=function(elem,toremove){$(elem).removeClass(toremove)};var ALL_ELEMS=["prev","next","play","art","artarea","artlink","artist","trackname","tracknamelink","album","maintext","maintextlink","subtext","subtextlink","logoalt","logoalt2","currenttitle","currenttime","totaltime","timeline","linkarea","linkareaalt","tracklist","tinyplayer","progbar_thumb",
"progbar_fill","progbar_fill_played","currenttitle_tracknum","currenttitle_title","buyordownload","buyordownloadalt","buyordownloadlink","buyordownloadlinkalt","share","sharealt","sharelink","sharelinkalt","infolink","player","tracklist_ul","merch","infolayer"];HEP.init=function(playerdata,parentpage,params){Sound.whenloaded(function(status){if(playerdata&&status.success){var soundplayer=new Sound.SoundPlayer;var isalbum=!!params.album;var statsource=isalbum?"embedded album player":"embedded track player";
var exclusiveParams=null;if(params.esig)exclusiveParams={esig:params.esig,tracks:params.tracks,album:params.album,track:params.track,url_referrer:params.url_referrer};var playlist=new Player.Playlist(soundplayer,statsource,parentpage,{url_params:exclusiveParams});playlist._trackstate=false;for(var i=0;i<playerdata.tracks.length;i++){var index=playlist.add_track(playerdata.tracks[i]);if(!params.t&&playerdata.tracks[i].id===playerdata.featured_track_id)playlist.set_initial_track(index)}if(params["extratracks"])for(i=
playerdata.tracks.length;i<20;i++)playlist.add_track(playerdata.tracks[i%playerdata.tracks.length]);var playerui=new HTMLEmbeddedPlayer3(playlist,params,playerdata);playlist.init_complete(params.t);if(params.twittercard){var h=$("#player").width()*470/350;var meta="width\x3ddevice-width,height\x3d"+h;$("#viewportmeta").attr("content",meta)}else if(params["facebook.com"])playlist.play()}else if(!playerdata)document.getElementById("badtralbumerror").style.visibility="visible";else document.getElementById("badbrowsererror").style.visibility=
"visible"})};return HEP}();
var FacebookUtils={_sdkLoadPromise:null,resizeTimer:null,initSDK:function(){if(FacebookUtils._sdkLoadPromise)return FacebookUtils._sdkLoadPromise;var dfd=new $.Deferred;window.fbAsyncInit=function(){Log.debug("Facebook SDK loaded");FB.init({appId:"165661066782720",status:true,cookie:true,xfbml:false});dfd.resolve()};$(document.body).prepend('\x3cdiv id\x3d"fb-root"\x3e\x3c/div\x3e');fbLocales={"en":"en_US","fr":"fr_FR","ja":"ja_JP","qq":"ja_JP"};var fbLocale;if("Translate"in window&&"locale"in Translate)fbLocale=
fbLocales[Translate.locale];if(!fbLocale){fbLocale="en_US";Log.server("Facebook SDK couldn't determine FB locale","error")}$.cachedScript("//connect.facebook.net/"+fbLocale+"/all.js");return FacebookUtils._sdkLoadPromise=dfd.promise()},initFbApp:function(){FacebookUtils.initSDK().done(function(){FacebookUtils.reportResize()})},onGeneric:function(response){Log.note("some sort of event")},reportResize:function(){if(FacebookUtils.resizeTimer)clearTimeout(FacebookUtils.resizeTimer);FacebookUtils.resizeTimer=
setTimeout(function(){if($("body.fb").height()){var dims={height:$("body.fb").height()+40,width:$("body.fb").width()};Log.note("reportResize cb: resize timer: "+FacebookUtils.resizeTimer+" setting height FB canvas tab to: "+dims.height+","+dims.width);FB.Canvas.setSize(dims)}clearTimeout(FacebookUtils.resizeTimer);FacebookUtils.resizeTimer=null},50)},inAppNav:function(pageType,paths,params){var path=pageType;if(paths&&paths.length>0)path+="/"+paths.join("/");if(FacebookData&&FacebookData.referer)params["ref"]=
FacebookData.referer;SimpleForm.submit("/fb_tab/"+path,params,"GET");if(FacebookData){$("body").hide();FB.Canvas.scrollTo(0,0)}},correctSrollThen:function(patchYui,_this,interceptedFn){var args=Array.prototype.slice.call(arguments);args.shift(),args.shift(),args.shift();FacebookData.positionInfo=null;FB.Canvas.getPageInfo(function(info){FacebookData.positionInfo=info;if(patchYui){_getDocumentScrollTop=Y.util.Dom.getDocumentScrollTop;_getViewportHeight=Y.util.Dom.getViewportHeight;_getDocumentHeight=
Y.util.Dom.getDocumentHeight;var iScrollTop=parseInt(info.scrollTop);Y.util.Dom.getDocumentScrollTop=function(){return iScrollTop};var iClientHeight=parseInt(info.clientHeight);Y.util.Dom.getViewportHeight=function(){return iClientHeight};Y.util.Dom.getDocumentHeight=function(){return iClientHeight*3}}if(interceptedFn){el=interceptedFn.apply(_this,args);if(el)FacebookUtils.fixCentering(el);if(patchYui){Y.util.Dom.getDocumentScrollTop=_getDocumentScrollTop;Y.util.Dom.getViewportHeight=_getViewportHeight;
Y.util.Dom.getDocumentHeight=_getDocumentHeight}return el}})},fixCentering:function(el){if(el.element)el=el.element;if(window.FacebookData.positionInfo){var scrollTop=parseInt(FacebookData.positionInfo.scrollTop);$("#"+el.id).css({top:scrollTop});FB.Canvas.scrollTo(0,scrollTop)}},xxx:null};var EmailIMUtils={alreadyStattedFromFocus:false,onFocus:function(){if(!self.alreadyStattedFromFocus){Stats.record({kind:"click",click:"email_tralbum"});self.alreadyStattedFromFocus=true}return false},xxx:null};
var SocialControls={initFromDOM:function(root){var self=this;var $root=$(root);var $containers=$root.add(".social-controls",$root).filter(".social-controls");$containers.each(function(){var $cont=$(this);self._initControlsOfType($cont.find(".facebook-like-ctrl"),"renderFacebookLike");self._initControlsOfType($cont.find(".facebook-share-ctrl"),"renderFacebookShare");self._initControlsOfType($cont.find(".facebook-share-dlg-ctrl"),"renderFacebookDialogShare");self._initControlsOfType($cont.find(".twitter-ctrl"),
"renderTwitterShare");self._initControlsOfType($cont.find(".reddit-ctrl"),"renderRedditShare");self._initControlsOfType($cont.find(".tumblr-ctrl"),"renderTumblrShare");self._initControlsOfType($cont.find(".email-ctrl"),"renderEmailShare")})},renderFacebookLike:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href,send:"false",layout:"button_count",width:"90","show-faces":"false"};data=$.extend(dataDefaults,data);var $like=$('\x3cdiv class\x3d"fb-like"\x3e\x3c/div\x3e').appendTo($elem);
$.each(data,function(key,val){if(key=="url")key="href";$like.attr("data-"+key,val)});FacebookUtils.initSDK().done(function(){FB.XFBML.parse($elem[0]);self._registerFBEventHandlers(elem,data);$elem.data("scResolvedData",data);Log.debug("SocialControls: rendered Facebook Like button")})},renderFacebookDialogShare:function(elem,data){(function(document,script,facebookJsSdkId){var firstJsTag=document.getElementsByTagName(script)[0];var scriptTag=document.createElement(script);scriptTag.id=facebookJsSdkId;
scriptTag.src="https://connect.facebook.net/en_US/sdk.js";firstJsTag.parentNode.insertBefore(scriptTag,firstJsTag)})(document,"script","facebook-jssdk");window.fbAsyncInit=function(){FB.init({appId:data.appId,autoLogAppEvents:true,xfbml:true,version:"v3.2"})};var $fbLink=$(elem).find(".facebook-link").first();$fbLink.click(function(ev){FB.ui({method:"share_open_graph",action_type:"og.shares",action_properties:JSON.stringify({object:{"og:url":data.url,"og:title":data.title,"og:description":data.text,
"og:image":data.image,"og:image:width":100,"og:image:height":100}})},function(response){})});Log.debug("SocialControls: rendered Facebook dialog share button")},renderFacebookShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,data);var params={u:data.url};var isDesktop=!window.MediaView||MediaView.mode=="desktop";var fbUrl=Url.addQueryParams(isDesktop?"http://www.facebook.com/sharer.php":"http://m.facebook.com/sharer.php",params);
var $fbLink=$elem.find(".facebook-link").first();if(!$fbLink.length)$fbLink=$('\x3ca class\x3d"facebook-link" title\x3d"Share on Facebook"\x3eShare\x3c/a\x3e').appendTo($elem);$fbLink.attr({"href":fbUrl,"target":"_blank"}).click(function(ev){self._statClick(data,"on");if(isDesktop){window.open(fbUrl,"share_fb","toolbar\x3d0,status\x3d0,width\x3d626,height\x3d436");ev.preventDefault()}});Log.debug("SocialControls: rendered Facebook share button")},renderTwitterShare:function(elem,data){var self=this;
var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,data);var params={url:data.url};var isDesktop=!window.MediaView||MediaView.mode!="phone";if(data.text)params.text=data.text;var twUrl=Url.addQueryParams("https://twitter.com/intent/tweet",params);var $twLink=$elem.find(".twitter-link").first();if(!$twLink.length){var tweet;var shareOnTwitter;if("undefined"===typeof TM){tweet="Tweet";shareOnTwitter="Share on Twitter"}else{tweet=TM("Tweet");shareOnTwitter=TM("Share on Twitter")}$twLink=
$('\x3ca class\x3d"twitter-link" title\x3d"'+shareOnTwitter+'"\x3e'+tweet+"\x3c/a\x3e").appendTo($elem)}$twLink.attr({"href":twUrl,"target":"_blank"}).click(function(ev){self._statClick(data,"on");if(isDesktop){window.open(twUrl,"share_tw","toolbar\x3d0,status\x3d0,width\x3d550,height\x3d450");ev.preventDefault()}});Log.debug("SocialControls: rendered Twitter share button")},renderRedditShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,
data);var params={url:data.url,title:data.title,kind:"self"};var isDesktop=!window.MediaView||MediaView.mode!="phone";var rdUrl=Url.addQueryParams("https://www.reddit.com/submit",params);var $rdLink=$elem.find(".reddit-link").first();if(!$rdLink.length){var reddit=TM("Reddit");var shareOnReddit=TM("Share on Reddit");$rdLink=$('\x3ca class\x3d"reddit-link" title\x3d"'+shareOnReddit+'"\x3e'+reddit+"\x3c/a\x3e").appendTo($elem)}$rdLink.attr({"href":rdUrl,"target":"_blank"}).click(function(ev){self._statClick(data,
"on");if(isDesktop){window.open(rdUrl,"share_rd","toolbar\x3d0,status\x3d0,width\x3d550,height\x3d450");ev.preventDefault()}});Log.debug("SocialControls: rendered Reddit share button")},renderTumblrShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href,type:"link"};data=$.extend(dataDefaults,data);var params={};if(data.type=="audio"){params.external_url=data.url;if(data.text)params.caption=data.text}else{params.url=data.url;if(data.title)params.name=data.title;
if(data.text)params.description=data.text}var tmUrl=Url.addQueryParams("http://www.tumblr.com/share/"+data.type,params);var $tmLink=$elem.find(".tumblr-link").first();if(!$tmLink.length)$tmLink=$('\x3ca class\x3d"tumblr-link" title\x3d"Share on Tumblr"\x3eShare on Tumblr\x3c/a\x3e').appendTo($elem);$tmLink.attr({"href":tmUrl,"target":"_blank"}).click(function(ev){self._statClick(data,"on")});Log.debug("SocialControls: rendered Tumblr share button")},renderEmailShare:function(elem,data){var self=this;
var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,data);var params={"body":data.url};if(data.text)params.body=data.text+"\r\n\r\n"+params.body;if(data.subject)params.subject=data.subject;var emailUrl="mailto:?"+Url.joinQuery(params);var $emailLink=$elem.find(".email-link").first();if(!$emailLink.length)$emailLink=$('\x3ca class\x3d"email-link" title\x3d"Share via email"\x3eEmail\x3c/a\x3e').appendTo($elem);$emailLink.attr({"href":emailUrl}).click(function(ev){self._statClick(data,
"on");setTimeout(function(){location.href=emailUrl},100);return false});Log.debug("SocialControls: rendered Email share button")},_initControlsOfType:function(elems,renderMethodName){var self=this;$(elems).each(function(){self[renderMethodName](this,self._getData(this))})},_getData:function(elem,defaults){var $elem=$(elem);var elemData=$elem.data();var shareData=$elem.closest(".social-controls").data();return $.extend(defaults||{},shareData,elemData)},_statClick:function(data,eventType){var clickName=
null;if(eventType=="on")clickName=data.stat||data.statOn;else if(eventType=="off")clickName=data.statOff;if(clickName)Stats.record({kind:"click",click:clickName})},_initedFBEvents:false,_registerFBEventHandlers:function(){var self=this;if(!this._initedFBEvents){FacebookUtils.initSDK().done(function(){FB.Event.subscribe("edge.create",$.proxy(self,"_handleFBEvent","on"));FB.Event.subscribe("edge.remove",$.proxy(self,"_handleFBEvent","off"))});this._initedFBEvents=true}},_handleFBEvent:function(eventType,
href,widget){var self=this;Log.debug("SocialControls: got Facebook event; eventType: "+eventType+"; href: "+href+"; widget: ",widget);if(!widget||!widget.dom||!widget.dom.tagName){Log.error("SocialControls: can't stat FB Like/Unlike because event parameter 'widget' is missing or has changed");return}var data=$(widget.dom).closest(".facebook-like-ctrl").data("scResolvedData");if(!data||href!=data.url)return;self._statClick(data,eventType)},xxx:null};
(function(e$$0,t$$1){e$$0.widget("ui.draggable",e$$0.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&
(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e$$0(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e$$0(n.iframeFix===
!0?"iframe":n.iframeFix).each(function(){e$$0('\x3cdiv class\x3d"ui-draggable-iframeFix" style\x3d"background: #fff;"\x3e\x3c/div\x3e').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(e$$0(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e$$0.ui.ddmanager&&(e$$0.ui.ddmanager.current=
this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e$$0.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,
this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e$$0.ui.ddmanager&&!n.dropBehaviour&&e$$0.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e$$0.ui.ddmanager&&e$$0.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();
if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return e$$0.ui.ddmanager&&e$$0.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=!1;e$$0.ui.ddmanager&&!this.options.dropBehaviour&&(n=e$$0.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1);var r=
this.element[0];for(var i=!1;r&&(r=r.parentNode);)r==document&&(i=!0);if(!i&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===!0||e$$0.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var s=this;e$$0(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){s._trigger("stop",t)!==!1&&s._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},
_mouseUp:function(t){return e$$0("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e$$0.ui.ddmanager&&e$$0.ui.ddmanager.dragStop(this,t),e$$0.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=!this.options.handle||!e$$0(this.options.handle,this.element).length?!0:!1;return e$$0(this.options.handle,this.element).find("*").andSelf().each(function(){this==
t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options;var r=e$$0.isFunction(n.helper)?e$$0(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo),r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e$$0.isArray(t)&&
(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&
e$$0.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e$$0.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=
this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions=
{width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[t.containment=="document"?0:e$$0(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e$$0(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e$$0(window).scrollLeft())+
e$$0(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e$$0(window).scrollTop())+(e$$0(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e$$0(t.containment);var r=n[0];if(!r)return;var i=n.offset();var s=e$$0(r).css("overflow")!="hidden";this.containment=
[(parseInt(e$$0(r).css("borderLeftWidth"),10)||0)+(parseInt(e$$0(r).css("paddingLeft"),10)||0),(parseInt(e$$0(r).css("borderTopWidth"),10)||0)+(parseInt(e$$0(r).css("paddingTop"),10)||0),(s?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e$$0(r).css("borderLeftWidth"),10)||0)-(parseInt(e$$0(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e$$0(r).css("borderTopWidth"),
10)||0)-(parseInt(e$$0(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}else t.containment.constructor==Array&&(this.containment=t.containment)},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1;var i=this.options;var s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e$$0.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;var o=/(html|body)/i.test(s[0].tagName);
return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options;var r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e$$0.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;
var i=/(html|body)/i.test(r[0].tagName);var s=t.pageX;var o=t.pageY;if(this.originalPosition){var u;if(this.containment){if(this.relative_container){var a=this.relative_container.offset();u=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]}else u=this.containment;t.pageX-this.offset.click.left<u[0]&&(s=u[0]+this.offset.click.left),t.pageY-this.offset.click.top<u[1]&&(o=u[1]+this.offset.click.top),t.pageX-this.offset.click.left>u[2]&&(s=u[2]+
this.offset.click.left),t.pageY-this.offset.click.top>u[3]&&(o=u[3]+this.offset.click.top)}if(n.grid){var f=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;o=u?f-this.offset.click.top<u[1]||f-this.offset.click.top>u[3]?f-this.offset.click.top<u[1]?f+n.grid[1]:f-n.grid[1]:f:f;var l=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;s=u?l-this.offset.click.left<u[0]||l-this.offset.click.left>u[2]?
l-this.offset.click.left<u[0]?l+n.grid[0]:l-n.grid[0]:l:l}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&
this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e$$0.ui.plugin.call(this,t,[n,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e$$0.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(e){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e$$0.ui.plugin.add("draggable","connectToSortable",{start:function(t,n$$0){var r=e$$0(this).data("draggable");
var i=r.options;var s=e$$0.extend({},n$$0,{item:r.element});r.sortables=[],e$$0(i.connectToSortable).each(function(){var n=e$$0.data(this,"sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e$$0(this).data("draggable");var i=e$$0.extend({},n,{item:r.element});e$$0.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=
!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t$$0,n$$0){var r$$0=e$$0(this).data("draggable");var i$$0=this;var s$$0=function(t){var n=this.offset.click.top;var r=this.offset.click.left;var i=this.positionAbs.top;var s=
this.positionAbs.left;var o=t.height;var u=t.width;var a=t.top;var f=t.left;return e$$0.ui.isOver(i+n,s+r,a,f,o,u)};e$$0.each(r$$0.sortables,function(s){var o=!1;var u=this;this.instance.positionAbs=r$$0.positionAbs,this.instance.helperProportions=r$$0.helperProportions,this.instance.offset.click=r$$0.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e$$0.each(r$$0.sortables,function(){return this.instance.positionAbs=r$$0.positionAbs,this.instance.helperProportions=
r$$0.helperProportions,this.instance.offset.click=r$$0.offset.click,this!=u&&this.instance._intersectsWith(this.instance.containerCache)&&e$$0.ui.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e$$0(i$$0).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n$$0.helper[0]},
t$$0.target=this.instance.currentItem[0],this.instance._mouseCapture(t$$0,!0),this.instance._mouseStart(t$$0,!0,!0),this.instance.offset.click.top=r$$0.offset.click.top,this.instance.offset.click.left=r$$0.offset.click.left,this.instance.offset.parent.left-=r$$0.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r$$0.offset.parent.top-this.instance.offset.parent.top,r$$0._trigger("toSortable",t$$0),r$$0.dropped=this.instance.element,r$$0.currentItem=r$$0.element,
this.instance.fromOutside=r$$0),this.instance.currentItem&&this.instance._mouseDrag(t$$0)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t$$0,this.instance._uiHash(this.instance)),this.instance._mouseStop(t$$0,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r$$0._trigger("fromSortable",t$$0),
r$$0.dropped=!1)})}}),e$$0.ui.plugin.add("draggable","cursor",{start:function(t,n){var r=e$$0("body");var i=e$$0(this).data("draggable").options;r.css("cursor")&&(i._cursor=r.css("cursor")),r.css("cursor",i.cursor)},stop:function(t,n){var r=e$$0(this).data("draggable").options;r._cursor&&e$$0("body").css("cursor",r._cursor)}}),e$$0.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e$$0(n.helper);var i=e$$0(this).data("draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),
r.css("opacity",i.opacity)},stop:function(t,n){var r=e$$0(this).data("draggable").options;r._opacity&&e$$0(n.helper).css("opacity",r._opacity)}}),e$$0.ui.plugin.add("draggable","scroll",{start:function(t,n){var r=e$$0(this).data("draggable");r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"&&(r.overflowOffset=r.scrollParent.offset())},drag:function(t,n){var r=e$$0(this).data("draggable");var i=r.options;var s=!1;if(r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"){if(!i.axis||
i.axis!="x")r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed);if(!i.axis||i.axis!="y")r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&
(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed)}else{if(!i.axis||i.axis!="x")t.pageY-e$$0(document).scrollTop()<i.scrollSensitivity?s=e$$0(document).scrollTop(e$$0(document).scrollTop()-i.scrollSpeed):e$$0(window).height()-(t.pageY-e$$0(document).scrollTop())<i.scrollSensitivity&&(s=e$$0(document).scrollTop(e$$0(document).scrollTop()+i.scrollSpeed));if(!i.axis||i.axis!="y")t.pageX-e$$0(document).scrollLeft()<i.scrollSensitivity?s=e$$0(document).scrollLeft(e$$0(document).scrollLeft()-
i.scrollSpeed):e$$0(window).width()-(t.pageX-e$$0(document).scrollLeft())<i.scrollSensitivity&&(s=e$$0(document).scrollLeft(e$$0(document).scrollLeft()+i.scrollSpeed))}s!==!1&&e$$0.ui.ddmanager&&!i.dropBehaviour&&e$$0.ui.ddmanager.prepareOffsets(r,t)}}),e$$0.ui.plugin.add("draggable","snap",{start:function(t$$0,n$$0){var r=e$$0(this).data("draggable");var i=r.options;r.snapElements=[],e$$0(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var t=e$$0(this);var n=t.offset();
this!=r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function(t,n){var r=e$$0(this).data("draggable");var i=r.options;var s=i.snapTolerance;var o=n.offset.left;var u=o+r.helperProportions.width;var a=n.offset.top;var f=a+r.helperProportions.height;for(var l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left;var h=c+r.snapElements[l].width;var p=r.snapElements[l].top;var d=p+r.snapElements[l].height;if(!(c-s<o&&o<
h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s)){r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e$$0.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=!1;continue}if(i.snapMode!="inner"){var v=Math.abs(p-f)<=s;var m=Math.abs(d-a)<=s;var g=Math.abs(c-u)<=s;var y=Math.abs(h-o)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-
r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left)}var b=v||m||g||y;if(i.snapMode!="outer"){v=Math.abs(p-a)<=s;m=Math.abs(d-f)<=s;g=Math.abs(c-o)<=s;y=Math.abs(h-u)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top),
m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left)}!r.snapElements[l].snapping&&(v||m||g||y||b)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e$$0.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=
v||m||g||y||b}}}),e$$0.ui.plugin.add("draggable","stack",{start:function(t$$0,n$$0){var r=e$$0(this).data("draggable").options;var i=e$$0.makeArray(e$$0(r.stack)).sort(function(t,n){return(parseInt(e$$0(t).css("zIndex"),10)||0)-(parseInt(e$$0(n).css("zIndex"),10)||0)});if(!i.length)return;var s=parseInt(i[0].style.zIndex)||0;e$$0(i).each(function(e){this.style.zIndex=s+e}),this[0].style.zIndex=s+i.length}}),e$$0.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e$$0(n.helper);var i=e$$0(this).data("draggable").options;
r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e$$0(this).data("draggable").options;r._zIndex&&e$$0(n.helper).css("zIndex",r._zIndex)}})})(jQuery);
(function(e$$0,t$$1){var n$$1="ui-dialog ui-widget ui-widget-content ui-corner-all ";var r$$1={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0};var i$$1={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e$$0.widget("ui.dialog",{version:"1.9.2",options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,
collision:"fit",using:function(t){var n=e$$0(this).css(t).offset().top;n<0&&e$$0(this).css("top",t.top-n)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1E3},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.oldPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.options.title=this.options.title||this.originalTitle;var t$$0=this;var r=this.options;var i$$0=
r.title||"\x26#160;";var s;var o$$0;var u;var a;var f;s=(this.uiDialog=e$$0("\x3cdiv\x3e")).addClass(n$$1+r.dialogClass).css({display:"none",outline:0,zIndex:r.zIndex}).attr("tabIndex",-1).keydown(function(n){r.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===e$$0.ui.keyCode.ESCAPE&&(t$$0.close(n),n.preventDefault())}).mousedown(function(e){t$$0.moveToTop(!1,e)}).appendTo("body"),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(s),o$$0=
(this.uiDialogTitlebar=e$$0("\x3cdiv\x3e")).addClass("ui-dialog-titlebar  ui-widget-header  ui-corner-all  ui-helper-clearfix").bind("mousedown",function(){s.focus()}).prependTo(s),u=e$$0("\x3ca href\x3d'#'\x3e\x3c/a\x3e").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click(function(e){e.preventDefault(),t$$0.close(e)}).appendTo(o$$0),(this.uiDialogTitlebarCloseText=e$$0("\x3cspan\x3e")).addClass("ui-icon ui-icon-closethick").text(r.closeText).appendTo(u),a=e$$0("\x3cspan\x3e").uniqueId().addClass("ui-dialog-title").html(i$$0).prependTo(o$$0),
f=(this.uiDialogButtonPane=e$$0("\x3cdiv\x3e")).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),(this.uiButtonSet=e$$0("\x3cdiv\x3e")).addClass("ui-dialog-buttonset").appendTo(f),s.attr({role:"dialog","aria-labelledby":a.attr("id")}),o$$0.find("*").add(o$$0).disableSelection(),this._hoverable(u),this._focusable(u),r.draggable&&e$$0.fn.draggable&&this._makeDraggable(),r.resizable&&e$$0.fn.resizable&&this._makeResizable(),this._createButtons(r.buttons),this._isOpen=!1,e$$0.fn.bgiframe&&
s.bgiframe(),this._on(s,{keydown:function(t){if(!r.modal||t.keyCode!==e$$0.ui.keyCode.TAB)return;var n=e$$0(":tabbable",s);var i=n.filter(":first");var o=n.filter(":last");if(t.target===o[0]&&!t.shiftKey)return i.focus(1),!1;if(t.target===i[0]&&t.shiftKey)return o.focus(1),!1}})},_init:function(){this.options.autoOpen&&this.open()},_destroy:function(){var e;var t=this.oldPosition;this.overlay&&this.overlay.destroy(),this.uiDialog.hide(),this.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),
this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},close:function(t){var n=this;var r;var i;if(!this._isOpen)return;if(!1===this._trigger("beforeClose",t))return;return this._isOpen=!1,this.overlay&&this.overlay.destroy(),this.options.hide?this._hide(this.uiDialog,this.options.hide,function(){n._trigger("close",
t)}):(this.uiDialog.hide(),this._trigger("close",t)),e$$0.ui.dialog.overlay.resize(),this.options.modal&&(r=0,e$$0(".ui-dialog").each(function(){this!==n.uiDialog[0]&&(i=e$$0(this).css("z-index"),isNaN(i)||(r=Math.max(r,i)))}),e$$0.ui.dialog.maxZ=r),this},isOpen:function(){return this._isOpen},moveToTop:function(t,n){var r=this.options;var i;return r.modal&&!t||!r.stack&&!r.modal?this._trigger("focus",n):(r.zIndex>e$$0.ui.dialog.maxZ&&(e$$0.ui.dialog.maxZ=r.zIndex),this.overlay&&(e$$0.ui.dialog.maxZ+=
1,e$$0.ui.dialog.overlay.maxZ=e$$0.ui.dialog.maxZ,this.overlay.$el.css("z-index",e$$0.ui.dialog.overlay.maxZ)),i={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()},e$$0.ui.dialog.maxZ+=1,this.uiDialog.css("z-index",e$$0.ui.dialog.maxZ),this.element.attr(i),this._trigger("focus",n),this)},open:function(){if(this._isOpen)return;var t;var n=this.options;var r=this.uiDialog;return this._size(),this._position(n.position),r.show(n.show),this.overlay=n.modal?new e$$0.ui.dialog.overlay(this):
null,this.moveToTop(!0),t=this.element.find(":tabbable"),t.length||(t=this.uiDialogButtonPane.find(":tabbable"),t.length||(t=r)),t.eq(0).focus(),this._isOpen=!0,this._trigger("open"),this},_createButtons:function(t$$0){var n=this;var r$$0=!1;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),typeof t$$0=="object"&&t$$0!==null&&e$$0.each(t$$0,function(){return!(r$$0=!0)}),r$$0?(e$$0.each(t$$0,function(t,r){var i;var s;r=e$$0.isFunction(r)?{click:r,text:t}:r,r=e$$0.extend({type:"button"},r),
s=r.click,r.click=function(){s.apply(n.element[0],arguments)},i=e$$0("\x3cbutton\x3e\x3c/button\x3e",r).appendTo(n.uiButtonSet),e$$0.fn.button&&i.button()}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog)):this.uiDialog.removeClass("ui-dialog-buttons")},_makeDraggable:function(){function r(e){return{position:e.position,offset:e.offset}}var t=this;var n$$0=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",
containment:"document",start:function(n,i){e$$0(this).addClass("ui-dialog-dragging"),t._trigger("dragStart",n,r(i))},drag:function(e,n){t._trigger("drag",e,r(n))},stop:function(i,s){n$$0.position=[s.position.left-t.document.scrollLeft(),s.position.top-t.document.scrollTop()],e$$0(this).removeClass("ui-dialog-dragging"),t._trigger("dragStop",i,r(s)),e$$0.ui.dialog.overlay.resize()}})},_makeResizable:function(n$$0){function u(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,
position:e.position,size:e.size}}n$$0=n$$0===t$$1?this.options.resizable:n$$0;var r=this;var i=this.options;var s=this.uiDialog.css("position");var o=typeof n$$0=="string"?n$$0:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:this._minHeight(),handles:o,start:function(t,n){e$$0(this).addClass("ui-dialog-resizing"),r._trigger("resizeStart",t,u(n))},resize:function(e,
t){r._trigger("resize",e,u(t))},stop:function(t,n){e$$0(this).removeClass("ui-dialog-resizing"),i.height=e$$0(this).height(),i.width=e$$0(this).width(),r._trigger("resizeStop",t,u(n)),e$$0.ui.dialog.overlay.resize()}}).css("position",s).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var e=this.options;return e.height==="auto"?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(t$$0){var n=[];var r=[0,0];var i;if(t$$0){if(typeof t$$0=="string"||
typeof t$$0=="object"&&"0"in t$$0)n=t$$0.split?t$$0.split(" "):[t$$0[0],t$$0[1]],n.length===1&&(n[1]=n[0]),e$$0.each(["left","top"],function(e,t){+n[e]===n[e]&&(r[e]=n[e],n[e]=t)}),t$$0={my:n[0]+(r[0]<0?r[0]:"+"+r[0])+" "+n[1]+(r[1]<0?r[1]:"+"+r[1]),at:n.join(" ")};t$$0=e$$0.extend({},e$$0.ui.dialog.prototype.options.position,t$$0)}else t$$0=e$$0.ui.dialog.prototype.options.position;i=this.uiDialog.is(":visible"),i||this.uiDialog.show(),this.uiDialog.position(t$$0),i||this.uiDialog.hide()},_setOptions:function(t$$0){var n=
this;var s={};var o=!1;e$$0.each(t$$0,function(e,t){n._setOption(e,t),e in r$$1&&(o=!0),e in i$$1&&(s[e]=t)}),o&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",s)},_setOption:function(t,r){var i;var s;var o=this.uiDialog;switch(t){case "buttons":this._createButtons(r);break;case "closeText":this.uiDialogTitlebarCloseText.text(""+r);break;case "dialogClass":o.removeClass(this.options.dialogClass).addClass(n$$1+r);break;case "disabled":r?o.addClass("ui-dialog-disabled"):
o.removeClass("ui-dialog-disabled");break;case "draggable":i=o.is(":data(draggable)"),i&&!r&&o.draggable("destroy"),!i&&r&&this._makeDraggable();break;case "position":this._position(r);break;case "resizable":s=o.is(":data(resizable)"),s&&!r&&o.resizable("destroy"),s&&typeof r=="string"&&o.resizable("option","handles",r),!s&&r!==!1&&this._makeResizable(r);break;case "title":e$$0(".ui-dialog-title",this.uiDialogTitlebar).html(""+(r||"\x26#160;"))}this._super(t,r)},_size:function(){var t;var n;var r;
var i=this.options;var s=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),i.minWidth>i.width&&(i.width=i.minWidth),t=this.uiDialog.css({height:"auto",width:i.width}).outerHeight(),n=Math.max(0,i.minHeight-t),i.height==="auto"?e$$0.support.minHeight?this.element.css({minHeight:n,height:"auto"}):(this.uiDialog.show(),r=this.element.css("height","auto").height(),s||this.uiDialog.hide(),this.element.height(Math.max(r,n))):this.element.height(Math.max(i.height-
t,0)),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),e$$0.extend(e$$0.ui.dialog,{uuid:0,maxZ:0,getTitleId:function(e){var t=e.attr("id");return t||(this.uuid+=1,t=this.uuid),"ui-dialog-title-"+t},overlay:function(t){this.$el=e$$0.ui.dialog.overlay.create(t)}}),e$$0.extend(e$$0.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e$$0.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay"}).join(" "),
create:function(t$$0){this.instances.length===0&&(setTimeout(function(){e$$0.ui.dialog.overlay.instances.length&&e$$0(document).bind(e$$0.ui.dialog.overlay.events,function(t){if(e$$0(t.target).zIndex()<e$$0.ui.dialog.overlay.maxZ)return!1})},1),e$$0(window).bind("resize.dialog-overlay",e$$0.ui.dialog.overlay.resize));var n=this.oldInstances.pop()||e$$0("\x3cdiv\x3e").addClass("ui-widget-overlay");return e$$0(document).bind("keydown.dialog-overlay",function(r){var i=e$$0.ui.dialog.overlay.instances;
i.length!==0&&i[i.length-1]===n&&t$$0.options.closeOnEscape&&!r.isDefaultPrevented()&&r.keyCode&&r.keyCode===e$$0.ui.keyCode.ESCAPE&&(t$$0.close(r),r.preventDefault())}),n.appendTo(document.body).css({width:this.width(),height:this.height()}),e$$0.fn.bgiframe&&n.bgiframe(),this.instances.push(n),n},destroy:function(t){var n=e$$0.inArray(t,this.instances);var r=0;n!==-1&&this.oldInstances.push(this.instances.splice(n,1)[0]),this.instances.length===0&&e$$0([document,window]).unbind(".dialog-overlay"),
t.height(0).width(0).remove(),e$$0.each(this.instances,function(){r=Math.max(r,this.css("z-index"))}),this.maxZ=r},height:function(){var t;var n;return e$$0.ui.ie?(t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),n=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),t<n?e$$0(window).height()+"px":t+"px"):e$$0(document).height()+"px"},width:function(){var t;var n;return e$$0.ui.ie?(t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),
n=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),t<n?e$$0(window).width()+"px":t+"px"):e$$0(document).width()+"px"},resize:function(){var t=e$$0([]);e$$0.each(e$$0.ui.dialog.overlay.instances,function(){t=t.add(this)}),t.css({width:0,height:0}).css({width:e$$0.ui.dialog.overlay.width(),height:e$$0.ui.dialog.overlay.height()})}}),e$$0.extend(e$$0.ui.dialog.overlay.prototype,{destroy:function(){e$$0.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);
(function(){function j(n,l){var o=this;var m;o.element=typeof n=="object"?n:document.getElementById(n);o.wrapper=o.element.parentNode;o.element.style.webkitTransitionProperty="-webkit-transform";o.element.style.webkitTransitionTimingFunction="cubic-bezier(0,0,0.25,1)";o.element.style.webkitTransitionDuration="0";o.element.style.webkitTransform=h+"0,0"+b;o.options={bounce:d,momentum:d,checkDOMChanges:true,topOnDOMChanges:false,hScrollbar:d,vScrollbar:d,fadeScrollbar:g||!a,shrinkScrollbar:g||!a,desktopCompatibility:false,
overflow:"auto",snap:false,bounceLock:false,scrollbarColor:"rgba(0,0,0,0.5)",onScrollEnd:function(){}};if(typeof l=="object")for(m in l)o.options[m]=l[m];if(o.options.desktopCompatibility)o.options.overflow="hidden";o.onScrollEnd=o.options.onScrollEnd;delete o.options.onScrollEnd;o.wrapper.style.overflow=o.options.overflow;o.refresh();window.addEventListener("onorientationchange"in window?"orientationchange":"resize",o,false);if(a||o.options.desktopCompatibility){o.element.addEventListener(f,o,false);
o.element.addEventListener(i,o,false);o.element.addEventListener(e,o,false)}if(o.options.checkDOMChanges)o.element.addEventListener("DOMSubtreeModified",o,false)}function k(m,r,q,n,l){var o=this;var p=document;o.dir=m;o.fade=q;o.shrink=n;o.uid=++c;o.bar=p.createElement("div");o.bar.style.cssText="position:absolute;top:0;left:0;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;-webkit-transition-duration:0;-webkit-transition-delay:0;-webkit-transition-property:-webkit-transform;z-index:10;background:"+
l+";-webkit-transform:"+h+"0,0"+b+";"+(m=="horizontal"?"-webkit-border-radius:3px 2px;min-width:6px;min-height:5px":"-webkit-border-radius:2px 3px;min-width:5px;min-height:6px");o.wrapper=p.createElement("div");o.wrapper.style.cssText="-webkit-mask:-webkit-canvas(scrollbar"+o.uid+o.dir+");position:absolute;z-index:10;pointer-events:none;overflow:hidden;opacity:0;-webkit-transition-duration:"+(q?"300ms":"0")+";-webkit-transition-delay:0;-webkit-transition-property:opacity;"+(o.dir=="horizontal"?"bottom:2px;left:2px;right:7px;height:5px":
"top:2px;right:2px;bottom:7px;width:5px;");o.wrapper.appendChild(o.bar);r.appendChild(o.wrapper)}j.prototype={x:0,y:0,enabled:true,handleEvent:function(m){var l=this;switch(m.type){case f:l.touchStart(m);break;case i:l.touchMove(m);break;case e:l.touchEnd(m);break;case "webkitTransitionEnd":l.transitionEnd();break;case "orientationchange":case "resize":l.refresh();break;case "DOMSubtreeModified":l.onDOMModified(m);break}},onDOMModified:function(m){var l=this;if(m.target.parentNode!=l.element)return;
setTimeout(function(){l.refresh()},0);if(l.options.topOnDOMChanges&&(l.x!=0||l.y!=0))l.scrollTo(0,0,"0")},refresh:function(){var m=this;var o=m.x;var n=m.y;var l;m.scrollWidth=m.wrapper.clientWidth;m.scrollHeight=m.wrapper.clientHeight;m.scrollerWidth=m.element.offsetWidth;m.scrollerHeight=m.element.offsetHeight;m.maxScrollX=m.scrollWidth-m.scrollerWidth;m.maxScrollY=m.scrollHeight-m.scrollerHeight;m.directionX=0;m.directionY=0;if(m.scrollX)if(m.maxScrollX>=0)o=0;else if(m.x<m.maxScrollX)o=m.maxScrollX;
if(m.scrollY)if(m.maxScrollY>=0)n=0;else if(m.y<m.maxScrollY)n=m.maxScrollY;if(m.options.snap){m.maxPageX=-Math.floor(m.maxScrollX/m.scrollWidth);m.maxPageY=-Math.floor(m.maxScrollY/m.scrollHeight);l=m.snap(o,n);o=l.x;n=l.y}if(o!=m.x||n!=m.y){m.setTransitionTime("0");m.setPosition(o,n,true)}m.scrollX=m.scrollerWidth>m.scrollWidth;m.scrollY=!m.options.bounceLock&&!m.scrollX||m.scrollerHeight>m.scrollHeight;if(m.options.hScrollbar&&m.scrollX){m.scrollBarX=m.scrollBarX||new k("horizontal",m.wrapper,
m.options.fadeScrollbar,m.options.shrinkScrollbar,m.options.scrollbarColor);m.scrollBarX.init(m.scrollWidth,m.scrollerWidth)}else if(m.scrollBarX)m.scrollBarX=m.scrollBarX.remove();if(m.options.vScrollbar&&m.scrollY&&m.scrollerHeight>m.scrollHeight){m.scrollBarY=m.scrollBarY||new k("vertical",m.wrapper,m.options.fadeScrollbar,m.options.shrinkScrollbar,m.options.scrollbarColor);m.scrollBarY.init(m.scrollHeight,m.scrollerHeight)}else if(m.scrollBarY)m.scrollBarY=m.scrollBarY.remove()},setPosition:function(l,
o,n){var m=this;m.x=l;m.y=o;m.element.style.webkitTransform=h+m.x+"px,"+m.y+"px"+b;if(!n){if(m.scrollBarX)m.scrollBarX.setPosition(m.x);if(m.scrollBarY)m.scrollBarY.setPosition(m.y)}},setTransitionTime:function(m){var l=this;m=m||"0";l.element.style.webkitTransitionDuration=m;if(l.scrollBarX){l.scrollBarX.bar.style.webkitTransitionDuration=m;l.scrollBarX.wrapper.style.webkitTransitionDuration=d&&l.options.fadeScrollbar?"300ms":"0"}if(l.scrollBarY){l.scrollBarY.bar.style.webkitTransitionDuration=m;
l.scrollBarY.wrapper.style.webkitTransitionDuration=d&&l.options.fadeScrollbar?"300ms":"0"}},touchStart:function(n){var m=this;var l;if(!m.enabled)return;n.preventDefault();n.stopPropagation();m.scrolling=true;m.moved=false;m.distX=0;m.distY=0;m.setTransitionTime("0");if(m.options.momentum||m.options.snap){l=new WebKitCSSMatrix(window.getComputedStyle(m.element).webkitTransform);if(l.e!=m.x||l.f!=m.y){document.removeEventListener("webkitTransitionEnd",m,false);m.setPosition(l.e,l.f);m.moved=true}}m.touchStartX=
a?n.changedTouches[0].pageX:n.pageX;m.scrollStartX=m.x;m.touchStartY=a?n.changedTouches[0].pageY:n.pageY;m.scrollStartY=m.y;m.scrollStartTime=n.timeStamp;m.directionX=0;m.directionY=0},touchMove:function(r){if(!this.scrolling)return;var p=this;var o=a?r.changedTouches[0].pageX:r.pageX;var n=a?r.changedTouches[0].pageY:r.pageY;var m=p.scrollX?o-p.touchStartX:0;var l=p.scrollY?n-p.touchStartY:0;var s=p.x+m;var q=p.y+l;r.stopPropagation();p.touchStartX=o;p.touchStartY=n;if(s>=0||s<p.maxScrollX)s=p.options.bounce?
Math.round(p.x+m/3):s>=0||p.maxScrollX>=0?0:p.maxScrollX;if(q>=0||q<p.maxScrollY)q=p.options.bounce?Math.round(p.y+l/3):q>=0||p.maxScrollY>=0?0:p.maxScrollY;if(p.distX+p.distY>5){if(p.distX-3>p.distY){q=p.y;l=0}else if(p.distY-3>p.distX){s=p.x;m=0}p.setPosition(s,q);p.moved=true;p.directionX=m>0?-1:1;p.directionY=l>0?-1:1}else{p.distX+=Math.abs(m);p.distY+=Math.abs(l)}},touchEnd:function(t){if(!this.scrolling)return;var s=this;var o=t.timeStamp-s.scrollStartTime;var w=a?t.changedTouches[0]:t;var u;
var v;var n;var l;var m=0;var r=s.x;var q=s.y;var p;s.scrolling=false;if(!s.moved){s.resetPosition();if(a){for(u=w.target;u.nodeType!=1;)u=u.parentNode;v=document.createEvent("MouseEvents");v.initMouseEvent("click",true,true,t.view,1,w.screenX,w.screenY,w.clientX,w.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null);v._fake=true;u.dispatchEvent(v)}return}if(!s.options.snap&&o>250){s.resetPosition();return}if(s.options.momentum){n=s.scrollX===true?s.momentum(s.x-s.scrollStartX,o,s.options.bounce?
-s.x+s.scrollWidth/5:-s.x,s.options.bounce?s.x+s.scrollerWidth-s.scrollWidth+s.scrollWidth/5:s.x+s.scrollerWidth-s.scrollWidth):{dist:0,time:0};l=s.scrollY===true?s.momentum(s.y-s.scrollStartY,o,s.options.bounce?-s.y+s.scrollHeight/5:-s.y,s.options.bounce?(s.maxScrollY<0?s.y+s.scrollerHeight-s.scrollHeight:0)+s.scrollHeight/5:s.y+s.scrollerHeight-s.scrollHeight):{dist:0,time:0};m=Math.max(Math.max(n.time,l.time),1);r=s.x+n.dist;q=s.y+l.dist}if(s.options.snap){p=s.snap(r,q);r=p.x;q=p.y;m=Math.max(p.time,
m)}s.scrollTo(r,q,m+"ms")},transitionEnd:function(){var l=this;document.removeEventListener("webkitTransitionEnd",l,false);l.resetPosition()},resetPosition:function(){var l=this;var n=l.x;var m=l.y;if(l.x>=0)n=0;else if(l.x<l.maxScrollX)n=l.maxScrollX;if(l.y>=0||l.maxScrollY>0)m=0;else if(l.y<l.maxScrollY)m=l.maxScrollY;if(n!=l.x||m!=l.y)l.scrollTo(n,m);else{if(l.moved){l.onScrollEnd();l.moved=false}if(l.scrollBarX)l.scrollBarX.hide();if(l.scrollBarY)l.scrollBarY.hide()}},snap:function(l,o){var m=
this;var n;if(m.directionX>0)l=Math.floor(l/m.scrollWidth);else if(m.directionX<0)l=Math.ceil(l/m.scrollWidth);else l=Math.round(l/m.scrollWidth);m.pageX=-l;l=l*m.scrollWidth;if(l>0)l=m.pageX=0;else if(l<m.maxScrollX){m.pageX=m.maxPageX;l=m.maxScrollX}if(m.directionY>0)o=Math.floor(o/m.scrollHeight);else if(m.directionY<0)o=Math.ceil(o/m.scrollHeight);else o=Math.round(o/m.scrollHeight);m.pageY=-o;o=o*m.scrollHeight;if(o>0)o=m.pageY=0;else if(o<m.maxScrollY){m.pageY=m.maxPageY;o=m.maxScrollY}n=Math.round(Math.max(Math.abs(m.x-
l)/m.scrollWidth*500,Math.abs(m.y-o)/m.scrollHeight*500));return{x:l,y:o,time:n}},scrollTo:function(m,l,o){var n=this;if(n.x==m&&n.y==l){n.resetPosition();return}n.moved=true;n.setTransitionTime(o||"350ms");n.setPosition(m,l);if(o==="0"||o=="0s"||o=="0ms")n.resetPosition();else document.addEventListener("webkitTransitionEnd",n,false)},scrollToPage:function(n,m,p){var o=this;var l;if(!o.options.snap){o.pageX=-Math.round(o.x/o.scrollWidth);o.pageY=-Math.round(o.y/o.scrollHeight)}if(n=="next")n=++o.pageX;
else if(n=="prev")n=--o.pageX;if(m=="next")m=++o.pageY;else if(m=="prev")m=--o.pageY;n=-n*o.scrollWidth;m=-m*o.scrollHeight;l=o.snap(n,m);n=l.x;m=l.y;o.scrollTo(n,m,p||"500ms")},scrollToElement:function(m,o){m=typeof m=="object"?m:this.element.querySelector(m);if(!m)return;var n=this;var l=n.scrollX?-m.offsetLeft:0;var p=n.scrollY?-m.offsetTop:0;if(l>=0)l=0;else if(l<n.maxScrollX)l=n.maxScrollX;if(p>=0)p=0;else if(p<n.maxScrollY)p=n.maxScrollY;n.scrollTo(l,p,o)},momentum:function(s,m,q,l){var p=2.5;
var r=1.2;var n=Math.abs(s)/m*1E3;var o=n*n/p/1E3;var t=0;if(s>0&&o>q){n=n*q/o/p;o=q}else if(s<0&&o>l){n=n*l/o/p;o=l}o=o*(s<0?-1:1);t=n/r;return{dist:Math.round(o),time:Math.round(t)}},destroy:function(l){var m=this;window.removeEventListener("onorientationchange"in window?"orientationchange":"resize",m,false);m.element.removeEventListener(f,m,false);m.element.removeEventListener(i,m,false);m.element.removeEventListener(e,m,false);document.removeEventListener("webkitTransitionEnd",m,false);if(m.options.checkDOMChanges)m.element.removeEventListener("DOMSubtreeModified",
m,false);if(m.scrollBarX)m.scrollBarX=m.scrollBarX.remove();if(m.scrollBarY)m.scrollBarY=m.scrollBarY.remove();if(l)m.wrapper.parentNode.removeChild(m.wrapper);return null}};k.prototype={init:function(l,n){var o=this;var q=document;var p=Math.PI;var m;if(o.dir=="horizontal"){if(o.maxSize!=o.wrapper.offsetWidth){o.maxSize=o.wrapper.offsetWidth;m=q.getCSSCanvasContext("2d","scrollbar"+o.uid+o.dir,o.maxSize,5);m.fillStyle="rgb(0,0,0)";m.beginPath();m.arc(2.5,2.5,2.5,p/2,-p/2,false);m.lineTo(o.maxSize-
2.5,0);m.arc(o.maxSize-2.5,2.5,2.5,-p/2,p/2,false);m.closePath();m.fill()}}else if(o.maxSize!=o.wrapper.offsetHeight){o.maxSize=o.wrapper.offsetHeight;m=q.getCSSCanvasContext("2d","scrollbar"+o.uid+o.dir,5,o.maxSize);m.fillStyle="rgb(0,0,0)";m.beginPath();m.arc(2.5,2.5,2.5,p,0,false);m.lineTo(5,o.maxSize-2.5);m.arc(2.5,o.maxSize-2.5,2.5,0,p,false);m.closePath();m.fill()}o.size=Math.max(Math.round(o.maxSize*o.maxSize/n),6);o.maxScroll=o.maxSize-o.size;o.toWrapperProp=o.maxScroll/(l-n);o.bar.style[o.dir==
"horizontal"?"width":"height"]=o.size+"px"},setPosition:function(m){var l=this;if(l.wrapper.style.opacity!="1")l.show();m=Math.round(l.toWrapperProp*m);if(m<0){m=l.shrink?m+m*3:0;if(l.size+m<7)m=-l.size+6}else if(m>l.maxScroll){m=l.shrink?m+(m-l.maxScroll)*3:l.maxScroll;if(l.size+l.maxScroll-m<7)m=l.size+l.maxScroll-6}m=l.dir=="horizontal"?h+m+"px,0"+b:h+"0,"+m+"px"+b;l.bar.style.webkitTransform=m},show:function(){if(d)this.wrapper.style.webkitTransitionDelay="0";this.wrapper.style.opacity="1"},hide:function(){if(d)this.wrapper.style.webkitTransitionDelay=
"350ms";this.wrapper.style.opacity="0"},remove:function(){this.wrapper.parentNode.removeChild(this.wrapper);return null}};var d="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix;var g=/iphone|ipad/gi.test(navigator.appVersion);var a="ontouchstart"in window;var f=a?"touchstart":"mousedown";var i=a?"touchmove":"mousemove";var e=a?"touchend":"mouseup";var h="translate"+(d?"3d(":"(");var b=d?",0)":")";var c=0;window.iScroll=j})();